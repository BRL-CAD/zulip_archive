[
    {
        "content": "<p>Hey <span class=\"user-mention\" data-user-id=\"102902\">@Sean</span> , I'm delighted that I've been selected for GSoC'21 under BRL-CAD and look forward to start work as soon as possible.<br>\nI will setup my blog on the org's website soon.<br>\nPlease do brief me on anything else I should do</p>",
        "id": 239318456,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1621368833
    },
    {
        "content": "<p>Hey <span class=\"user-mention\" data-user-id=\"353338\">@Vikram Atreya</span> !  You beat me to it, but yes!  I'm also delighted we were able to select you fro GSoC21 and am looking forward to this amazing undo system you'll get going for us. :)</p>",
        "id": 239319468,
        "sender_full_name": "Sean",
        "timestamp": 1621369268
    },
    {
        "content": "<p>I think you have a good handle on things already.  You'll want to have a public space (blog, wiki, etc) where you can document your development progress for others.  There is a checklist that you'll want to go through, though I know you've already done 2/3rds of it.</p>",
        "id": 239319683,
        "sender_full_name": "Sean",
        "timestamp": 1621369372
    },
    {
        "content": "<p>You'll also want to convert your proposal into a project plan by posting it somewhere public (e.g., our wiki) where we can refine on objectives and to simply keep a record when the project is long over with.</p>",
        "id": 239319873,
        "sender_full_name": "Sean",
        "timestamp": 1621369445
    },
    {
        "content": "<p>Sure, will be doing these tomorrow.</p>",
        "id": 239320221,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1621369599
    },
    {
        "content": "<p>Just a doubt, so from now on will development take place on github, like opening PRs, etc? or we are still continuing with svn?</p>",
        "id": 239322073,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1621370363
    },
    {
        "content": "<p>Development takes place on Github. I recommend to fork the BRL-CAD repository to your own account and use this as your working base and for discussions with the mentors. Depending on the state of your work, parts of your work can be shifted back to the main repository via pull request.</p>",
        "id": 239370757,
        "sender_full_name": "Daniel Rossberg",
        "timestamp": 1621404594
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/239319873\">said</a>:</p>\n<blockquote>\n<p>You'll also want to convert your proposal into a project plan by posting it somewhere public (e.g., our wiki) where we can refine on objectives and to simply keep a record when the project is long over with.</p>\n</blockquote>\n<p>I have created the pages for dev logs and project plan, though the content hasn't been filed yet<br>\nDev logs -  <a href=\"https://brlcad.org/wiki/User:Vikram_Atreya/GSoC21/Log\">https://brlcad.org/wiki/User:Vikram_Atreya/GSoC21/Log</a><br>\nProject plan - <a href=\"https://brlcad.org/wiki/User:Vikram_Atreya/GSoC21/Project\">https://brlcad.org/wiki/User:Vikram_Atreya/GSoC21/Project</a></p>",
        "id": 239458666,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1621442968
    },
    {
        "content": "<p>On the communication schedule, I'm planning on putting updates here every 2-3 days and updating the blog every week.</p>",
        "id": 239459058,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1621443124
    },
    {
        "content": "<p>Updated the project plan in the above link, please do take a look</p>",
        "id": 239703447,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1621579162
    },
    {
        "content": "<p>Time taken for following in libgit2 method: (haven't divided by CLOCK_CYCLES)<br>\nIntialize repo: 4,524,677<br>\nopen db and make object: 193,198<br>\ncommit: 4,446,718<br>\ndelete: 81<br>\nRevert back to prev commit: 4,450,182</p>\n<p>Time taken for following in partial :<br>\nOpen and add: 193,797<br>\nKill and add recovery object: 187,787<br>\nRecover: 195,973</p>\n<p>These times are for a single hairball</p>",
        "id": 239897312,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1621714477
    },
    {
        "content": "<p>Just a recap of where I had left work</p>",
        "id": 239897318,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1621714489
    },
    {
        "content": "<p>So the libgit2 method was taking too much time than expected, when compared to the partial+events method</p>",
        "id": 239897369,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1621714552
    },
    {
        "content": "<p>To continue from here, I will review the libgit2 code once again for any redundancy or extra code that is getting executed</p>",
        "id": 239897426,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1621714610
    },
    {
        "content": "<p>Thanks for the numbers <span class=\"user-mention\" data-user-id=\"353338\">@Vikram Atreya</span> !  I got to assume you're using some sort of microsecond timer?  Is that a bu_gettime() tick count?</p>",
        "id": 240136188,
        "sender_full_name": "Sean",
        "timestamp": 1621909871
    },
    {
        "content": "<p>If so, the calculation is simply divide by 1M to get seconds, so I have to imagine that's not ticks per microsecond.. otherwise that'd be about 0.2s to undo with partial and 4.4s with git... and those numbers seem wildly high.  I would maybe believe 0.02 and 0.4s though.</p>",
        "id": 240136372,
        "sender_full_name": "Sean",
        "timestamp": 1621910125
    },
    {
        "content": "<p>Ah, I bet that's it.  I see one of the timers on Windows is 10k ticks per millisecond, i.e., divide by 10M, which would be 0.02 and 0.4s respectively</p>",
        "id": 240136485,
        "sender_full_name": "Sean",
        "timestamp": 1621910272
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/240136188\">said</a>:</p>\n<blockquote>\n<p>Thanks for the numbers <span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> !  I got to assume you're using some sort of microsecond timer?  Is that a bu_gettime() tick count?</p>\n</blockquote>\n<p>I got those values using the clock() function in C++</p>",
        "id": 240159025,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1621932819
    },
    {
        "content": "<p>So if we divide the values by 10^6, we get the values in seconds</p>",
        "id": 240159167,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1621932913
    },
    {
        "content": "<p>So I just tested initializing a git repo normally, using git init and it barely took a sec (0.7 sec)</p>",
        "id": 240369098,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1622053733
    },
    {
        "content": "<p>So I feel I have some redundant/inefficient  code in my 'basic undo using VCS' file</p>",
        "id": 240369222,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1622053784
    },
    {
        "content": "<p>Havent really analyzed in much depth, so will work on it now</p>",
        "id": 240369342,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1622053814
    },
    {
        "content": "<p>gardening :) (paying off tech debt? housekeeping?)</p>",
        "id": 240457200,
        "sender_full_name": "Erik",
        "timestamp": 1622117732
    },
    {
        "content": "<p>I have rigorously reviewed my code and have made a few changes, the time still remains the same at 13 sec to initialize the repo.</p>",
        "id": 240825286,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1622462875
    },
    {
        "content": "<p>Next, I tried initializing a git repo with hairball.g using terminal, and (git init + git add + git commit) took 12.5 sec</p>",
        "id": 240825290,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1622462880
    },
    {
        "content": "<p>Does this make the libgit2 method unviable?</p>",
        "id": 240825360,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1622462917
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"102902\">@Sean</span> Could you guide me on what could be my next step so that we are better informed, for selecting the libgit2 method or the partial method?</p>",
        "id": 241318361,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1622667171
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/240825360\">said</a>:</p>\n<blockquote>\n<p>Does this make the libgit2 method unviable?</p>\n</blockquote>\n<p>I think it means we don't start with it, yes.</p>",
        "id": 241345796,
        "sender_full_name": "Sean",
        "timestamp": 1622692171
    },
    {
        "content": "<p>Go with the partial method and we'll just press forward with optimizing it.  Maybe we'll learn some other general way to capture state information later on (or use libgit2 as a fallback method later).</p>",
        "id": 241346092,
        "sender_full_name": "Sean",
        "timestamp": 1622692647
    },
    {
        "content": "<p>Can you make your latest test code for the two methods available somewhere?  Would like to look it over in more detail.</p>",
        "id": 241346154,
        "sender_full_name": "Sean",
        "timestamp": 1622692713
    },
    {
        "content": "<p>Sure, will upload it as a continuation in the PR I had created</p>",
        "id": 241346172,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1622692764
    },
    {
        "content": "<p>will do in 10 min</p>",
        "id": 241346245,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1622692854
    },
    {
        "content": "<p>Updated the PR <br>\n<a href=\"https://sourceforge.net/p/brlcad/patches/569/\">https://sourceforge.net/p/brlcad/patches/569/</a></p>",
        "id": 241346532,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1622693252
    },
    {
        "content": "<p>Cool, yeah, just saw the update, great!</p>",
        "id": 241347661,
        "sender_full_name": "Sean",
        "timestamp": 1622695023
    },
    {
        "content": "<p>I have parallelly started the implementation of the undo command to mged, first goal is to make it print something<br>\nWill try to finish this by tomorrow</p>",
        "id": 241458454,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1622756078
    },
    {
        "content": "<p>Done, typing undo in mged prints the title of the database for now. Should I create a PR for this?</p>",
        "id": 241490698,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1622781749
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"353338\">@Vikram Atreya</span> Yes, please do!</p>",
        "id": 241491611,
        "sender_full_name": "Sean",
        "timestamp": 1622783023
    },
    {
        "content": "<p>Created the patch -- <a href=\"https://sourceforge.net/p/brlcad/patches/570/\">https://sourceforge.net/p/brlcad/patches/570/</a></p>",
        "id": 241492118,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1622783633
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/104062-general/topic/GSoC.20ideas/near/232214136\">said</a>:</p>\n<blockquote>\n<p>With partial, you're basically storing (partial) state as commands are run so we have whatever information is required to restore the previous state. The most simple form of this is to keep a copy of any objects that are changed or deleted. Since we can undo objects added bquoteply deleting them, we don't need to do anything special other than keep track of them.</p>\n<p>Note that there's LOTS of ways to implement this sort of undo. For example, here's a really simple setup where (for example) we decide to store our backups in the same .g file using a simple numeric suffix that denotes what change. For example, db.g might have in it: objA objB objC objA;1 objA;2 objA;3 objB;2 objC;4</p>\n<p>The current state is three objects: objA objB objC</p>\n<p>The most recent change was some edit to objC. When the change was made to objC, we save the previous state is in objC;4 .. so undoing the command is a simple to replace objC with objC;4</p>\n<p>The next undo restores objA to a previous state (via objA;3).</p>\n<p>The one after that was a simultaneous change to objA and objB, so we restore both from objA;2 and objB;2 </p>\n</blockquote>\n<p>Our last discussion on the partial method</p>",
        "id": 241492916,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1622784690
    },
    {
        "content": "<p>The logic to implementing this could be, we store objX;n as you had suggested, then depending on no of undos asked for, we go back to that n and start moving backward to see the latest version of each object until we have verified the latest version of each object<br>\nThis solves the problem where:<br>\nFirst we make a change to A<br>\nThen again change something in A <br>\nMake a change in B<br>\nMake a change in C<br>\nMake a change in A<br>\nIf we want go back 2 steps, we first see objB;3 next we traverse back and find objA;2 which is the latest version of A before step 3<br>\nWe still keep going to back to find C but after we see all changes if we do not find it , we delete it (This deletion could be a problem if we had a fixed number of undos stored so we dont find C which could be present earlier and thus deleted, but can be solved easily)</p>",
        "id": 241493244,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1622785160
    },
    {
        "content": "<p>I want to create a stack that can be accessed and modified when any command is called, then is it a must that the stack be a part of gedp?<br>\nIf not are there any such variables/data strucs that have the same functionality already in the code, so that I can draw parallels when writing code for undo</p>",
        "id": 241579037,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1622833141
    },
    {
        "content": "<p>Some design points I have in mind:</p>\n<ul>\n<li>Facilitate 10-15 undos from the latest state</li>\n<li>Initially no redo command and later states are deleted once undo is used</li>\n<li>Works only on objects and not on other data stored</li>\n</ul>",
        "id": 241616163,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1622868768
    },
    {
        "content": "<p>Continuing on the design decisions ......</p>\n<ul>\n<li>Plain undo with no flags does just 1 undo</li>\n<li><code> -n  X</code> flag does multiple undos, where X is no of undos to be done</li>\n</ul>",
        "id": 241656197,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1622927097
    },
    {
        "content": "<p>I was going through the code of <code>cmd_ged_plain_wrapper</code> in cmd.c, I could not understand what <code>GEDP</code> is, it wasnt even there as a macro in the Doxygen documentation</p>",
        "id": 241726158,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623038507
    },
    {
        "content": "<p>Its the gedp of the database that is open, right? but still dint get how it is defined</p>",
        "id": 241726667,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623039185
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/241579037\">said</a>:</p>\n<blockquote>\n<p>I want to create a stack that can be accessed and modified when any command is called, then is it a must that the stack be a part of gedp?<br>\nIf not are there any such variables/data strucs that have the same functionality already in the code, so that I can draw parallels when writing code for undo</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"102902\">@Sean</span> any help on this, even an int should be sufficient so that I can store at how many steps we have backed up objects, which will be used to create names for the next backup</p>",
        "id": 241731380,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623044455
    },
    {
        "content": "<p>GEDP is a struct ged, src/mged/mged[ch]</p>",
        "id": 241920052,
        "sender_full_name": "Erik",
        "timestamp": 1623159415
    },
    {
        "content": "<p>Updated <a href=\"https://brlcad.org/wiki/User:Vikram_Atreya/GSoC21/Log\">log</a> and ideas for implementation in <a href=\"https://bit.ly/3cupRfs\">project plan</a></p>",
        "id": 241958678,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623174263
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"353338\">@Vikram Atreya</span> do you mean some field in struct ged that you can use for tracking version information??</p>",
        "id": 242013560,
        "sender_full_name": "Sean",
        "timestamp": 1623208496
    },
    {
        "content": "<p>There is no such field in the struct (nor should their be).  Taking a step back, I see you have lots of great thought put into this and lots of questions.</p>",
        "id": 242013918,
        "sender_full_name": "Sean",
        "timestamp": 1623208971
    },
    {
        "content": "<p>I think you're biting off a little too much all at once.  You got a plan but it's fully of lots of risk and unknowns for you.  You don't have any experience working with objects or gedp's yet.  This is a hard project, so let's keep this as simple as absolutely possible and build up an undo capability a little bit at a time.</p>",
        "id": 242014026,
        "sender_full_name": "Sean",
        "timestamp": 1623209125
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242013560\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> do you mean some field in struct ged that you can use for tracking version information??</p>\n</blockquote>\n<p>I wanted to have a tracking variable but did not know where to initialize it.<br>\nYeah I know gedp doesn't have one right now, so was asking if changes in gedp would be required for that or there was some other way</p>",
        "id": 242014204,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623209335
    },
    {
        "content": "<p>For example, put a pause on worrying about undoing N times.  Pause the thoughts on redo.</p>",
        "id": 242014309,
        "sender_full_name": "Sean",
        "timestamp": 1623209456
    },
    {
        "content": "<p>Heck, even forget about any possible command.  Let's focus on undoing 1 thing.</p>",
        "id": 242014333,
        "sender_full_name": "Sean",
        "timestamp": 1623209485
    },
    {
        "content": "<p>There are nominally three choices then for where you can start.  On an object database like our .g file, everything boils down to being one of three things:  adding an object, removing an object, changing an object.</p>",
        "id": 242014434,
        "sender_full_name": "Sean",
        "timestamp": 1623209640
    },
    {
        "content": "<p>Pick one of those three.</p>",
        "id": 242014480,
        "sender_full_name": "Sean",
        "timestamp": 1623209661
    },
    {
        "content": "<p>So the task would be just to add an object and then undo it?</p>",
        "id": 242014509,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623209751
    },
    {
        "content": "<p>if you picked \"adding an object\", then yes</p>",
        "id": 242014548,
        "sender_full_name": "Sean",
        "timestamp": 1623209771
    },
    {
        "content": "<p>is that what you pick?</p>",
        "id": 242014559,
        "sender_full_name": "Sean",
        "timestamp": 1623209794
    },
    {
        "content": "<p>Are you talking in terms of adding any object and then undoing it or a hardcoded example?</p>",
        "id": 242014562,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623209799
    },
    {
        "content": "<p>adding an object using any command, I meant</p>",
        "id": 242014583,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623209854
    },
    {
        "content": "<p>I'm talking about thinking of this problem is incredibly oversimplified terms so you will be able to focus on as little code complexity as possible.  That focus can initially be on any of those three basic possibilities.</p>",
        "id": 242014639,
        "sender_full_name": "Sean",
        "timestamp": 1623209890
    },
    {
        "content": "<p>So, adding an object.  Again, simplify, so we're not going to worry JUST yet on any command.  Let's focus on just one command that adds an object.</p>",
        "id": 242014660,
        "sender_full_name": "Sean",
        "timestamp": 1623209937
    },
    {
        "content": "<p>I feel this has already been covered in the patch I had created for hardcoded undo example.</p>",
        "id": 242014681,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623209973
    },
    {
        "content": "<p>I was exactly doing this</p>",
        "id": 242014695,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623209988
    },
    {
        "content": "<p>Sort of, right</p>",
        "id": 242014702,
        "sender_full_name": "Sean",
        "timestamp": 1623209998
    },
    {
        "content": "<p>Adding an object , making a backup , killing it and then readding it back</p>",
        "id": 242014743,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623210007
    },
    {
        "content": "<p>this is about the machinery needed to do it for real in mged</p>",
        "id": 242014745,
        "sender_full_name": "Sean",
        "timestamp": 1623210013
    },
    {
        "content": "<p>so conceptually, you know the librt structures involved</p>",
        "id": 242014758,
        "sender_full_name": "Sean",
        "timestamp": 1623210041
    },
    {
        "content": "<p>Wont be using the ged_make() here as well to add the object?</p>",
        "id": 242014767,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623210056
    },
    {
        "content": "<p>Directly, no -- indirectly, yes.</p>",
        "id": 242014781,
        "sender_full_name": "Sean",
        "timestamp": 1623210105
    },
    {
        "content": "<p>In your example, the demo had complete knowledge.</p>",
        "id": 242014790,
        "sender_full_name": "Sean",
        "timestamp": 1623210118
    },
    {
        "content": "<p>In mged, where's that knowledge going to live?</p>",
        "id": 242014831,
        "sender_full_name": "Sean",
        "timestamp": 1623210130
    },
    {
        "content": "<p>does it belong in the .g, in the ged struct, in a librt structure, in an mged structure? what are the tradeoffs?</p>",
        "id": 242014844,
        "sender_full_name": "Sean",
        "timestamp": 1623210157
    },
    {
        "content": "<p>they're all options.</p>",
        "id": 242014850,
        "sender_full_name": "Sean",
        "timestamp": 1623210169
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242014831\">said</a>:</p>\n<blockquote>\n<p>In mged, where's that knowledge going to live?</p>\n</blockquote>\n<p>This was exactly my ques regarding the tracking variable :)</p>",
        "id": 242014861,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623210185
    },
    {
        "content": "<p>so what I meant about indirect and direct, the 'make' command will be issued on the mged command line.  that of course will indirectly and eventually invoke ged_make()</p>",
        "id": 242014894,
        "sender_full_name": "Sean",
        "timestamp": 1623210242
    },
    {
        "content": "<p>so the immediate tasks becomes implementing an \"undo\" command in libed, so it's available as an mged command, that undoes a 'make' command.</p>",
        "id": 242014969,
        "sender_full_name": "Sean",
        "timestamp": 1623210339
    },
    {
        "content": "<p>so you can literally perform this sequence, right?</p>\n<p>mged&gt; make sph sph<br>\nmged&gt; ls sph<br>\nmged&gt; undo<br>\nmged&gt; ls sph<br>\n--&gt; sph not found</p>",
        "id": 242015038,
        "sender_full_name": "Sean",
        "timestamp": 1623210402
    },
    {
        "content": "<p>Yeah</p>",
        "id": 242015050,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623210420
    },
    {
        "content": "<p>So that simple sequence begs a lot of <em>potential</em> complexity right away, but it's important to keep this simple view in perspective for now before jumping to a conclusion.</p>",
        "id": 242015128,
        "sender_full_name": "Sean",
        "timestamp": 1623210503
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242014844\">said</a>:</p>\n<blockquote>\n<p>does it belong in the .g, in the ged struct, in a librt structure, in an mged structure? what are the tradeoffs?</p>\n</blockquote>\n<p>Figuring this out will be an intermediate task right?<br>\nIs there any such data, maybe used in another command, stored in any of these so I have some idea on how to implement it for undo</p>",
        "id": 242015233,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623210654
    },
    {
        "content": "<p>That's because there are loads of implications that are really complicated to explain, many that we won't even begin to remember until you've coded down a particular path and it becomes really hard to change it, or complexity gets added prematurely.  For example, adding a field to ged struct... that is already making an assumption that only struct ged-using applications will be able to undo actions (not an entirely unreasonable assumption, but has implications).</p>",
        "id": 242015234,
        "sender_full_name": "Sean",
        "timestamp": 1623210655
    },
    {
        "content": "<p>There really isn't a good pattern for you to follow here in our code base.  There are dozens of related patterns on how to pass data around and I'd argue most of them create strong interface couplings and awareness that won't scale well for the needs of an undo system.</p>",
        "id": 242015303,
        "sender_full_name": "Sean",
        "timestamp": 1623210751
    },
    {
        "content": "<p>Consider this, archer has an undo system implemented (it was disabled 10+ years ago, but it exists/existed)... it existed before libged existed.</p>",
        "id": 242015328,
        "sender_full_name": "Sean",
        "timestamp": 1623210811
    },
    {
        "content": "<p>So if all you had to do was implement undo of make commands, what kind of simple solutions come to mind?</p>",
        "id": 242015388,
        "sender_full_name": "Sean",
        "timestamp": 1623210868
    },
    {
        "content": "<p>If I could store a state previous to the make, I will know what new elements got added after the make and then kill it</p>",
        "id": 242015426,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623210953
    },
    {
        "content": "<p>or atleast names of all objects in a previous state</p>",
        "id": 242015478,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623210974
    },
    {
        "content": "<p>Answer should be \"it depends\" ;)</p>",
        "id": 242015492,
        "sender_full_name": "Sean",
        "timestamp": 1623211008
    },
    {
        "content": "<p>For example, there's a huge difference between running undo right after running make and running make, restarting mged, and then running undo.</p>",
        "id": 242015499,
        "sender_full_name": "Sean",
        "timestamp": 1623211021
    },
    {
        "content": "<p>Are we not limiting ourselves to undo in a particular mged session?</p>",
        "id": 242015513,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623211067
    },
    {
        "content": "<p>basically, whether that's a requirement determines whether the undo state has to be serialized to disk or only exists for the life of the app</p>",
        "id": 242015515,
        "sender_full_name": "Sean",
        "timestamp": 1623211071
    },
    {
        "content": "<p>Yes</p>",
        "id": 242015562,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623211096
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242015513\">said</a>:</p>\n<blockquote>\n<p>Are we not limiting ourselves to undo in a particular mged session?</p>\n</blockquote>\n<p>So exactly -- that's a great question and its answer begs for different solution directions.</p>",
        "id": 242015573,
        "sender_full_name": "Sean",
        "timestamp": 1623211133
    },
    {
        "content": "<p>I don't recall having decided that one way or the other, but feel free to correct me on that.  I think either is a reasonable assumption for starters.</p>",
        "id": 242015595,
        "sender_full_name": "Sean",
        "timestamp": 1623211179
    },
    {
        "content": "<p>We discussed limiting to a particular mged session when we thought we would go ahead with the libgit2 approach</p>",
        "id": 242015662,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623211243
    },
    {
        "content": "<p>Which is funny if true, because the libgit2 approach is intrinsically serialized to disk, which is a means for preserving across processes/sessions</p>",
        "id": 242015692,
        "sender_full_name": "Sean",
        "timestamp": 1623211309
    },
    {
        "content": "<p>But sure, let's limit it to a single memory session.  So in a given mged session, you get to rely on memory OR disk to store state information.  Memory is faster, thus it's reasonable to start there.</p>",
        "id": 242015738,
        "sender_full_name": "Sean",
        "timestamp": 1623211343
    },
    {
        "content": "<p>So that brings us back to somehow recording that a database addition has happened in some way that an undo command can be made aware of it.</p>",
        "id": 242015818,
        "sender_full_name": "Sean",
        "timestamp": 1623211446
    },
    {
        "content": "<p>Knowing our API, if that were all undo ever had to do, I would probably leverage disk serialization to get cross-process undo for free just because the code to do so would be so incredibly uninvasive.  The simplest maintainable solution that comes to my mind would be to have the libged wrapper or parent exec function stash the name of the last 'make' object in the _GLOBAL object.</p>",
        "id": 242015922,
        "sender_full_name": "Sean",
        "timestamp": 1623211620
    },
    {
        "content": "<p>That way, make doesn't have to be modified, and undo command is not coupled to the make command in any way.  It's coupled to the libged executor.</p>",
        "id": 242015956,
        "sender_full_name": "Sean",
        "timestamp": 1623211650
    },
    {
        "content": "<p>the _GLOBAL object is a simple set of key=value pairs, so it'd be very economical to just write a \"last_make=object\" attribute in there, then undo would read it, delete object, and delete the last_make attribute.</p>",
        "id": 242016036,
        "sender_full_name": "Sean",
        "timestamp": 1623211759
    },
    {
        "content": "<p>But isnt it better to modify the make command itself? that way even if ged_make were called some other place it would still store the name of the added object<br>\nP.S. Is ged_make() exactly equal to make command from mged?</p>",
        "id": 242016037,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623211760
    },
    {
        "content": "<p>make sense?</p>",
        "id": 242016039,
        "sender_full_name": "Sean",
        "timestamp": 1623211761
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242016039\">said</a>:</p>\n<blockquote>\n<p>make sense?</p>\n</blockquote>\n<p>the method does, but why write the code in a wrapper or parent exec func?<br>\nWhy not have a new function in make.c and call it within ged_make_core()</p>",
        "id": 242016106,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623211824
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242016037\">said</a>:</p>\n<blockquote>\n<p>But isnt it better to modify the make command itself? that way even if ged_make were called some other place it would still store the name of the added object</p>\n</blockquote>\n<p>Maybe yes, maybe no.  That's my caution about unintended side effects. </p>\n<p>Say there's some other \"deep_copy\" command you don't yet know about that traverses the database N times and calls ged_make()+ged_rename() repeatedly as part of its implementation.  If the undo is coupled to some logic in ged_make() then maybe that make  \"deep_copy\" completely unusable (too slow).  Also,  \"undo\" very unhelpfully just undoes the last make or perhaps it even fails (crashes?) because in this case every make was followed with a rename.</p>",
        "id": 242016361,
        "sender_full_name": "Sean",
        "timestamp": 1623212187
    },
    {
        "content": "<blockquote>\n<p>P.S. Is ged_make() exactly equal to make from command from ged?</p>\n</blockquote>\n<p>In most cases, yes -- the commands are presently using a convention of ged_[CMD] where CMD is an mged and/or archer command.  There are a handful of commands that don't fit the pattern or that have additional logic provided by a common wrapper layer, but I see those abberations as things to fix.</p>",
        "id": 242016431,
        "sender_full_name": "Sean",
        "timestamp": 1623212300
    },
    {
        "content": "<p>but the wrapper is only called from mged cmds right?</p>",
        "id": 242016503,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623212418
    },
    {
        "content": "<p>So while I would use the _GLOBAL, an alternative would be as you suggest -- we could make ged_make() store its action some where.   But then we might have to next implement logic like a flag or a switch or a field in a struct to suppress that behavior where it's undesirable.</p>",
        "id": 242016512,
        "sender_full_name": "Sean",
        "timestamp": 1623212429
    },
    {
        "content": "<p>Moreover, while we are considering this simple case, we're not blind to the 400 other commands that need to come next.  Is editing 400 commands the best we can do for a generalized single-step undo?  Probably not... and it probably also implies that we don't want to implement fields or flags that are specific to the make command.  Remember there are a couple dozen commands that \"add objects\"</p>",
        "id": 242016602,
        "sender_full_name": "Sean",
        "timestamp": 1623212552
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242016503\">said</a>:</p>\n<blockquote>\n<p>but the wrapper is only called from mged cmds right?</p>\n</blockquote>\n<p>I'm not sure I understand this question... but no, the wrapper is not called from mged cmds.</p>",
        "id": 242016620,
        "sender_full_name": "Sean",
        "timestamp": 1623212602
    },
    {
        "content": "<p>the wrapper is called by mged's libged executor, which calls the given ged_[CMD]() that was registered with it</p>",
        "id": 242016676,
        "sender_full_name": "Sean",
        "timestamp": 1623212666
    },
    {
        "content": "<p>My ques is like this:<br>\nIf I type make obj1 obj2 in mged:<br>\ncalls are: wrapper -&gt; ged_make<br>\nbut if i were directly calling ged_make() within the code of some other cmd lets say<br>\nThen the wrapper attached to make is skipped?</p>",
        "id": 242016689,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623212701
    },
    {
        "content": "<p>it entirely depends on the cmd, but yeah it could skip the wrapper.  90% of commands use a generic wrapper that just calls the ged_CMD</p>",
        "id": 242016711,
        "sender_full_name": "Sean",
        "timestamp": 1623212762
    },
    {
        "content": "<p>Okay.</p>",
        "id": 242016765,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623212803
    },
    {
        "content": "<p>the purpose of the wrappers has little really to do with libged</p>",
        "id": 242016766,
        "sender_full_name": "Sean",
        "timestamp": 1623212807
    },
    {
        "content": "<p>some commands have different wrappers depending on what they do, like if a command creates geometry (make is a great example), then the wrapper might automatically get the plot data for the object(s) made and draw them into the graphics window so you actually see the object after making it.</p>",
        "id": 242016851,
        "sender_full_name": "Sean",
        "timestamp": 1623212901
    },
    {
        "content": "<p>Yes, I had gone through the wrappers of a few functions to understand their logic</p>",
        "id": 242016886,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623212964
    },
    {
        "content": "<p>If you ran a different command like 'ls', you don't want a wrapper that wastes time trying to figure out if it needs to draw/undraw objects.  the wrapper doesn't need to do anything, so it just calls ged_list() instead</p>",
        "id": 242016888,
        "sender_full_name": "Sean",
        "timestamp": 1623212966
    },
    {
        "content": "<p>So the wrappers in general make for a lousy storage mechanism for undo because they're not part of the .g and not part of librt or libged, so undo would only work in mged.  We definitely want undo to work in mged and archer.</p>",
        "id": 242016964,
        "sender_full_name": "Sean",
        "timestamp": 1623213036
    },
    {
        "content": "<p>which results in a choice of duplicating wrapper logic for archer (a bad sign), or finding a different/better way.</p>",
        "id": 242016990,
        "sender_full_name": "Sean",
        "timestamp": 1623213086
    },
    {
        "content": "<p>the simplest in-memory place to store the 'last_make' object name is probably struct ged, which is probably now catching up to why you were looking there</p>",
        "id": 242017042,
        "sender_full_name": "Sean",
        "timestamp": 1623213148
    },
    {
        "content": "<p>except we don't want undo to be coupled to a specific command still, right?  that doesn't scale to 400 commands</p>",
        "id": 242017059,
        "sender_full_name": "Sean",
        "timestamp": 1623213186
    },
    {
        "content": "<p>True</p>",
        "id": 242017063,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623213195
    },
    {
        "content": "<p>we could decide to couple it to the three database operations (add, remove, change)</p>",
        "id": 242017064,
        "sender_full_name": "Sean",
        "timestamp": 1623213201
    },
    {
        "content": "<p>but that also feels brittle, begs for a lot of machinery because most commands are sequenced combinations of those</p>",
        "id": 242017081,
        "sender_full_name": "Sean",
        "timestamp": 1623213237
    },
    {
        "content": "<p>I had another idea planned in mind, which would require a full checkpoint at the oldest command and would not require any additional data to be stored other than the backup objects</p>",
        "id": 242017130,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623213286
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242017042\">said</a>:</p>\n<blockquote>\n<p>the simplest in-memory place to store the 'last_make' object name is probably struct ged, which is probably now catching up to why you were looking there</p>\n</blockquote>\n<p>and even here instead of having last_make, if we can store names of all objects present at a particular state, it would make the job much easier</p>",
        "id": 242017153,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623213340
    },
    {
        "content": "<p>that's essentially what libgit2 is doing</p>",
        "id": 242017207,
        "sender_full_name": "Sean",
        "timestamp": 1623213388
    },
    {
        "content": "<p>and why it takes so long :)</p>",
        "id": 242017209,
        "sender_full_name": "Sean",
        "timestamp": 1623213393
    },
    {
        "content": "<p>Pretty much yes <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 242017239,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623213446
    },
    {
        "content": "<p>so you might be able to come up with a streamlined higher-performing version of that, but we should design with an assumption that .g files can have 10^5 individual objects as that is about the norm for real geometry.</p>",
        "id": 242017305,
        "sender_full_name": "Sean",
        "timestamp": 1623213505
    },
    {
        "content": "<p>about the norm as an upper limit that is, 10^4 is typical along with database sizes in the 100M to 10G range</p>",
        "id": 242017328,
        "sender_full_name": "Sean",
        "timestamp": 1623213563
    },
    {
        "content": "<p>I think this could work as git was storing a full checkpoint in the beginning and could do a large no of undos, if we restrict ourselves to a smallno like 10-15 it should work fast enough</p>",
        "id": 242017379,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623213608
    },
    {
        "content": "<p>don't care much about how usable this is on a .g file with 10 objects if it scales so poorly when there are 10000 objects that mged is no longer interactive for example</p>",
        "id": 242017382,
        "sender_full_name": "Sean",
        "timestamp": 1623213617
    },
    {
        "content": "<p>In all your research getting started, how far did you get?  Did you learn about the command pattern, memento pattern, and/or undo chains?</p>",
        "id": 242017405,
        "sender_full_name": "Sean",
        "timestamp": 1623213654
    },
    {
        "content": "<p>I did go through the idea of how things were implemented in command and memento pattern but hadnt seen any code</p>",
        "id": 242017477,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623213731
    },
    {
        "content": "<p>If you've not read it yet, here's a good read that might take a half hour or hour and it even pertains to geometric edits: <a href=\"http://blog.wolfire.com/2009/02/how-we-implement-undo/\">http://blog.wolfire.com/2009/02/how-we-implement-undo/</a></p>",
        "id": 242017486,
        "sender_full_name": "Sean",
        "timestamp": 1623213761
    },
    {
        "content": "<p>Will go through it for sure</p>",
        "id": 242017502,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623213808
    },
    {
        "content": "<p>So my immediate task will be to write code in the wrapper to undo make commands storing last_make in _GLOBAl</p>",
        "id": 242017598,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623213933
    },
    {
        "content": "<p>Well you certainly can and there would be absolutely nothing wrong with starting there.  It is obvious that that storage mechanism doesn't scale to other commands, so how to decouple it?</p>",
        "id": 242017662,
        "sender_full_name": "Sean",
        "timestamp": 1623214017
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242017153\">said</a>:</p>\n<blockquote>\n<p>and even here instead of having last_make, if we can store names of all objects present at a particular state, it would make the job much easier</p>\n</blockquote>\n<p>This is one possibility</p>",
        "id": 242017730,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623214093
    },
    {
        "content": "<p>True, but does that scale?  Probably not...</p>",
        "id": 242017749,
        "sender_full_name": "Sean",
        "timestamp": 1623214133
    },
    {
        "content": "<p>It's also obvious that the storage mechanism will undoubtedly need to change, even probably go away entirely as storing strings in _GLOBAL doesn't seem like that scales too, but the limit doesn't exist until we expand scope to considering undoing lots of additions.</p>",
        "id": 242017775,
        "sender_full_name": "Sean",
        "timestamp": 1623214194
    },
    {
        "content": "<p>Think about the name I proposed, and perhaps there's a name less coupled to \"make\"?</p>",
        "id": 242017830,
        "sender_full_name": "Sean",
        "timestamp": 1623214234
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242017830\">said</a>:</p>\n<blockquote>\n<p>Think about the name I proposed, and perhaps there's a name less coupled to \"make\"?</p>\n</blockquote>\n<p>name?? U meant method?</p>",
        "id": 242017853,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623214301
    },
    {
        "content": "<p>You are referring to last_make?</p>",
        "id": 242017898,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623214328
    },
    {
        "content": "<p>yes</p>",
        "id": 242017903,
        "sender_full_name": "Sean",
        "timestamp": 1623214336
    },
    {
        "content": "<p>last_make</p>",
        "id": 242017904,
        "sender_full_name": "Sean",
        "timestamp": 1623214338
    },
    {
        "content": "<p>that's a coupling to the make command</p>",
        "id": 242017911,
        "sender_full_name": "Sean",
        "timestamp": 1623214347
    },
    {
        "content": "<p>Got it</p>",
        "id": 242017913,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623214353
    },
    {
        "content": "<p>instead of a \"last_make\" key=value attribute, decoupled we might instead chose to name it \"last_added\" ... that makes it not coupled and conceptually could extend to two more keys for removed and changed, right?</p>",
        "id": 242017925,
        "sender_full_name": "Sean",
        "timestamp": 1623214379
    },
    {
        "content": "<p>Yeah</p>",
        "id": 242017939,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623214394
    },
    {
        "content": "<p>We might also want to know the latest change among the three later on</p>",
        "id": 242018018,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623214456
    },
    {
        "content": "<p>so the only problem is the fact that we're serializing this junk to disk instead of just keeping it in memory, but I suggest you start there anyways since that will result in an actually functioning undo command we can play with and poke on</p>",
        "id": 242018020,
        "sender_full_name": "Sean",
        "timestamp": 1623214457
    },
    {
        "content": "<p>and  you still have to decide where to inject the attribute</p>",
        "id": 242018026,
        "sender_full_name": "Sean",
        "timestamp": 1623214469
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242018018\">said</a>:</p>\n<blockquote>\n<p>We might also want to know the latest change among the three later on</p>\n</blockquote>\n<p>BINGO!!</p>",
        "id": 242018030,
        "sender_full_name": "Sean",
        "timestamp": 1623214487
    },
    {
        "content": "<p>an evolution might be a latest change, or it might be to combine them together so there's not three attributes which implies a list (and if there's a list, then it can be a stack and the latest will be on the top, right?)</p>",
        "id": 242018127,
        "sender_full_name": "Sean",
        "timestamp": 1623214656
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242018026\">said</a>:</p>\n<blockquote>\n<p>and  you still have to decide where to inject the attribute</p>\n</blockquote>\n<p>Does _GLOBAL have a type? like arb8,sph?</p>",
        "id": 242018134,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623214679
    },
    {
        "content": "<p>yes, all objects have a major and minor type</p>",
        "id": 242018179,
        "sender_full_name": "Sean",
        "timestamp": 1623214707
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242018127\">said</a>:</p>\n<blockquote>\n<p>an evolution might be a latest change, or it might be to combine them together so there's not three attributes which implies a list (and if there's a list, then it can be a stack and the latest will be on the top, right?)</p>\n</blockquote>\n<p>This was exactly the reason i was asking about the stack in my msg about changing gedp</p>",
        "id": 242018183,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623214717
    },
    {
        "content": "<p>_GLOBAL is a non-geometric object type</p>",
        "id": 242018186,
        "sender_full_name": "Sean",
        "timestamp": 1623214726
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/241579037\">said</a>:</p>\n<blockquote>\n<p>I want to create a stack that can be accessed and modified when any command is called, then is it a must that the stack be a part of gedp?<br>\nIf not are there any such variables/data strucs that have the same functionality already in the code, so that I can draw parallels when writing code for undo</p>\n</blockquote>\n<p>.</p>",
        "id": 242018189,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623214733
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242018183\">said</a>:</p>\n<blockquote>\n<p>This was exactly the reason i was asking about the stack in my msg about changing gedp</p>\n</blockquote>\n<p>Yes, I realize this, but the answer is super complicated and couplings will be VERY easy to introduce if you jump into the deep end.</p>",
        "id": 242018204,
        "sender_full_name": "Sean",
        "timestamp": 1623214770
    },
    {
        "content": "<p>I know this feels like baby steps... there's a reason, I promise. ;)</p>",
        "id": 242018208,
        "sender_full_name": "Sean",
        "timestamp": 1623214791
    },
    {
        "content": "<p>Not suggesting I know the answer ahead of time either -- we very well may end up needing to modify the ged pointer (that's what the 'p' in gedp stands for), but we might not too</p>",
        "id": 242018296,
        "sender_full_name": "Sean",
        "timestamp": 1623214875
    },
    {
        "content": "<p>Sure, I will work on the basic changes today and get back to you at EoD (for me, might be start for you)</p>",
        "id": 242018351,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623214932
    },
    {
        "content": "<p>since we're going the partial route, there's a lot of competing concerns like getting as much command coverage as possible without doing per-command work.</p>",
        "id": 242018352,
        "sender_full_name": "Sean",
        "timestamp": 1623214935
    },
    {
        "content": "<p>when you finish up undo of make, expand your implementation to the inverse -- a command that deletes an object (e.g., kill)</p>",
        "id": 242018371,
        "sender_full_name": "Sean",
        "timestamp": 1623214994
    },
    {
        "content": "<p>Okay</p>",
        "id": 242018388,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623215033
    },
    {
        "content": "<p>then expand to another command that makes objects (e.g., cp) ...</p>",
        "id": 242018431,
        "sender_full_name": "Sean",
        "timestamp": 1623215049
    },
    {
        "content": "<p>each time, revisit your couplings to see what work you had to do to accommodate the change.  See if there's a way to eliminate that work.</p>",
        "id": 242018450,
        "sender_full_name": "Sean",
        "timestamp": 1623215098
    },
    {
        "content": "<p>Sure, will do</p>",
        "id": 242018479,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623215127
    },
    {
        "content": "<p>but again, incrementally so we have a chain of commits we can look at to see where directions shift</p>",
        "id": 242018481,
        "sender_full_name": "Sean",
        "timestamp": 1623215128
    },
    {
        "content": "<p>where a coupling gets introduced.</p>",
        "id": 242018489,
        "sender_full_name": "Sean",
        "timestamp": 1623215146
    },
    {
        "content": "<p>and when you feel like you've got that all working, well talk again -- the next command or change type will dictate new requirements.</p>",
        "id": 242018563,
        "sender_full_name": "Sean",
        "timestamp": 1623215228
    },
    {
        "content": "<p>I mean we'll talk before then too, but we'll definitely need a status check after you've got examples of adding, removing, and changing working.</p>",
        "id": 242018585,
        "sender_full_name": "Sean",
        "timestamp": 1623215275
    },
    {
        "content": "<p>and make sure the \"undo\" command is robust.  undo without having run make.. what happens?  undo  with object names after it, what does that mean? etc.</p>",
        "id": 242018638,
        "sender_full_name": "Sean",
        "timestamp": 1623215345
    },
    {
        "content": "<p>what makes it throw an error</p>",
        "id": 242018649,
        "sender_full_name": "Sean",
        "timestamp": 1623215370
    },
    {
        "content": "<p>Okay</p>",
        "id": 242018650,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623215377
    },
    {
        "content": "<p>what makes it output anything really</p>",
        "id": 242018652,
        "sender_full_name": "Sean",
        "timestamp": 1623215388
    },
    {
        "content": "<p>same thing for return codes.</p>",
        "id": 242018739,
        "sender_full_name": "Sean",
        "timestamp": 1623215519
    },
    {
        "content": "<p>Will surely consider all these cases when I write the code</p>",
        "id": 242018872,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623215678
    },
    {
        "content": "<p>for example,</p>\n<p>mged&gt; make sph sph<br>\nmged&gt; undo<br>\nmged &gt; undo</p>\n<p>... does that second undo result in anything printed?  does it result in a non-zero return code?  a zero return code? </p>\n<p>undo will need to be somewhat well-defined (i.e., documented) as you go along. you'll eventually want to write up a simple manual page for it, maybe unit tests too.  All things you can tackle when you're needing a break from ged structures and gdb debugging. ;)</p>",
        "id": 242018893,
        "sender_full_name": "Sean",
        "timestamp": 1623215717
    },
    {
        "content": "<p>I have implemented the last_make variable addition in f_make, ged_make's wrapper <br>\nNext, when undo is called it is searching for last_make's value in  _GLOBAL and then killing that object using ged_kill()</p>",
        "id": 242132474,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623273779
    },
    {
        "content": "<p>Should I create a new PR or update the last PR or not required?</p>",
        "id": 242132749,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623273913
    },
    {
        "content": "<p>Killing the object sounds wildly wrong.. :)</p>",
        "id": 242132867,
        "sender_full_name": "Sean",
        "timestamp": 1623273963
    },
    {
        "content": "<p>_GLOBAL holds other information like the title, working units, and potentially other information</p>",
        "id": 242132907,
        "sender_full_name": "Sean",
        "timestamp": 1623273981
    },
    {
        "content": "<p>Code is still not robust, have a working version as of now<br>\nWill make it more robust and clean tomorrow before making a PR</p>",
        "id": 242132944,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623273999
    },
    {
        "content": "<p>It's an attribute object, so you just want to wipe out that specific attribute that was added.</p>",
        "id": 242132993,
        "sender_full_name": "Sean",
        "timestamp": 1623274026
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242132867\">said</a>:</p>\n<blockquote>\n<p>Killing the object sounds wildly wrong.. :)</p>\n</blockquote>\n<p>Was using ged_kill(), so typed it in that flow</p>",
        "id": 242133025,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623274048
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242132993\">said</a>:</p>\n<blockquote>\n<p>It's an attribute object, so you just want to wipe out that specific attribute that was added.</p>\n</blockquote>\n<p>Im not killing _GLOBAL <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span></p>",
        "id": 242133053,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623274064
    },
    {
        "content": "<p>Then how else are you using ged_kill??</p>",
        "id": 242133083,
        "sender_full_name": "Sean",
        "timestamp": 1623274078
    },
    {
        "content": "<p>Im deleting the object that has the value stored in last_make</p>",
        "id": 242133123,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623274082
    },
    {
        "content": "<p>Oooh, gotya</p>",
        "id": 242133173,
        "sender_full_name": "Sean",
        "timestamp": 1623274110
    },
    {
        "content": "<p>Pseudo code:<br>\nged_kill(gedp, last_make-&gt;value)</p>",
        "id": 242133182,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623274120
    },
    {
        "content": "<p>sounds good</p>",
        "id": 242133254,
        "sender_full_name": "Sean",
        "timestamp": 1623274161
    },
    {
        "content": "<p>will want to make sure that's robust to last_make-&gt;value being null or not existing or whatever else that can happen</p>",
        "id": 242133394,
        "sender_full_name": "Sean",
        "timestamp": 1623274222
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242133394\">said</a>:</p>\n<blockquote>\n<p>will want to make sure that's robust to last_make-&gt;value being null or not existing or whatever else that can happen</p>\n</blockquote>\n<p>Yes, I have not dealt with this yet. I will look into this tomorrow.</p>",
        "id": 242133487,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623274277
    },
    {
        "content": "<p>Along with the robustness changes, I'll try to implement the last_kill and latest_change (among make and kill ) tomorrow.</p>",
        "id": 242134057,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623274570
    },
    {
        "content": "<ul>\n<li>Plan to recover killed object:</li>\n<li>During kill call:<ul>\n<li>Make a copy of object getting deleted with a standard suffix attached and hides it</li>\n<li>Kill object</li>\n</ul>\n</li>\n<li>During undo call:<ul>\n<li>Identifies last object deleted</li>\n<li>Searches for hidden object with the suffix</li>\n<li>brings it back using move command</li>\n</ul>\n</li>\n</ul>",
        "id": 242161516,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623303379
    },
    {
        "content": "<p>Done implementing above logic along with latest_change <br>\nNow we can make or kill object and then undo that change</p>",
        "id": 242221974,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623337626
    },
    {
        "content": "<p>I have made the code more robust as well, but not entirely. Will try to wrap this up today and then create a PR before EoD</p>",
        "id": 242222418,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623337796
    },
    {
        "content": "<p>Done</p>",
        "id": 242262820,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623355515
    },
    {
        "content": "<p>Errors being handling:</p>\n<ul>\n<li>GLOBAL object missing</li>\n<li>no undo info stored in different cases</li>\n<li>Common ones, like attributes not being set, wrong input, etc</li>\n</ul>",
        "id": 242262823,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623355517
    },
    {
        "content": "<p>Few bugs I can see right now:</p>\n<ul>\n<li>kill throws an error when flags are used, since I took argv[1] to be name of the file which is not true when flags are specified</li>\n<li>It is not possible to reduce no of objects once added, since backups will keep on being created even if you plan to delete the backup. Infinite loop.</li>\n<li>Attributes are not removed in few cases. <br>\neg: <br>\nmake obj1 sph<br>\nmake obj2 sph<br>\nkill obj2 sph<br>\nundo</li>\n</ul>\n<p>last_change and last_kill are removed but last_make is left, I have intentionally not solved this, since it is not ideal to delete previous info when we work on multiple undos.</p>",
        "id": 242263860,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623355944
    },
    {
        "content": "<p>Updated PR and <a href=\"https://brlcad.org/wiki/User:Vikram_Atreya/GSoC21/Log\">logs</a></p>",
        "id": 242267652,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623357624
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"102902\">@Sean</span> next task would be deal with a command that affects a lot of objects?<br>\nor implementing a stack like philosophy into GLOBAL itself, where the change is marked by which no of command it has been generated by<br>\nand then while undoing we check for the highest number and then take action on that</p>",
        "id": 242267798,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623357712
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"353338\">@Vikram Atreya</span> outstanding progress there... </p>\n<p>so since you moved on to killing does that mean undo of make is robust?</p>",
        "id": 242298326,
        "sender_full_name": "Sean",
        "timestamp": 1623383428
    },
    {
        "content": "<p>Yes afaik</p>",
        "id": 242298333,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623383461
    },
    {
        "content": "<p>part of the point of the oversimplification is to find and fix all the little corner cases and bugs because it's likely only going to get more complicated as requirement is expanded to other commands.</p>",
        "id": 242298347,
        "sender_full_name": "Sean",
        "timestamp": 1623383501
    },
    {
        "content": "<p>cool, so what's it do if you make, rename, then undo?</p>",
        "id": 242298355,
        "sender_full_name": "Sean",
        "timestamp": 1623383520
    },
    {
        "content": "<p>It wont find the object to kill, so assumes its already killed and removes the last_make and latest_change as of now</p>",
        "id": 242298412,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623383582
    },
    {
        "content": "<p>silently or does it print a message?</p>",
        "id": 242298421,
        "sender_full_name": "Sean",
        "timestamp": 1623383603
    },
    {
        "content": "<p>it's fine either way, just subtle implications with both, so good to know</p>",
        "id": 242298489,
        "sender_full_name": "Sean",
        "timestamp": 1623383653
    },
    {
        "content": "<p>I hadnt explicitly tested this, I'll test this right now, just a min</p>",
        "id": 242298491,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623383663
    },
    {
        "content": "<p>It says db_lookup() failed</p>",
        "id": 242298528,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623383735
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242267798\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> next task would be deal with a command that affects a lot of objects?<br>\nor implementing a stack like philosophy into GLOBAL itself, where the change is marked by which no of command it has been generated by<br>\nand then while undoing we check for the highest number and then take action on that</p>\n</blockquote>\n<p>Nope, the next task is to figure out how to refactor the changes you had to make into a command-agnostic form.</p>",
        "id": 242298536,
        "sender_full_name": "Sean",
        "timestamp": 1623383744
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242298528\">said</a>:</p>\n<blockquote>\n<p>It says db_lookup() failed</p>\n</blockquote>\n<p>Okay, that's a lower-level blather.  I suggest turning that off as it's misleading to a user</p>",
        "id": 242298590,
        "sender_full_name": "Sean",
        "timestamp": 1623383784
    },
    {
        "content": "<p>there's a quiet flag on lookup</p>",
        "id": 242298593,
        "sender_full_name": "Sean",
        "timestamp": 1623383793
    },
    {
        "content": "<p>Yes, Ill change that</p>",
        "id": 242298598,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623383803
    },
    {
        "content": "<p>So next step, I suggest expanding last_make to include objects made with the 'in' command.</p>",
        "id": 242298621,
        "sender_full_name": "Sean",
        "timestamp": 1623383833
    },
    {
        "content": "<p>That's the main primitive creation command that can create nearly any entity interactively.</p>",
        "id": 242298687,
        "sender_full_name": "Sean",
        "timestamp": 1623383893
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242298687\">said</a>:</p>\n<blockquote>\n<p>That's the main primitive creation command that can create nearly any entity interactively.</p>\n</blockquote>\n<p>Just looked it up in the docs</p>",
        "id": 242298704,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623383920
    },
    {
        "content": "<p>If you just type a few parameters like \"in foo sph\"  it will prompt you for the rest.<br>\nOnce completed, you can press up-arrow to see what that command looks like as a 1-liner.</p>",
        "id": 242298719,
        "sender_full_name": "Sean",
        "timestamp": 1623383962
    },
    {
        "content": "<p>regardless, the trick is to issue an 'in' and then be able to undo the object</p>",
        "id": 242298804,
        "sender_full_name": "Sean",
        "timestamp": 1623384011
    },
    {
        "content": "<p>when you get that working, that will be a very important time to reflect on what code changed and how you can then restructure things better so logic isn't duplicated.</p>",
        "id": 242298828,
        "sender_full_name": "Sean",
        "timestamp": 1623384048
    },
    {
        "content": "<p>then try doing the same for a more complex command like killall that kills and modifies</p>",
        "id": 242298945,
        "sender_full_name": "Sean",
        "timestamp": 1623384135
    },
    {
        "content": "<p>I had one more doubt, is it ok to treat folders as normal objects when backing up?</p>",
        "id": 242299058,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623384291
    },
    {
        "content": "<p>so for 'make' and 'in' ... look at what files you edited.  the logic will likely be nearly or actually identical.  think about what could change so you only have the actual undo logic in exactly one file.  where could that be, or what needs to change so that it could be in just one place.  Is there a place currently where it could go where undo continues to work in archer also?  lots to think about, there are lots of options here.  this should take you a couple days to explore.</p>",
        "id": 242299088,
        "sender_full_name": "Sean",
        "timestamp": 1623384341
    },
    {
        "content": "<p>and even when recovering, will there be any issue of not giving the right references</p>",
        "id": 242299092,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623384344
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242299058\">said</a>:</p>\n<blockquote>\n<p>I had one more doubt, is it ok to treat folders as normal objects when backing up?</p>\n</blockquote>\n<p>er, what the heck is a folder?</p>",
        "id": 242299099,
        "sender_full_name": "Sean",
        "timestamp": 1623384355
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242299099\">said</a>:</p>\n<blockquote>\n<p>er, what the heck is a folder?</p>\n</blockquote>\n<p>Maybe its called a directory</p>",
        "id": 242299165,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623384424
    },
    {
        "content": "<p>Let me send a picture</p>",
        "id": 242299169,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623384433
    },
    {
        "content": "<p>folders live on the filesystem and are effectively logical groupings of files on the filesystem, typically organized into a hierarchical structure...</p>",
        "id": 242299212,
        "sender_full_name": "Sean",
        "timestamp": 1623384482
    },
    {
        "content": "<p>directory is a generic concept and could mean lots of things.  there is a notion of a directory in a .g file, but I'm not sure that's what you're referring to when you say directory...</p>",
        "id": 242299264,
        "sender_full_name": "Sean",
        "timestamp": 1623384528
    },
    {
        "content": "<p><a href=\"/user_uploads/1549/CUlleyVhw1UkN7eoWtUfb709/image.png\">image.png</a> <br>\nSo scene.g was what i meant as a folder, whereas head_tip.s is an object</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/1549/CUlleyVhw1UkN7eoWtUfb709/image.png\" title=\"image.png\"><img src=\"/user_uploads/1549/CUlleyVhw1UkN7eoWtUfb709/image.png\"></a></div>",
        "id": 242299266,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623384532
    },
    {
        "content": "<p>Okay, great!  So despite the misleading icon... :)</p>\n<p>Every word you see listed there is an object.</p>",
        "id": 242299280,
        "sender_full_name": "Sean",
        "timestamp": 1623384590
    },
    {
        "content": "<p>bishop.r is an object</p>",
        "id": 242299343,
        "sender_full_name": "Sean",
        "timestamp": 1623384658
    },
    {
        "content": "<p>bishop.c is a different object</p>",
        "id": 242299357,
        "sender_full_name": "Sean",
        "timestamp": 1623384673
    },
    {
        "content": "<p>headtor.s is yet another object... probably a torus primitive</p>",
        "id": 242299371,
        "sender_full_name": "Sean",
        "timestamp": 1623384706
    },
    {
        "content": "<p>the others are called \"combination objects\" as they are objects defined by combining other objects with CSG Boolean operations</p>",
        "id": 242299433,
        "sender_full_name": "Sean",
        "timestamp": 1623384805
    },
    {
        "content": "<p>Okay</p>",
        "id": 242299492,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623384881
    },
    {
        "content": "<p>So there is no issue in directly dealing with these .r or .c then</p>",
        "id": 242299503,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623384906
    },
    {
        "content": "<p>I always thought, even when writing the concat code that i wasn't making it robust for these \"folders\"</p>",
        "id": 242299570,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623384980
    },
    {
        "content": "<p>from the perspective of a .g file, they are all individual objects that can be directly acted upon</p>",
        "id": 242299646,
        "sender_full_name": "Sean",
        "timestamp": 1623385085
    },
    {
        "content": "<p>there are certainly implications, otherwise they would not exist</p>",
        "id": 242299649,
        "sender_full_name": "Sean",
        "timestamp": 1623385104
    },
    {
        "content": "<p>but they are just objects.  it's only because week peek into the objects and find that some objects reference other objects, and when you pay attention to the references, it becomes obvious that the objects form a hierarchy</p>",
        "id": 242299677,
        "sender_full_name": "Sean",
        "timestamp": 1623385157
    },
    {
        "content": "<p>I suggest reading a few things before proceeding, and perhaps doing one of the tutorials that introduces the concept -- it's an important one for what you're going to be doing with undo</p>",
        "id": 242299736,
        "sender_full_name": "Sean",
        "timestamp": 1623385205
    },
    {
        "content": "<p>maybe start with <a href=\"https://brlcad.org/w/images/5/52/MGED_Quick_Reference_Card.pdf\">https://brlcad.org/w/images/5/52/MGED_Quick_Reference_Card.pdf</a> , look at the second page where it says CAD and explains the three main types of geometric objects</p>",
        "id": 242299757,
        "sender_full_name": "Sean",
        "timestamp": 1623385259
    },
    {
        "content": "<p>Got it</p>",
        "id": 242299823,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623385356
    },
    {
        "content": "<p>then I'd suggest either doing a few of the tutorials at <a href=\"https://brlcad.org/wiki/Documentation\">https://brlcad.org/wiki/Documentation</a> under #2 \"Introduction to MGED\" or reading a lot of  #3 \"Principles of Effective Modeling\" (espeically page 14, but read other parts too)</p>",
        "id": 242299833,
        "sender_full_name": "Sean",
        "timestamp": 1623385382
    },
    {
        "content": "<p>the tutorials take like 20 minutes each but incrementally introduce concepts.</p>",
        "id": 242299886,
        "sender_full_name": "Sean",
        "timestamp": 1623385442
    },
    {
        "content": "<p>But so yeah, then when you get back to code -- see what kill and undo do when you kill something in the hierarchy.  make sure you learn the \"tops\" and \"ls\" and \"l\" commands, understand what they do.  they have individual manual pages, but use those three to explore your .g instead of using the geometry browser.</p>",
        "id": 242300010,
        "sender_full_name": "Sean",
        "timestamp": 1623385603
    },
    {
        "content": "<p>got to run, but that should be a lot of homework for a while ;)</p>",
        "id": 242300019,
        "sender_full_name": "Sean",
        "timestamp": 1623385625
    },
    {
        "content": "<p>keep up the awesome work!</p>",
        "id": 242300029,
        "sender_full_name": "Sean",
        "timestamp": 1623385641
    },
    {
        "content": "<p>Thank you, yes I'll get to work on these tasks</p>",
        "id": 242300032,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623385654
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242298828\">said</a>:</p>\n<blockquote>\n<p>when you get that working, that will be a very important time to reflect on what code changed and how you can then restructure things better so logic isn't duplicated.</p>\n</blockquote>\n<p>I have implemented the logic for the \"in\" command, it took me a few seconds to implement since all I had to do was a copy-paste from make's wrapper to in's wrapper.</p>",
        "id": 242424648,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623469193
    },
    {
        "content": "<p>I have gone through quite a few tutorials in the Introduction to MGED doc, will explore further using a database, and then start work on killall</p>",
        "id": 242427237,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623473039
    },
    {
        "content": "<p>To reverse a killall is it a good idea to store the parent comb object as backup? My guess is no,but I just wanted to ask</p>",
        "id": 242520482,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623603902
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242299266\">said</a>:</p>\n<blockquote>\n<p><a href=\"/user_uploads/1549/CUlleyVhw1UkN7eoWtUfb709/image.png\">image.png</a> <br>\nSo scene.g was what i meant as a folder, whereas head_tip.s is an object</p>\n</blockquote>\n<p>In this file when I kill, not killall, head.c and then open the geometry browser I get:<br>\n<code> db_lookup() failed: head.c does not exist</code> four times<br>\nIs this expected? I have removed any code that I might have added but this error still persists</p>",
        "id": 242523149,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623607689
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"353338\">@Vikram Atreya</span> this is almost certainly a consequence of not doing enough tutorials to understand the hierarchical structure and implications...   You probably killed head.c but left a lot of references to it in other combinations.  So you'll get an error when looking at any combs that reference it.</p>",
        "id": 242548526,
        "sender_full_name": "Sean",
        "timestamp": 1623642694
    },
    {
        "content": "<p>killall may have been too much of a leap .. the reason I mentioned that command next is because it's a kill like you already know plus a set of  object changes.  maybe instead of killall, do a simpler change command first like the 'g' command.  that just affects one object and is easy to reverse.  it either creates or changes an existing object.</p>",
        "id": 242549089,
        "sender_full_name": "Sean",
        "timestamp": 1623643324
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242548526\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> this is almost certainly a consequence of not doing enough tutorials to understand the hierarchical structure and implications...   You probably killed head.c but left a lot of references to it in other combinations.  So you'll get an error when looking at any combs that reference it.</p>\n</blockquote>\n<p>I do understand how regions, combinations work. I was just wondering if that error was generated by me during the backup for undo</p>",
        "id": 242549182,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623643458
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242549089\">said</a>:</p>\n<blockquote>\n<p>killall may have been too much of a leap .. the reason I mentioned that command next is because it's a kill like you already know plus a set of  object changes.  maybe instead of killall, do a simpler change command first like the 'g' command.  that just affects one object and is easy to reverse.  it either creates or changes an existing object.</p>\n</blockquote>\n<p>killall is possible I just need to understand how to do it via commands first, So I've been exploring a lot of commands like copymat and clone but I'm a little confused to where the comb is stored and which commands effectively copy that information as well</p>",
        "id": 242549224,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623643553
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242424648\">said</a>:</p>\n<blockquote>\n<p>I have implemented the logic for the \"in\" command, it took me a few seconds to implement since all I had to do was a copy-paste from make's wrapper to in's wrapper.</p>\n</blockquote>\n<p>Remember what I wrote ... \"so for 'make' and 'in' ... look at what files you edited. the logic will likely be nearly or actually identical. think about what could change so you only have the actual undo logic in exactly one file. where could that be, or what needs to change so that it could be in just one place. Is there a place currently where it could go where undo continues to work in archer also? lots to think about, there are lots of options here. this should take you a couple days to explore.\"</p>\n<p>So yeah, it was a simple copy-and-paste, but now there's two copies of that code.  Refactor it to just one copy.</p>",
        "id": 242549263,
        "sender_full_name": "Sean",
        "timestamp": 1623643564
    },
    {
        "content": "<p>Is it a good idea to  create a file in libged/undo with all these functions and they could be called in the wrappers</p>",
        "id": 242549301,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623643677
    },
    {
        "content": "<p>Reason for that is that it's a simple copy-and-paste for make and in commands, but there are literally hundreds more and we don't want to do that hundreds of times.  Plus, if we want / need it to change, there will be too many instances that need to be edited.  Also, there are a dozen variations that aren't as simple, but are nearly the same.</p>",
        "id": 242549302,
        "sender_full_name": "Sean",
        "timestamp": 1623643680
    },
    {
        "content": "<p>Sure, you could create a new file if you need to.  That's not the hard part... the hard part is figuring out how to change where or how it's called so that it's actually in only one place.</p>",
        "id": 242549397,
        "sender_full_name": "Sean",
        "timestamp": 1623643755
    },
    {
        "content": "<p>We may still need to modify all commands, but then we definitely want to do that as few times as possible and not coupled to this particular method.</p>",
        "id": 242549544,
        "sender_full_name": "Sean",
        "timestamp": 1623643905
    },
    {
        "content": "<p>What I think we'll end up needing is for commands to either 1) emit events as they do work or 2) perform standard actions through ged wrappers (e.g., for all object creations, deletions, and changes).</p>",
        "id": 242549607,
        "sender_full_name": "Sean",
        "timestamp": 1623643976
    },
    {
        "content": "<p>So the combinations are not stored in rt_db_internal, but as a separate DS in ged right?</p>",
        "id": 242549791,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623644269
    },
    {
        "content": "<p>So the exact point where Im stuck is recovering the combination tree again. 2 ways I am thinking of are:</p>\n<ul>\n<li>Store the comb structure (rt_comb_internal) itself and then paste that when recovering</li>\n<li>Store the name of the parent of the object as well as the object and replicate the \"i\" cmd and add it back into the db</li>\n</ul>",
        "id": 242551684,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623646080
    },
    {
        "content": "<p>But I'm quite unsure how the first method will work</p>",
        "id": 242552013,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623646331
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242549791\">said</a>:</p>\n<blockquote>\n<p>So the combinations are not stored in rt_db_internal, but as a separate DS in ged right?</p>\n</blockquote>\n<p>I'm not understanding this ... combinations are indeed stored in the .g file and have an rt_db_internal representation.</p>",
        "id": 242552091,
        "sender_full_name": "Sean",
        "timestamp": 1623646388
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242551684\">said</a>:</p>\n<blockquote>\n<p>So the exact point where Im stuck is recovering the combination tree again. 2 ways I am thinking of are:</p>\n<ul>\n<li>Store the comb structure (rt_comb_internal) itself and then paste that when recovering</li>\n<li>Store the name of the parent of the object as well as the object and replicate the \"i\" cmd and add it back into the db</li>\n</ul>\n</blockquote>\n<p>Perhaps it would help to not think of it as a tree.  Think of it as sets of objects.  Run \"ls\" and see all the objects in a database.  Running a command like \"killall\" is going to remove 1 of those objects you see in ls and possibly edit a bunch of others.  That is all.  Similar with the 'g' command.  It's either going to create an object that was not in the \"ls\" listing or it's going to edit an existing object.</p>",
        "id": 242552269,
        "sender_full_name": "Sean",
        "timestamp": 1623646551
    },
    {
        "content": "<p>To \"recover the tree\", you have to undo the edits and/or add objects and/or remove objects.  That's pretty true for nearly all commands.</p>",
        "id": 242552387,
        "sender_full_name": "Sean",
        "timestamp": 1623646627
    },
    {
        "content": "<p>there are some efficiencies that can be made by introspecing what types of edits, but we can start blindly and assume any edit needs to be backed up.</p>",
        "id": 242552445,
        "sender_full_name": "Sean",
        "timestamp": 1623646706
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242552091\">said</a>:</p>\n<blockquote>\n<p>I'm not understanding this ... combinations are indeed stored in the .g file and have an rt_db_internal representation.</p>\n</blockquote>\n<p>So there are as many rt_comb_internal s as the no of objects in the .g, right?</p>",
        "id": 242552508,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623646763
    },
    {
        "content": "<p>usually there are fewer combinations because there are rt_*_internal for other types too like ell, tor, bot, etc</p>",
        "id": 242552627,
        "sender_full_name": "Sean",
        "timestamp": 1623646830
    },
    {
        "content": "<p>there are as many rt_comb_internal as there are combination objects .. that is a combination object in its internal form (i.e., its deserialized in-memory form).</p>",
        "id": 242552662,
        "sender_full_name": "Sean",
        "timestamp": 1623646899
    },
    {
        "content": "<p>Okay, so when I was going through the code I thought every single object had its own rt_comb_internal, even a non combination object</p>",
        "id": 242552836,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623647121
    },
    {
        "content": "<p>they all have an rt_db_internal, maybe you have those two confused?</p>",
        "id": 242553850,
        "sender_full_name": "Sean",
        "timestamp": 1623648463
    },
    {
        "content": "<p>Yeah I think I'm a little confused, I will go through the data structures once again</p>",
        "id": 242578111,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623666853
    },
    {
        "content": "<p>Now I'm clear. Usual objects which are made using the \"make\" commands have rt_db_internal and combination objects made using the \"c\" command have an rt_comb_internal</p>",
        "id": 242684181,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623728234
    },
    {
        "content": "<p>To store a backup, first I will have to know which combination has the object, then i can store the combination name in which the object is present and then add back that relation using the \"i\" command when undo is called</p>",
        "id": 242684580,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623728881
    },
    {
        "content": "<p>If I search for the comb separately in the wrapper it will double the time taken to run this command, as this search will be happenning twice when the killall command is called</p>",
        "id": 242684641,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623728935
    },
    {
        "content": "<p>Once inside the wrapper and once in the code to delete it</p>",
        "id": 242684650,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623728949
    },
    {
        "content": "<p>So will it be okay if I modified the code of killall itself instead of its wrapper (which also affect kill and erase)</p>",
        "id": 242684667,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623728985
    },
    {
        "content": "<p>Successfully implemented undo for killall by modifying code in killrefs.c</p>",
        "id": 242687375,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623732401
    },
    {
        "content": "<p>I have presently chosen to undo unions only, but will write more code to accommodate -,+ as well</p>",
        "id": 242687928,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623732852
    },
    {
        "content": "<p>I have realized that to kill and save backups of combinations and .g objects I will have to write separate code<br>\nRight now when Im killing an object, I save a copy of it and hide it.<br>\nIn case of combinations what happens is the copied object still has the same references as the original object so the children objects never come out of a combination and rather get hidden in the backup</p>",
        "id": 242742760,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623768063
    },
    {
        "content": "<p>I have also implemented the undo for the g command</p>",
        "id": 242795380,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623789193
    },
    {
        "content": "<p>I tried refactoring common undo code to libged/undo/new_file.cpp but wasn't able to do it. I feel there can be a better place to place the common code which I will work on next.</p>",
        "id": 242795957,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623789462
    },
    {
        "content": "<p>Updated <a href=\"https://brlcad.org/wiki/User:Vikram_Atreya/GSoC21/Log\">logs</a>, will refine code tomorrow and update PR</p>",
        "id": 242800955,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623791796
    },
    {
        "content": "<p>Refactored make related backup code into mged/utility.c</p>",
        "id": 242917447,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623865962
    },
    {
        "content": "<p>Bugs/TODO right now:</p>\n<ol>\n<li>kill throws an error when flags are used, since I took argv[1] to be the name of the file which is not true when flags are specified</li>\n<li>Storing backup for .g objects that are being killed is flawed. Would like to discuss this <span class=\"user-mention\" data-user-id=\"102902\">@Sean</span> </li>\n<li>Logic for <code>g</code> undo is exactly the same as make, so when undo is called it kills the g even when the last <code>g</code> command could have been called to just change an existing .g object.</li>\n</ol>",
        "id": 242920669,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623867352
    },
    {
        "content": "<p>First issue is easy to solve<br>\nSecond and third logic I feel will be similar  and something new compared to what I have done till now</p>",
        "id": 242920856,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623867451
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242800955\">said</a>:</p>\n<blockquote>\n<p>Updated <a href=\"https://brlcad.org/wiki/User:Vikram_Atreya/GSoC21/Log\">logs</a>, will refine code tomorrow and update PR</p>\n</blockquote>\n<p>Created new patch since it is not a dummy undo now <span aria-label=\"grinning\" class=\"emoji emoji-1f600\" role=\"img\" title=\"grinning\">:grinning:</span></p>",
        "id": 242923287,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623868584
    },
    {
        "content": "<p>Please review the patch <span class=\"user-mention\" data-user-id=\"102902\">@Sean</span> so that I can correct any wrong practices that I might be following in the code</p>",
        "id": 242923377,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623868628
    },
    {
        "content": "<p>I have devised a logic to backup .g /.c objects:<br>\nWhen storing a copy of them we change the names of all the nodes that they are pointing to. <br>\nFor eg,  there exists a <code>group.g</code> with obj1.s , obj2.s and obj3.s in it;<br>\nWhen we store the backup presently the nodes remain the same which means we are never deleting the group but just renaming it, which is undesired<br>\nSo when we backup we store the group as follows:<br>\n<code>group.g_uncommon_suffix</code> <br>\nwith elements as follows --<br>\nobj1.s_uncommon_suffix , <br>\nobj2.s_uncommon_suffix and <br>\nobj3.s_uncommon_suffix<br>\nThis fixes the unwanted referencing problem which is present in the direct copy and store method</p>",
        "id": 243064913,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623955500
    },
    {
        "content": "<p>Implemeted and tested the above logic. So we can now killall any comb object and recover it without any part of the geometry behaving in any undesired manner <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>",
        "id": 243085362,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623964269
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242920669\">said</a>:</p>\n<blockquote>\n<p>Bugs/TODO right now:</p>\n<ol>\n<li>kill throws an error when flags are used, since I took argv[1] to be the name of the file which is not true when flags are specified</li>\n<li>Storing backup for .g objects that are being killed is flawed. Would like to discuss this <span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> </li>\n<li>Logic for <code>g</code> undo is exactly the same as make, so when undo is called it kills the g even when the last <code>g</code> command could have been called to just change an existing .g object.</li>\n</ol>\n</blockquote>\n<p>I will solve 3. a little later, what should I work on next <span class=\"user-mention\" data-user-id=\"102902\">@Sean</span></p>",
        "id": 243085505,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623964347
    },
    {
        "content": "<p>any preference or should I randomly pickup a command?</p>",
        "id": 243085988,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1623964557
    },
    {
        "content": "<p>Implemented undo for mv and mvall</p>",
        "id": 243210976,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624052539
    },
    {
        "content": "<p>Also restructured code in undo.cpp to accommodate more cmds easily</p>",
        "id": 243211398,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624052917
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"102902\">@Sean</span>  I have a doubt,  So right now undo code goes into the wrapper and for cmds like kill the backup should happen before the command runs, so if the input is wrong (like name of obj is wrong or wrong no args), problems arise. So how do I overcome this problem because bringing the arg checks into the wrapper will eliminate the purpose of wrappers.</p>",
        "id": 243267294,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624134234
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242920669\">said</a>:</p>\n<blockquote>\n<p>Bugs/TODO right now:</p>\n<ol>\n<li>kill throws an error when flags are used, since I took argv[1] to be the name of the file which is not true when flags are specified</li>\n<li>Storing backup for .g objects that are being killed is flawed. Would like to discuss this <span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> </li>\n<li>Logic for <code>g</code> undo is exactly the same as make, so when undo is called it kills the g even when the last <code>g</code> command could have been called to just change an existing .g object.</li>\n</ol>\n</blockquote>\n<p>Solved bug 3</p>",
        "id": 243407476,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624292722
    },
    {
        "content": "<p>Right now I have not implemented undo for killing multiple objects but while going through all commands available in MGED, I came across this command \"keep\", this can be very useful to store backups. <br>\nSo the plan to undo multiple objects being killed is:<br>\nMake a backup_file.g<br>\nMake a combination cmd_no.g and have all objects that are being killed in that step as its children<br>\nIm still unclear about how to recover them/ read from that database and then write it into the present one, will work on it</p>",
        "id": 243416138,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624296871
    },
    {
        "content": "<p>I have also made a <a href=\"https://docs.google.com/spreadsheets/d/12j2jpaKHHt8QG09o1e4NkK0fDoacfRi9AL_Wo0RuDM4/edit?usp=sharing\">spreadsheet</a> with all commands for which undo is done, not done, or not required</p>",
        "id": 243431732,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624304059
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243431732\">said</a>:</p>\n<blockquote>\n<p>I have also made a <a href=\"https://docs.google.com/spreadsheets/d/12j2jpaKHHt8QG09o1e4NkK0fDoacfRi9AL_Wo0RuDM4/edit?usp=sharing\">spreadsheet</a> with all commands for which undo is done, not done, or not required</p>\n</blockquote>\n<p>This is awesome!  That's great organization, but I will just note that many of the commands you have marked as not needing undo could have an undo construct (e.g., opendb and all the rt* commands).  They do reversible work or produce outputs that can be \"undone\".</p>",
        "id": 243873881,
        "sender_full_name": "Sean",
        "timestamp": 1624594375
    },
    {
        "content": "<p>I have updated only till k actually, after that it got really boring :p</p>",
        "id": 243873888,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624594409
    },
    {
        "content": "<p>the real take-away though is that there are hundreds of commands ... so that really begs a question of whether we can design a solution that doesn't require implementing undo hundreds of times and what might that look like?</p>",
        "id": 243873898,
        "sender_full_name": "Sean",
        "timestamp": 1624594436
    },
    {
        "content": "<p>Will fill in the rest today</p>",
        "id": 243873901,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624594445
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243873898\">said</a>:</p>\n<blockquote>\n<p>the real take-away though is that there are hundreds of commands ... so that really begs a question of whether we can design a solution that doesn't require implementing undo hundreds of times and what might that look like?</p>\n</blockquote>\n<p>I think it can be done decently easily if we can get a list of objects that has changed</p>",
        "id": 243873946,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624594484
    },
    {
        "content": "<p>or if not feasible to create a universal undo (sans adopting something like libgit) then how can we structure the code so that logic for a command is localized to that command.</p>",
        "id": 243873950,
        "sender_full_name": "Sean",
        "timestamp": 1624594502
    },
    {
        "content": "<p>I felt for cmds like dbconcat which are modifying objects without input, that is tough</p>",
        "id": 243873960,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624594518
    },
    {
        "content": "<p>Any cmd that is making, delting, changing objects via a given input list is easy to undo</p>",
        "id": 243873966,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624594538
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243873946\">said</a>:</p>\n<blockquote>\n<p>I think it can be done decently easily if we can get a list of objects that has changed</p>\n</blockquote>\n<p>That's an excellent observation... I think it's possible too, but haven't 100% convinced myself yet.</p>",
        "id": 243873969,
        "sender_full_name": "Sean",
        "timestamp": 1624594549
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243873966\">said</a>:</p>\n<blockquote>\n<p>Any cmd that is making, delting, changing objects via a given input list is easy to undo</p>\n</blockquote>\n<p>should be easy to undo*</p>",
        "id": 243873972,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624594558
    },
    {
        "content": "<p>Once I can get an implementation for any 1 of those, it should be quite simple to do it for the others</p>",
        "id": 243874017,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624594600
    },
    {
        "content": "<p>Im exploring the option of storing those objects in another database as of now, but havent yet finished that</p>",
        "id": 243874024,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624594626
    },
    {
        "content": "<p>I <em>think</em> a minimum required is for commands to declare a sequenced report of objects added, objects removed, and objects changed.  Those are akin to event notifications.  It would probably make sense for a few common \"meta\" events but to be explored later.</p>",
        "id": 243874083,
        "sender_full_name": "Sean",
        "timestamp": 1624594695
    },
    {
        "content": "<p>Yes, that would help</p>",
        "id": 243874161,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624594865
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243874024\">said</a>:</p>\n<blockquote>\n<p>Im exploring the option of storing those objects in another database as of now, but havent yet finished that</p>\n</blockquote>\n<p>That's great and I think something we'll want, but suggest focusing on making the logic not per-command first if you do indeed believe that is achievable.  That will likely involve modifications that are ... complicated.</p>",
        "id": 243874170,
        "sender_full_name": "Sean",
        "timestamp": 1624594879
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243874161\">said</a>:</p>\n<blockquote>\n<p>Yes, that would help</p>\n</blockquote>\n<p>but doing it for commands like dbconcat or similar might still be tough</p>",
        "id": 243874178,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624594910
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243874170\">said</a>:</p>\n<blockquote>\n<p>That's great and I think something we'll want, but suggest focusing on making the logic not per-command first if you do indeed believe that is achievable.  That will likely involve modifications that are ... complicated.</p>\n</blockquote>\n<p>Right now I have general code to deal with any make or change in one object per command. So it can be dealt by adding 3-4 lines to the  wrapper of whichever cmd</p>",
        "id": 243874241,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624594990
    },
    {
        "content": "<p>but the code is not ready for multi-object make/kill/change</p>",
        "id": 243874248,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624595017
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/242684181\">said</a>:</p>\n<blockquote>\n<p>Now I'm clear. Usual objects which are made using the \"make\" commands have rt_db_internal and combination objects made using the \"c\" command have an rt_comb_internal</p>\n</blockquote>\n<p>So just to revisit this statement... this is and isn't correct.  all objects have an rt_db_internal, combs included.</p>\n<p>inside the rt_db_internal is an idb_ptr iirc which is the type-specific structure for that object's type, like rt_comb_internal or rt_ell_internal.</p>",
        "id": 243874298,
        "sender_full_name": "Sean",
        "timestamp": 1624595067
    },
    {
        "content": "<p>So right now what would be the best thing to work on</p>",
        "id": 243874804,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624595772
    },
    {
        "content": "<p>Still checking things over, hold on ;)</p>",
        "id": 243874831,
        "sender_full_name": "Sean",
        "timestamp": 1624595814
    },
    {
        "content": "<p>Should I continue in the 'new database to store backups' direction</p>",
        "id": 243874833,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624595815
    },
    {
        "content": "<p>You've been productive, which is great. ;)</p>",
        "id": 243874838,
        "sender_full_name": "Sean",
        "timestamp": 1624595830
    },
    {
        "content": "<p>I took a break last 2 days though :P</p>",
        "id": 243874853,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624595861
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243064913\">said</a>:</p>\n<blockquote>\n<p>For eg,  there exists a <code>group.g</code> with obj1.s , obj2.s and obj3.s in it;<br>\nWhen we store the backup presently the nodes remain the same which means we are never deleting the group but just renaming it, which is undesired</p>\n</blockquote>\n<p>This example... </p>\n<blockquote>\n<p>This fixes the unwanted referencing problem which is present in the direct copy and store method</p>\n</blockquote>\n<p>What exactly was unwanted?</p>",
        "id": 243875083,
        "sender_full_name": "Sean",
        "timestamp": 1624596185
    },
    {
        "content": "<p>So the method to store backups for kill objects was to create a copy, hide the copy and then kill the object</p>",
        "id": 243875158,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624596248
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243267294\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span>  I have a doubt,  So right now undo code goes into the wrapper and for cmds like kill the backup should happen before the command runs, so if the input is wrong (like name of obj is wrong or wrong no args), problems arise. So how do I overcome this problem because bringing the arg checks into the wrapper will eliminate the purpose of wrappers.</p>\n</blockquote>\n<p>This is more or less the point of doing commands like g and make together with other commands like kill.  They really beg for a solution that is either not command specific or is very command specific (and thus duplicative).</p>",
        "id": 243875186,
        "sender_full_name": "Sean",
        "timestamp": 1624596301
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243875158\">said</a>:</p>\n<blockquote>\n<p>So the method to store backups for kill objects was to create a copy, hide the copy and then kill the object</p>\n</blockquote>\n<p>When this was done to a comb object, all its(the copy) children also got hidden since they were referenced as its children</p>",
        "id": 243875203,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624596328
    },
    {
        "content": "<p>Er, they did??  What mechanism did you use to hide them?</p>",
        "id": 243875217,
        "sender_full_name": "Sean",
        "timestamp": 1624596358
    },
    {
        "content": "<p>but they werent supposed to be hidden, rather displayed independently in the geometry tree, outside the comb object</p>",
        "id": 243875228,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624596363
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243875217\">said</a>:</p>\n<blockquote>\n<p>Er, they did??  What mechanism did you use to hide them?</p>\n</blockquote>\n<p>I changed the names of the leaves. Let me give an example</p>",
        "id": 243875265,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624596385
    },
    {
        "content": "<p>oh you mean the didn't show up on \"tops\" or ?</p>",
        "id": 243875266,
        "sender_full_name": "Sean",
        "timestamp": 1624596388
    },
    {
        "content": "<p>The example should make things clear 1 sec</p>",
        "id": 243875273,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624596404
    },
    {
        "content": "<p>say you have comb1 = comb2 u comb3  and comb2 = prim1 and comb3 =prim2 - prim3 ... now kill comb2</p>",
        "id": 243875285,
        "sender_full_name": "Sean",
        "timestamp": 1624596450
    },
    {
        "content": "<p>Lets say theres a comb.c with obj1.s, obj2.s, obj3.s<br>\nNow kill cmd is given<br>\nWe make a copy of comb.c, comb_copy.c and then hide comb_copy.c and kill comb.c<br>\nNow opening the geometry browser shows nothing, everything is hidden even though the objects shouldn't be hidden</p>",
        "id": 243875344,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624596508
    },
    {
        "content": "<p>You would expect to see<br>\nobj1.s<br>\nobj2.s<br>\nobj3.s <br>\nwhen we open the geom browser</p>",
        "id": 243875354,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624596535
    },
    {
        "content": "<p>but it shows to be empty, because the hide property applied to comb_copy.c is being applied to the objects as well</p>",
        "id": 243875362,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624596563
    },
    {
        "content": "<p>since comb_copy has the same children as comb.c</p>",
        "id": 243875367,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624596580
    },
    {
        "content": "<p>So I changed the names of the children of comb_copy.c to<br>\nobj1.s_undo_suffix, obj2.s_undo_suffix....</p>",
        "id": 243875420,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624596608
    },
    {
        "content": "<p>okay, I see what you're getting at.  to me that's a problem with the command that the geometry browser is using to get it's listing... ;)</p>",
        "id": 243875422,
        "sender_full_name": "Sean",
        "timestamp": 1624596610
    },
    {
        "content": "<p>and when recovering the backup i removed the sufffixes(plural for suffix whatever that is)</p>",
        "id": 243875437,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624596652
    },
    {
        "content": "<p>got it, understood.  that's certainly one possible solution, though I would probably opt for some form of opaque encoding as a way around that.   it'll be faster and less likely to cause problems with other commands.</p>\n<p>otherwise, the fix for the geometry browser is probably to make the tops command have a flag to ignore hidden objects, and make geometry browser use that flag.</p>",
        "id": 243875597,
        "sender_full_name": "Sean",
        "timestamp": 1624596870
    },
    {
        "content": "<p>I suggest trying the prior...</p>",
        "id": 243875671,
        "sender_full_name": "Sean",
        "timestamp": 1624597006
    },
    {
        "content": "<p>how are you copying the comb?</p>",
        "id": 243875673,
        "sender_full_name": "Sean",
        "timestamp": 1624597018
    },
    {
        "content": "<p>usin ged_copy</p>",
        "id": 243875688,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624597039
    },
    {
        "content": "<p>oof, okay. Hm.  So here's a challenge then.</p>",
        "id": 243875751,
        "sender_full_name": "Sean",
        "timestamp": 1624597106
    },
    {
        "content": "<p>instead of ged_copy, I suggest learning the lower-level librt api it uses .. and instead of copying the object, serialize it and save the serialization into a binunif object.</p>",
        "id": 243875783,
        "sender_full_name": "Sean",
        "timestamp": 1624597175
    },
    {
        "content": "<p>Okay.</p>",
        "id": 243875861,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624597254
    },
    {
        "content": "<p>let's see if I can explain it from memory correctly... what you'll do is similar logic that ged_copy is using where you first do a db_lookup() on the object, get its external form (which is basically just an array of bytes), and then instead of exporting that ... you'll create a hidden binunif (see mk_binunif) instead.</p>",
        "id": 243876036,
        "sender_full_name": "Sean",
        "timestamp": 1624597452
    },
    {
        "content": "<p>you might want to write a simple little test.c to figure out how to do that first</p>",
        "id": 243876064,
        "sender_full_name": "Sean",
        "timestamp": 1624597507
    },
    {
        "content": "<p>that will avoid the whole problem of needing to rewrite the comb (which won't scale to large combs), and avoid the issue of it getting detected in the hierarchy as a comb (so no problem for the geometry browser)</p>",
        "id": 243876096,
        "sender_full_name": "Sean",
        "timestamp": 1624597550
    },
    {
        "content": "<p>it's just a binary blob, sort of like how git handles commits</p>",
        "id": 243876143,
        "sender_full_name": "Sean",
        "timestamp": 1624597572
    },
    {
        "content": "<p>could even compress it later</p>",
        "id": 243876152,
        "sender_full_name": "Sean",
        "timestamp": 1624597584
    },
    {
        "content": "<p>That coincidentally will also let you supply additional flags like what type of undo object is that (a remove, an add, a change, etc), so you can infer how to undo it automatically without having to consult a ledger in _GLOBAL</p>",
        "id": 243876244,
        "sender_full_name": "Sean",
        "timestamp": 1624597689
    },
    {
        "content": "<p>Ill have to go through the code for this</p>",
        "id": 243876247,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624597692
    },
    {
        "content": "<p>I'll get  back once i read some documentation/code</p>",
        "id": 243876260,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624597708
    },
    {
        "content": "<p>how did you end up implementing g ?</p>",
        "id": 243876274,
        "sender_full_name": "Sean",
        "timestamp": 1624597747
    },
    {
        "content": "<p>Also all db5 objects have the attributes data struc, so we could specify data there as well</p>",
        "id": 243876280,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624597766
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243876274\">said</a>:</p>\n<blockquote>\n<p>how did you end up implementing g ?</p>\n</blockquote>\n<p>It was simple kill</p>",
        "id": 243876305,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624597804
    },
    {
        "content": "<p>that's what I meant about being able to specify additional flags for what type of undo object it is</p>",
        "id": 243876329,
        "sender_full_name": "Sean",
        "timestamp": 1624597815
    },
    {
        "content": "<p>Quite similar to the undo for make</p>",
        "id": 243876333,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624597820
    },
    {
        "content": "<p>So then that's not correct :)</p>",
        "id": 243876335,
        "sender_full_name": "Sean",
        "timestamp": 1624597827
    },
    {
        "content": "<p>also i dealt with the case where the g object already exists</p>",
        "id": 243876346,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624597846
    },
    {
        "content": "<p>yes?</p>",
        "id": 243876350,
        "sender_full_name": "Sean",
        "timestamp": 1624597859
    },
    {
        "content": "<p>Yeah</p>",
        "id": 243876357,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624597876
    },
    {
        "content": "<p>I mean ... explain please</p>",
        "id": 243876359,
        "sender_full_name": "Sean",
        "timestamp": 1624597882
    },
    {
        "content": "<p>So if the g already exists, then I just delete the last object added</p>",
        "id": 243876363,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624597898
    },
    {
        "content": "<p>added to the .g I mean</p>",
        "id": 243876366,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624597911
    },
    {
        "content": "<p>so multiobject functionality still isnt there</p>",
        "id": 243876408,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624597928
    },
    {
        "content": "<p>Interesting, okay.  So you really went the custom-command direction..</p>",
        "id": 243876411,
        "sender_full_name": "Sean",
        "timestamp": 1624597933
    },
    {
        "content": "<p>but it works for single object additions</p>",
        "id": 243876413,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624597937
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243876411\">said</a>:</p>\n<blockquote>\n<p>Interesting, okay.  So you really went the custom-command direction..</p>\n</blockquote>\n<p>Not so much</p>",
        "id": 243876454,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624598026
    },
    {
        "content": "<p>I stored it as a change ot the g</p>",
        "id": 243876456,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624598035
    },
    {
        "content": "<p>So i stored a copy of the g before the addition and then recovered it</p>",
        "id": 243876500,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624598060
    },
    {
        "content": "<p>It's custom in the sense that you're relying on precise knowledge of the 'g' command adding objects to the end of the list.</p>",
        "id": 243876506,
        "sender_full_name": "Sean",
        "timestamp": 1624598075
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243876408\">said</a>:</p>\n<blockquote>\n<p>so multiobject functionality still isnt there</p>\n</blockquote>\n<p>My bad, this is there since Im storing prev state and recovering</p>",
        "id": 243876521,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624598084
    },
    {
        "content": "<p>which is why you would need additional logic to make it work for multiple objects<br>\nor why you'd need additional logic if there was a switch that added to the front of the list, or a position, or replaces an entry, etc</p>",
        "id": 243876541,
        "sender_full_name": "Sean",
        "timestamp": 1624598121
    },
    {
        "content": "<p>It's various modes was kind of the point of that command.  It's tricky to make it handle both create and change events cleanly that way.</p>",
        "id": 243876594,
        "sender_full_name": "Sean",
        "timestamp": 1624598172
    },
    {
        "content": "<p>Do you have ideas on how that could be implemented differently?</p>",
        "id": 243876605,
        "sender_full_name": "Sean",
        "timestamp": 1624598214
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243876594\">said</a>:</p>\n<blockquote>\n<p>It's various modes was kind of the point of that command.  It's tricky to make it handle both create and change events cleanly that way.</p>\n</blockquote>\n<p>It has only 2 modes right?<br>\ncreate and add?</p>",
        "id": 243876624,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624598251
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243876541\">said</a>:</p>\n<blockquote>\n<p>which is why you would need additional logic to make it work for multiple objects<br>\nor why you'd need additional logic if there was a switch that added to the front of the list, or a position, or replaces an entry, etc</p>\n</blockquote>\n<p>I did not get this entirely</p>",
        "id": 243876674,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624598303
    },
    {
        "content": "<p>What is the list you are referring to?</p>",
        "id": 243876678,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624598314
    },
    {
        "content": "<p>the comb recipe</p>",
        "id": 243876688,
        "sender_full_name": "Sean",
        "timestamp": 1624598332
    },
    {
        "content": "<p>comb1 = obj1 u obj2 u obj3 - obj4 u obj5, etc.. it can be thought of as a stack or a list</p>",
        "id": 243876700,
        "sender_full_name": "Sean",
        "timestamp": 1624598363
    },
    {
        "content": "<p>Okay</p>",
        "id": 243876715,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624598373
    },
    {
        "content": "<p>Right now the code doesnt depend on the order of the list if you were wodnering</p>",
        "id": 243876745,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624598393
    },
    {
        "content": "<p>Im storing the whole .g object and then replacing it</p>",
        "id": 243876795,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624598409
    },
    {
        "content": "<p>Oh?  I thought you just said it doesn't handle N objects getting added?</p>",
        "id": 243876812,
        "sender_full_name": "Sean",
        "timestamp": 1624598445
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243876521\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243876408\">said</a>:</p>\n<blockquote>\n<p>so multiobject functionality still isnt there</p>\n</blockquote>\n<p>My bad, this is there since Im storing prev state and recovering</p>\n</blockquote>\n<p>.</p>",
        "id": 243876813,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624598462
    },
    {
        "content": "<p>I got confused at first, but I checked the code now. Im dealing with it as a change in an object</p>",
        "id": 243876827,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624598511
    },
    {
        "content": "<p>So entire .g gets replaced</p>",
        "id": 243876834,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624598519
    },
    {
        "content": "<p>Ah, excellent then.  That's good.</p>",
        "id": 243876873,
        "sender_full_name": "Sean",
        "timestamp": 1624598529
    },
    {
        "content": "<p>So in a way the code has only been customised for the modes of the g cmd</p>",
        "id": 243876877,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624598539
    },
    {
        "content": "<p>and not for the specific addition</p>",
        "id": 243876884,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624598549
    },
    {
        "content": "<p>excellent, because I think that is the basis of what you need next...</p>",
        "id": 243876892,
        "sender_full_name": "Sean",
        "timestamp": 1624598569
    },
    {
        "content": "<p>so what commands do you presently have?  make + g + kill ?</p>",
        "id": 243876906,
        "sender_full_name": "Sean",
        "timestamp": 1624598606
    },
    {
        "content": "<p>So most commands that have a make function like cp, mirror, cpi,arb</p>",
        "id": 243876909,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624598634
    },
    {
        "content": "<p>I have undo for move</p>",
        "id": 243876924,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624598643
    },
    {
        "content": "<p>I have general code for a changed object but has been applied only for the g command as of now</p>",
        "id": 243876953,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624598668
    },
    {
        "content": "<p>And yes kill but only single object</p>",
        "id": 243876965,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624598685
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243876909\">said</a>:</p>\n<blockquote>\n<p>So most commands that have a make function like cp, mirror, cpi,arb</p>\n</blockquote>\n<p>Is that because they call ged_make() ? or did you edit them?</p>",
        "id": 243876982,
        "sender_full_name": "Sean",
        "timestamp": 1624598735
    },
    {
        "content": "<p>deleted</p>",
        "id": 243876986,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624598753
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243876982\">said</a>:</p>\n<blockquote>\n<p>Is that because they call ged_make() ? or did you edit them?</p>\n</blockquote>\n<p>I edited their wrappers</p>",
        "id": 243877029,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624598770
    },
    {
        "content": "<p>did they have a common wrapper or multiple wrappers or?</p>",
        "id": 243877036,
        "sender_full_name": "Sean",
        "timestamp": 1624598806
    },
    {
        "content": "<p>common wrapper, i added an if statement</p>",
        "id": 243877040,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624598819
    },
    {
        "content": "<p>coz there was no point creating a new wrapper for just 3 more lines</p>",
        "id": 243877046,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624598832
    },
    {
        "content": "<p>okay, not so bad then.  will probably need to rework that, but it's at least isolated.</p>",
        "id": 243877051,
        "sender_full_name": "Sean",
        "timestamp": 1624598843
    },
    {
        "content": "<p>so the next steps I think are:</p>",
        "id": 243877127,
        "sender_full_name": "Sean",
        "timestamp": 1624598919
    },
    {
        "content": "<p>1) figuring out how to use binunif as the storage object</p>",
        "id": 243877132,
        "sender_full_name": "Sean",
        "timestamp": 1624598922
    },
    {
        "content": "<p>2) making commands emit events for add/change/remove</p>",
        "id": 243877162,
        "sender_full_name": "Sean",
        "timestamp": 1624598972
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243877162\">said</a>:</p>\n<blockquote>\n<p>2) making commands emit events for add/change/remove</p>\n</blockquote>\n<p>Where do they emit though?<br>\nto the attributes of the object?</p>",
        "id": 243877324,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624599178
    },
    {
        "content": "<p>and also we would want the emit code to be in the wrapper, right?</p>",
        "id": 243877339,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624599213
    },
    {
        "content": "<p>figuring out #2 is going to be the more complicated as there are choices, but how about this:</p>",
        "id": 243877341,
        "sender_full_name": "Sean",
        "timestamp": 1624599214
    },
    {
        "content": "<p>have three functions ged_undo_add(), ged_undo_remove(), and ged_undo_change() that do the actual work given an object name.  then probably modifying GED_DB_PUT_INTERNAL.</p>",
        "id": 243877653,
        "sender_full_name": "Sean",
        "timestamp": 1624599634
    },
    {
        "content": "<p>and THEN ... you'll almost certainly have to introduce something for removals</p>",
        "id": 243877668,
        "sender_full_name": "Sean",
        "timestamp": 1624599658
    },
    {
        "content": "<p>as there's not a GED_DB_DELETE() but probably should be where you'd record the event</p>",
        "id": 243877687,
        "sender_full_name": "Sean",
        "timestamp": 1624599697
    },
    {
        "content": "<p>so for GED_DB_PUT_INTERNAL and GED_DB_DELETE, you just record the change/add/delete event into the struct ged *</p>",
        "id": 243877741,
        "sender_full_name": "Sean",
        "timestamp": 1624599734
    },
    {
        "content": "<p>then you handle the entire undo changeset recorded after the command has completed (basically a wrapper around all the wrappers)</p>",
        "id": 243877750,
        "sender_full_name": "Sean",
        "timestamp": 1624599773
    },
    {
        "content": "<p>I dint get where to record it, as an attribute to _GLOBAL?</p>",
        "id": 243877761,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624599792
    },
    {
        "content": "<p>No, I mean you could, but probably not as that's brittle.  So yeah, next step 1.5) change from using _GLOBAL to using struct ged and the undo objects.</p>",
        "id": 243877889,
        "sender_full_name": "Sean",
        "timestamp": 1624599959
    },
    {
        "content": "<p>welcome to keep it on _GLOBAL for now as that's not a critical step</p>",
        "id": 243877965,
        "sender_full_name": "Sean",
        "timestamp": 1624600034
    },
    {
        "content": "<p>Right now Im emitting changes for single objects</p>",
        "id": 243877977,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624600062
    },
    {
        "content": "<p>So doing it for multiple objects is the task now, right?</p>",
        "id": 243877987,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624600073
    },
    {
        "content": "<p>Right, so that all would completely change in _GLOBAL anyways, that's part of the reason to figure out a different container in struct ged anyways</p>",
        "id": 243878029,
        "sender_full_name": "Sean",
        "timestamp": 1624600090
    },
    {
        "content": "<p>But I havent been able to do that in ged</p>",
        "id": 243878157,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624600269
    },
    {
        "content": "<p>That was the starting point in my GSoC jouney hehe</p>",
        "id": 243878164,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624600284
    },
    {
        "content": "<p>yeah, I remember :)</p>",
        "id": 243878182,
        "sender_full_name": "Sean",
        "timestamp": 1624600306
    },
    {
        "content": "<p>the hope is that you're now a lot more experienced with the structures and functions to understand some of the implications</p>",
        "id": 243878188,
        "sender_full_name": "Sean",
        "timestamp": 1624600322
    },
    {
        "content": "<p>I mean, it doesn't need to be fancy.  shouldn't be fancy.  It can be a simple linear list of object additions, changes, and removals.  something like a linked list of struct ged_change { enum type; const char *obj; } and struct ged would have a struct ged_change *gcp; that is acted upon by GED_DB_PUT_INTERANL, GED_DB_DELETE, and maybe others.</p>",
        "id": 243878272,
        "sender_full_name": "Sean",
        "timestamp": 1624600413
    },
    {
        "content": "<p>the big piece missing is a place to inject logic before and after commands are run.  this exists -- it's ged_exec() but mged coincidentally does not call that yet.  so we might need to sort that out first... so maybe step 3 instead of 1.5...</p>",
        "id": 243878620,
        "sender_full_name": "Sean",
        "timestamp": 1624600832
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243878620\">said</a>:</p>\n<blockquote>\n<p>sort that out first... so maybe step 3 </p>\n</blockquote>\n<p>first or third?</p>",
        "id": 243878667,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624600909
    },
    {
        "content": "<p>I don't know if it's helpful for this discussion, but for qged I added a flag in struct directory called \"edit_flag\" which is set by db_put_external.  That's how I'm able to know I need to update the visuals for objects in qged after a ged command is run - I zero out all directory edit_flags, run the command, and then check to see if any of them were tripped.  Anything with the flag set needs to get redrawn.</p>\n<p>This may not be suitable for the undo mechanism, but at least for my purposes it is simple and effective - I don't have to care about the details of what the logic called by ged_exec did, so I'm completely isolated from any command logic or command changes.</p>",
        "id": 243908281,
        "sender_full_name": "starseeker",
        "timestamp": 1624623980
    },
    {
        "content": "<p>Yes, I do think that helps. I am trying to do something similar but maybe to the ged data struc.</p>",
        "id": 243924263,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624631752
    },
    {
        "content": "<p>The advantage of db_put_external is that anything writing to the .g file is going to go through there.</p>",
        "id": 243928181,
        "sender_full_name": "starseeker",
        "timestamp": 1624633531
    },
    {
        "content": "<p>The \"do I need to draw\" problem for the UI is similar to undo, in that sense.  libtclcad and MGED handle it by defining different types of wrapper functions and assigning one to each command, which is less than ideal.</p>",
        "id": 243928451,
        "sender_full_name": "starseeker",
        "timestamp": 1624633664
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243267294\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span>  I have a doubt,  So right now undo code goes into the wrapper and for cmds like kill the backup should happen before the command runs, so if the input is wrong (like name of obj is wrong or wrong no args), problems arise. So how do I overcome this problem because bringing the arg checks into the wrapper will eliminate the purpose of wrappers.</p>\n</blockquote>\n<p>I see you have reacted to this with a smile <span aria-label=\"joy\" class=\"emoji emoji-1f602\" role=\"img\" title=\"joy\">:joy:</span>  , does that mean I got to solve this on my own? <br>\nWell I can by bringing the options code into the wrapper but all common wrappers would then get a switch or an if/else to check for the inputs</p>",
        "id": 243944712,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624641399
    },
    {
        "content": "<p>When creating the binuif what data type should I input float, double, 32bit init, etc?</p>",
        "id": 243954688,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624646602
    },
    {
        "content": "<p>As far as I understand it doesn't directly affect whichever data type I use, but please let me know if there are some do's/dont's on which type to select</p>",
        "id": 243954821,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624646666
    },
    {
        "content": "<p>&lt;deleted&gt;</p>",
        "id": 243976605,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624658898
    },
    {
        "content": "<p>&lt;deleted&gt;</p>",
        "id": 243976634,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624658926
    },
    {
        "content": "<p>&lt;deleted&gt;</p>",
        "id": 243976802,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624659087
    },
    {
        "content": "<p>&lt;deleted&gt;</p>",
        "id": 243977596,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624659755
    },
    {
        "content": "<p>Which kind of objects have major type as BINARY_MASK? <br>\nRight now my simple tests stops because the object im trying to convert doesnt have majortype binary_mask</p>",
        "id": 243978596,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624660659
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243878667\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243878620\">said</a>:</p>\n<blockquote>\n<p>sort that out first... so maybe step 3 </p>\n</blockquote>\n<p>first or third?</p>\n</blockquote>\n<p>third.  it has to be sorted out before you can utilize ged_exec, but the other parts are more important for geting set up for improving the object backup scheme.</p>",
        "id": 243994878,
        "sender_full_name": "Sean",
        "timestamp": 1624683232
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112516\">starseeker</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243908281\">said</a>:</p>\n<blockquote>\n<p>I don't know if it's helpful for this discussion, but for qged I added a flag in struct directory called \"edit_flag\" which is set by db_put_external.  That's how I'm able to know I need to update the visuals for objects in qged after a ged command is run - I zero out all directory edit_flags, run the command, and then check to see if any of them were tripped.  Anything with the flag set needs to get redrawn.</p>\n<p>This may not be suitable for the undo mechanism, but at least for my purposes it is simple and effective - I don't have to care about the details of what the logic called by ged_exec did, so I'm completely isolated from any command logic or command changes.</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"112516\">@starseeker</span> ... really hate to say it, but that is a straight up scope violation for that structure.  I mean I get how and why it works and why you thought to put it there, but I do not think it's right from a design perspective.   I hadn't seen that commit yet or I would thought it worth discussion. </p>\n<p>To frame it by way of an analogy, it's like cleaning staff putting stickers or sharpie circles around stores on the public directory kiosk in mall to help keep track of which stores have been cleaned recently.  Sure it works for them, works GREAT for them... but that's in no way what the directory is for and is irrelevant/distracting/confusing to essentially everyone else.</p>\n<p>In CS terms, it's a data specialization that doesn't intrinsically fit the structure (from both an OO perspective or a data-driven procedural perspective).  It's also couping a new concept (a notion of edit state and/or views) to what was otherwise a pure database construct with no awareness or linkage to views, edit state, interface.  Def minor point, but it's also a waste of a couple bytes per object, so it's that much more pressure on memory use, cache misses, context switch overhead.</p>\n<p>Now that's not to suggest that another structure is more appropriate, it's specifically the notion of what an edit flag means in a general sense on a directory entry.  Is a non-zero value supposed to mean recently edited?  What constitutes recently?  What does a value of -8 mean?  Directory structs were stateless, and that appears to be some sort of live state -- so when does it change?  Can my code change it? </p>\n<p>You can probably achieve the same effect by using the u_data pointer or by adding a callback so calling code is notified when something happens to the directory entry.</p>",
        "id": 243996044,
        "sender_full_name": "Sean",
        "timestamp": 1624685167
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112516\">starseeker</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243928181\">said</a>:</p>\n<blockquote>\n<p>The advantage of db_put_external is that anything writing to the .g file is going to go through there.</p>\n</blockquote>\n<p>I think that's too low-level.  At least, I do not see undo as an intrinsic feature of the .g, and would not belong in \"libg\" if it existed (thus doesn't belong in librt currently).  It's a higher level application-level construct, thus belongs somewhere in libged or higher.</p>\n<p>As we think of undoing commands, that to me says libged is the most appropriate place for the logic to reside and/or be registered.   If I run a killtree, I'd expect  undo to reverse the entire killtree in one step as a single transaction (which is a concept librt/libg knows nothing about).  It might conceptually fit if we introduced transactions to librt/libg, but that's unquestionably in scope for libged today where the killtree command exists, where it's aware of the set of things it's going to change.</p>",
        "id": 243996359,
        "sender_full_name": "Sean",
        "timestamp": 1624685797
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243944712\">said</a>:</p>\n<blockquote>\n<p>I see you have reacted to this with a smile <span aria-label=\"joy\" class=\"emoji emoji-1f602\" role=\"img\" title=\"joy\">:joy:</span>  , does that mean I got to solve this on my own? <br>\nWell I can by bringing the options code into the wrapper but all common wrappers would then get a switch or an if/else to check for the inputs</p>\n</blockquote>\n<p>I responded to the doubt/statement a little further down.  \"This is more or less the point of doing commands like g and make together with other commands like kill. They really beg for a solution that is either not command specific or is very command specific (and thus duplicative).\"</p>\n<p>You can't bring the options code into the wrapper.</p>",
        "id": 243996480,
        "sender_full_name": "Sean",
        "timestamp": 1624686041
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243978596\">said</a>:</p>\n<blockquote>\n<p>Which kind of objects have major type as BINARY_MASK? <br>\nRight now my simple tests stops because the object im trying to convert doesnt have majortype binary_mask</p>\n</blockquote>\n<p>None have BINARY_MASK... that's a bit mask, so it matches DB5_MAJORTYPE_BINARY_UNIF and DB5_MAJORTYPE_BINARY_MIME is all.</p>",
        "id": 243996751,
        "sender_full_name": "Sean",
        "timestamp": 1624686542
    },
    {
        "content": "<p>You'll want to create a DB5_MAJORTYPE_BINARY_UNIF with just bytes (or maybe ubytes).  You have an array of bytes after you get external.  You're just putting that array of bytes into a binunif object (which is a lot like a BLOB object type if you're familiar with those).</p>",
        "id": 243996808,
        "sender_full_name": "Sean",
        "timestamp": 1624686645
    },
    {
        "content": "<p>mk_binunif should create the type correctly for you -- you just provide the char* and number of bytes.</p>",
        "id": 243996817,
        "sender_full_name": "Sean",
        "timestamp": 1624686677
    },
    {
        "content": "<p>I have successfully written a basic test to use mk_binunif() and create a binary object from an geometry object</p>",
        "id": 244027973,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624732048
    },
    {
        "content": "<p>I have read the code in bo cmd, but that is to write the bin object to a file<br>\nIm checking how to recover the object</p>",
        "id": 244029073,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624733807
    },
    {
        "content": "<p>Is there an already implemented way to convert these binary objects back to database objects?</p>",
        "id": 244031667,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624737571
    },
    {
        "content": "<p>I got vaccinated today so I'm feeling under the weather  and won't be working today <br>\nThis week progress has been a little slow, so plan is to catch up next week<br>\nRn Im still stuck at converting the binary object back to a drawable object</p>",
        "id": 244077284,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624816273
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"353338\">@Vikram Atreya</span> Glad to hear that!  Not that you're unwell of course, but it's a good form of unwell overall.  Hope you get some rest and are better today.</p>",
        "id": 244106019,
        "sender_full_name": "Sean",
        "timestamp": 1624861737
    },
    {
        "content": "<p>Yeah Im feeling better today <span aria-label=\"grinning\" class=\"emoji emoji-1f600\" role=\"img\" title=\"grinning\">:grinning:</span></p>",
        "id": 244106051,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624861802
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/244031667\">said</a>:</p>\n<blockquote>\n<p>Is there an already implemented way to convert these binary objects back to database objects?</p>\n</blockquote>\n<p>I'm not sure we have code, but the gist is to do a lookup, get the rt_db_internal, then cast the idb_ptr (which will be an struct rt_binunif_internal*), then simply access the bip-&gt;u.uint8 which will be the bytes you packed.</p>",
        "id": 244106226,
        "sender_full_name": "Sean",
        "timestamp": 1624861967
    },
    {
        "content": "<p>So just copy the bip-&gt;u.uint8 into the new the drawable object's internal</p>",
        "id": 244107692,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624863439
    },
    {
        "content": "<p>Done!<br>\nI  have been able to store an object into binary object and recover the object back if we know its type(ell, arb, etc)</p>",
        "id": 244216802,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624922490
    },
    {
        "content": "<p>When storing the backup of an object, we could store the name and type as attributes of the binary object</p>",
        "id": 244217045,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624922719
    },
    {
        "content": "<p>Now Im working on changing the code of kill wrapper, so that backup is made via binary objects</p>",
        "id": 244219727,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624925427
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/244219727\">said</a>:</p>\n<blockquote>\n<p>Now Im working on changing the code of kill wrapper, so that backup is made via binary objects</p>\n</blockquote>\n<p>I have done for combination objects, can be done for all objects as well but the code will be very long mostly due to the memory allocation switch , and as there is no problem right now in storing them as normal objects should/can I leave it like that?</p>",
        "id": 244221891,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624928065
    },
    {
        "content": "<p>Made changes to g wrapper and undo to store and recover from binary objects respectively</p>",
        "id": 244223596,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624929959
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/243877162\">said</a>:</p>\n<blockquote>\n<p>2) making commands emit events for add/change/remove</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"102902\">@Sean</span> could you better explain the scope of this step?<br>\nRn Im already storing latest_change, last_create/last_killed/last_changed attributes in _GLOBAL for cmds (make, g, arb, etc; kill, killall; )</p>",
        "id": 244224306,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624930909
    },
    {
        "content": "<p>Should I do this for all cmds that are available?</p>",
        "id": 244224358,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624930943
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/244217045\">said</a>:</p>\n<blockquote>\n<p>When storing the backup of an object, we could store the name and type as attributes of the binary object</p>\n</blockquote>\n<p>That should happen for you automatically when you get the external... the bytes for the object that you put into the binunif should be the external stream that is serialized to disk.  That has the name and type information.</p>",
        "id": 244232405,
        "sender_full_name": "Sean",
        "timestamp": 1624940951
    },
    {
        "content": "<p>Check out an example for doing this in src/gtools/gtransfer.c .. the server_geom() function and a couple others do something similar.</p>",
        "id": 244232421,
        "sender_full_name": "Sean",
        "timestamp": 1624940991
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/244232405\">said</a>:</p>\n<blockquote>\n<p>That should happen for you automatically when you get the external... the bytes for the object that you put into the binunif should be the external stream that is serialized to disk.  That has the name and type information.</p>\n</blockquote>\n<p>Okay. As of now Im storing the rt_db_internal in the binunif. Intially I was storing the external</p>\n<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/244106226\">said</a>:</p>\n<blockquote>\n<p>I'm not sure we have code, but the gist is to do a lookup, get the rt_db_internal, then cast the idb_ptr (which will be an struct rt_binunif_internal*), then simply access the bip-&gt;u.uint8 which will be the bytes you packed.</p>\n</blockquote>\n<p>But after I read this I changed everything to internal</p>",
        "id": 244232499,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624941119
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/244224358\">said</a>:</p>\n<blockquote>\n<p>Should I do this for all cmds that are available?</p>\n</blockquote>\n<p>Definitely not as it's still fundamentally flawed in terms of undoing commands that result in sequences of changes.</p>",
        "id": 244232565,
        "sender_full_name": "Sean",
        "timestamp": 1624941205
    },
    {
        "content": "<p>You can store the internal too, but then like you noted, you'll also have to store more information and that then couples the implementation tightly to the current data structure instead of to API.</p>",
        "id": 244232739,
        "sender_full_name": "Sean",
        "timestamp": 1624941480
    },
    {
        "content": "<p>Better is to either convert the internal to an external or do a lookup and get an external from the directory* via db_get_external().</p>",
        "id": 244232794,
        "sender_full_name": "Sean",
        "timestamp": 1624941520
    },
    {
        "content": "<p>Yes I realize storing external is a better option</p>",
        "id": 244232797,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624941524
    },
    {
        "content": "<p>gtransfer uses that method in the client to get an external from db_get_external(), and in the server, it does some fancy processing to stash the object into an in-memory only database so it can raytrace it without touching the disk.</p>",
        "id": 244232989,
        "sender_full_name": "Sean",
        "timestamp": 1624941785
    },
    {
        "content": "<p>Changed it from storing the internal data to bu_external<br>\nEncountered a lot of bugs so took quite some time <span aria-label=\"sweat\" class=\"emoji emoji-1f613\" role=\"img\" title=\"sweat\">:sweat:</span></p>",
        "id": 244343758,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1624998851
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/244232565\">said</a>:</p>\n<blockquote>\n<p>Definitely not as it's still fundamentally flawed in terms of undoing commands that result in sequences of changes.</p>\n</blockquote>\n<p>Like for cmd killtree?  a kill event should be stores for every object it is deleting ?</p>",
        "id": 244349257,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625001506
    },
    {
        "content": "<p>I am also planning to do code cleaning and testing at the end of this week and create a PR which can robustly handle 1 undo for (make&amp;co-cmds), kill and g</p>",
        "id": 244349457,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625001605
    },
    {
        "content": "<p>Yeah a command like killtree.  Somewhere somehow they need to be grouped, so the command can be undone, not individual objects.</p>\n<p>I'd suggest we think of it simply as a change event which is a sequence of 1 or more add/edit/kill changes to the database.</p>",
        "id": 244351677,
        "sender_full_name": "Sean",
        "timestamp": 1625002862
    },
    {
        "content": "<p>I can think of a couple ways to easily achieve that type of storage.  You could write out every object like you're doing now as a binunif for example representing the add/edit/kill action, but then list them in an object that is also serialized to a binunif.  So when you try to undo that object, you see it's a list of changes, and undo all those subchanges.</p>",
        "id": 244352133,
        "sender_full_name": "Sean",
        "timestamp": 1625003139
    },
    {
        "content": "<p>but we will always need a list of all the objects that have to be deleted/overwritten right?</p>",
        "id": 244352410,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625003291
    },
    {
        "content": "<p>because we do not know the names of the objects till we extract the binary object</p>",
        "id": 244352431,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625003308
    },
    {
        "content": "<p>or added back</p>",
        "id": 244352434,
        "sender_full_name": "Sean",
        "timestamp": 1625003310
    },
    {
        "content": "<p>you actually could put the name on the binary object if you want as an attribute</p>",
        "id": 244352511,
        "sender_full_name": "Sean",
        "timestamp": 1625003369
    },
    {
        "content": "<p>that way you don't have to unpack the binunif to figure out what's in there</p>",
        "id": 244352530,
        "sender_full_name": "Sean",
        "timestamp": 1625003382
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/244352511\">said</a>:</p>\n<blockquote>\n<p>you actually could put the name on the binary object if you want as an attribute</p>\n</blockquote>\n<p>Yeah Im doing that right now</p>",
        "id": 244352540,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625003390
    },
    {
        "content": "<p>or even use some sort of name convention</p>",
        "id": 244352553,
        "sender_full_name": "Sean",
        "timestamp": 1625003397
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/244352133\">said</a>:</p>\n<blockquote>\n<p>I can think of a couple ways to easily achieve that type of storage.  You could write out every object like you're doing now as a binunif for example representing the add/edit/kill action, but then list them in an object that is also serialized to a binunif.  So when you try to undo that object, you see it's a list of changes, and undo all those subchanges.</p>\n</blockquote>\n<p>but for this we will have to store the changes somewhere or the name will be toooo long</p>",
        "id": 244352634,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625003430
    },
    {
        "content": "<p>e.g., .1.undo.HASH.my_object  might be the 1st undo action, pertaining to my_object</p>",
        "id": 244352682,
        "sender_full_name": "Sean",
        "timestamp": 1625003468
    },
    {
        "content": "<p>.392.undo.20194e9678ff7a08df564c3f83a4bd86.my_object</p>",
        "id": 244352750,
        "sender_full_name": "Sean",
        "timestamp": 1625003522
    },
    {
        "content": "<p>392 undo action, also some change/rm/add to my_object</p>",
        "id": 244352816,
        "sender_full_name": "Sean",
        "timestamp": 1625003544
    },
    {
        "content": "<p>Just checking, Here the number is referring to the undo step in the database and not specific to the object</p>",
        "id": 244353075,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625003699
    },
    {
        "content": "<p>so what I was saying about combs is a little different.  that'd be something like .123.undo.HASH and inside that binunif object is a list of .122.undo.HASH, .121.undo.HASH, .120.undo.HASH, and .117.undo.HASH for example.  and you'd recursively unpack the binunifs of 122, 121, 120, and 117 to make sure the entire 123 set can be undone.  (say 120 is also a set too of 119 and 118 to undo).</p>",
        "id": 244353195,
        "sender_full_name": "Sean",
        "timestamp": 1625003763
    },
    {
        "content": "<p>yeah, it's just the undo sequence</p>",
        "id": 244353270,
        "sender_full_name": "Sean",
        "timestamp": 1625003783
    },
    {
        "content": "<p>though I should make clear ... it doesn't have to be like this -- this is just spitballing ideas quickly!</p>",
        "id": 244353312,
        "sender_full_name": "Sean",
        "timestamp": 1625003808
    },
    {
        "content": "<p>you just somehow ideally need to look at a set of undo objects and 1) know which was the latest, and 2) know the sequential ordering of all objects</p>",
        "id": 244353418,
        "sender_full_name": "Sean",
        "timestamp": 1625003871
    },
    {
        "content": "<p>This feels like a good idea, I will parallelly think of other ideas as well</p>",
        "id": 244353432,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625003882
    },
    {
        "content": "<p>that way we can always undo or undo -n10 or whatever</p>",
        "id": 244353481,
        "sender_full_name": "Sean",
        "timestamp": 1625003891
    },
    {
        "content": "<p>knowing the sequence would also let us cherry pick undo actions, BUT then we'll have to think through how to deal with object renamings</p>",
        "id": 244353553,
        "sender_full_name": "Sean",
        "timestamp": 1625003940
    },
    {
        "content": "<p>if they're always sequential, that in theory shouldn't be an issue ... I think</p>",
        "id": 244353593,
        "sender_full_name": "Sean",
        "timestamp": 1625003960
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/244353593\">said</a>:</p>\n<blockquote>\n<p>if they're always sequential, that in theory shouldn't be an issue ... I think</p>\n</blockquote>\n<p>yes, if we go back undoing every change it will also account for the renaming</p>",
        "id": 244353660,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625003990
    },
    {
        "content": "<p>It still will probably need to check though, because some external program could have modified the database outside of libged</p>",
        "id": 244354089,
        "sender_full_name": "Sean",
        "timestamp": 1625004201
    },
    {
        "content": "<p>it just might not be able to undo, or might be only able to partially undo and such.</p>",
        "id": 244354135,
        "sender_full_name": "Sean",
        "timestamp": 1625004234
    },
    {
        "content": "<p>If it is not too much overload, names of all existing object could be stores at each step and extra objects could be deleted after the undo</p>",
        "id": 244354302,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625004328
    },
    {
        "content": "<p>Thats an interesting idea.  I'm not sure it'd scale well but maybe... would require testing on real/big databases.</p>",
        "id": 244354471,
        "sender_full_name": "Sean",
        "timestamp": 1625004411
    },
    {
        "content": "<p>If you want to make a fake real one to play with, you can run something like the clone command and make a 10 x 10 grid of copies in a scene of some database like m35, and then group them all into a scene.  That should be something like 50k objects total of which about 23k are combinations.  That's more realistic.</p>",
        "id": 244355449,
        "sender_full_name": "Sean",
        "timestamp": 1625005010
    },
    {
        "content": "<p>Next I will try working on killtree then</p>",
        "id": 244356398,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625005589
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"353338\">@Vikram Atreya</span> Here's a copy of the m35 patterned into a grid that is closer to the complexity found in a fully detailed model.  <br>\n<a href=\"/user_uploads/1549/ZLFtaRZkamtSzzYJgo9JRnRk/m35s.g.gz\">m35s.g.gz</a></p>",
        "id": 244382596,
        "sender_full_name": "Sean",
        "timestamp": 1625034918
    },
    {
        "content": "<p><a href=\"/user_uploads/1549/QJucHhnYtmXKsNOzWHi-cVYq/Screen-Shot-2021-06-30-at-2.31.26-AM.png\">Screen-Shot-2021-06-30-at-2.31.26-AM.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/1549/QJucHhnYtmXKsNOzWHi-cVYq/Screen-Shot-2021-06-30-at-2.31.26-AM.png\" title=\"Screen-Shot-2021-06-30-at-2.31.26-AM.png\"><img src=\"/user_uploads/1549/QJucHhnYtmXKsNOzWHi-cVYq/Screen-Shot-2021-06-30-at-2.31.26-AM.png\"></a></div>",
        "id": 244382606,
        "sender_full_name": "Sean",
        "timestamp": 1625034928
    },
    {
        "content": "<p>It's about 90k objects, about half of which are combinations.  It's still not representative of the file size and memory pressures as this is not a NURBS or BoT model, which use a LOT more memory, but it does at least use about 1.3GB.</p>",
        "id": 244382707,
        "sender_full_name": "Sean",
        "timestamp": 1625035028
    },
    {
        "content": "<p>It'll still load fast, but you'll probably find some commands get noticably slower (e.g., killtree on just one of the m35 copies in there is excrutiatingly slow... do not try it on any of the levels or you may end up waiting a long whilte).</p>",
        "id": 244382797,
        "sender_full_name": "Sean",
        "timestamp": 1625035129
    },
    {
        "content": "<p>So I shoud test this by storing the names of all the objects and then taking note of the time and space used</p>",
        "id": 244382888,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625035233
    },
    {
        "content": "<p>It depends</p>",
        "id": 244382925,
        "sender_full_name": "Sean",
        "timestamp": 1625035290
    },
    {
        "content": "<p>You were talking about maybe storing the name of every object before a command runs.  This type of db will tell you quickly if that is at all feasible.</p>",
        "id": 244382998,
        "sender_full_name": "Sean",
        "timestamp": 1625035352
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/244382998\">said</a>:</p>\n<blockquote>\n<p>You were talking about maybe storing the name of every object before a command runs.  This type of db will tell you quickly if that is at all feasible.</p>\n</blockquote>\n<p>Yes</p>",
        "id": 244383019,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625035388
    },
    {
        "content": "<p>It's a good test case to make sure undo doesn't have some fundamental limitation</p>",
        "id": 244383021,
        "sender_full_name": "Sean",
        "timestamp": 1625035390
    },
    {
        "content": "<p>My bad, but could you reiterate the task(s) that I have to do next <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> <br>\nThis check for name stroing is a pretty small task, so what can i do after that</p>",
        "id": 244383243,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625035611
    },
    {
        "content": "<p>A good test object in there is \"suspension\" which is one of the corner vehicles with about 400 regions and 400 primitives.</p>",
        "id": 244383327,
        "sender_full_name": "Sean",
        "timestamp": 1625035688
    },
    {
        "content": "<p>Tasks next: 1) First, run this sequence -- make+make+kill+make+kill+kill -- and then make sure you can undo+undo+undo+undo+undo and end up with just the first make</p>",
        "id": 244383521,
        "sender_full_name": "Sean",
        "timestamp": 1625035883
    },
    {
        "content": "<p>2) If you're still using _GLOBAL, switch to using some other convention.  ideally, make it so undo command knows how many undo  actions there are and/or what the next one is</p>",
        "id": 244383650,
        "sender_full_name": "Sean",
        "timestamp": 1625036000
    },
    {
        "content": "<p>3) get killtree working so a single undo undoes the whole kill</p>",
        "id": 244383732,
        "sender_full_name": "Sean",
        "timestamp": 1625036051
    },
    {
        "content": "<p>Doing task 2 before task 1 will be better in my opinion because the no of undos, last change data will have to be stored in the new place/convention. If I do task 1 again I will have to rewrite code of undo according to the new convention</p>",
        "id": 244468203,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625077765
    },
    {
        "content": "<p>An idea is to store a stack/array as the data of a binary object and have it contain all the information on undos</p>",
        "id": 244473447,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625080319
    },
    {
        "content": "<p>The stack could simply be a char** with memory being reallocated whenever we add or pop events</p>",
        "id": 244474256,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625080726
    },
    {
        "content": "<p>I just realized that the history command is doing something very similar to what we want to achieve by the undo stack</p>",
        "id": 244476451,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625081834
    },
    {
        "content": "<p>The best place that I can see to implement this stack data struc (similar to mged_hist) is include/ged/defines.h</p>",
        "id": 244480767,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625083807
    },
    {
        "content": "<p>bu_list would be just sufficient but knowing the length of the list will help in checking if the no of undos requested are actually possible. 2 options here: </p>\n<ol>\n<li>Make a new data struc with bu_list and a an int, can be expanded further in the future</li>\n<li>Use a plain bu_list and an attribute in _GLOBAL for no of undo backups stored</li>\n</ol>",
        "id": 244482141,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625084472
    },
    {
        "content": "<p>I hadn't properly seen the attributes of bu_list. Since it does not have an attribute to store data, I have created a new DS and will implement multiple undo using it</p>",
        "id": 244517069,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625113547
    },
    {
        "content": "<p>I have implemented a new data struc in ged.h<br>\nstruct ged_undo_stack {<br>\n    struct bu_list l;<br>\n    struct bu_attribute_value_set cmd_data;<br>\n    int64_t n; /* no of undos posssible */<br>\n};</p>\n<p>Using this I implemented undo for move</p>",
        "id": 244626272,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625173254
    },
    {
        "content": "<p>Im packing this in a binary object and then recovering this struct when undo is passed</p>",
        "id": 244626332,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625173283
    },
    {
        "content": "<p>I have a doubt in the recovery</p>",
        "id": 244626353,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625173298
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>struct ged_undo_stack *gusp;\ngusp = (struct ged_undo_stack *)bu_malloc(binunif-&gt;count, &quot;&quot;);\n</code></pre></div>\n<p>Is this correct code or will it lead to errors?<br>\nThe basic tests that I did worked but I'm not sure if this is robust code</p>",
        "id": 244626491,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625173355
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>struct ged_undo_stack {\nstruct bu_list l;\nstruct bu_attribute_value_set cmd_data;\nint64_t n; /* no of undos posssible */\n};\n</code></pre></div>\n<p>I think this structure will not work because <code>bu_list l</code> is just a node, and the whole list is not being stored</p>",
        "id": 244727034,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625243514
    },
    {
        "content": "<p>I want to store a resizeable array of <code>bu_attribute_value_set</code>, to store the cmds and required info for the undo stack<br>\nbut Im a little confused about how to allocate memory for this</p>",
        "id": 244821540,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625342118
    },
    {
        "content": "<p>Im kind of stuck on how to implement this stack which I can entirely  store in the binary object</p>",
        "id": 244824659,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625346988
    },
    {
        "content": "<p>bu_list doesnt work since we need to pass all the data and storing many structs into 1 binary object and then recovering doesnt work out</p>",
        "id": 244824679,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625347053
    },
    {
        "content": "<p>A simple implementation could be just using a char* array, but I think storing bu_attribute_value_sets can be more functional and easy to deal with once setup</p>",
        "id": 244824754,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625347182
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"102902\">@Sean</span> any hints here on how i can implement the DS</p>",
        "id": 244824816,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625347243
    },
    {
        "content": "<p>Also it would be great if you can give me weekly targets, because I feel progress has slowed down a bit over the last 1 week</p>",
        "id": 244954481,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625502461
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"102902\">@Sean</span> is it a good idea to use 2D bu_vls arrays to store the undo information? Im not able to figure out what would be the best way to create a stack which can be stored in a bin obj and then recovered</p>",
        "id": 244969882,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625515463
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"353338\">@Vikram Atreya</span> apologies on the delay, it was a big holiday weekend.  sounds like you've made a lot of progress and discoveries... and are knee deep in completely new concepts.  No worries, though, as you are on the right track.</p>",
        "id": 244997753,
        "sender_full_name": "Sean",
        "timestamp": 1625550320
    },
    {
        "content": "<p>taking a step back, the reason I mentioned #1 vs #2 was to separate the change of undo recording from the change of undo storage.  It doesn't matter which you do first, but you really should just tackle one of the two concepts.</p>",
        "id": 244997819,
        "sender_full_name": "Sean",
        "timestamp": 1625550403
    },
    {
        "content": "<p>you will want to do both, but I really suggest not trying to solve both at the same time, which you are/were attempting looking at bu_list and friends.  just using a char array was a good redirect, but  an avs could work IFF you have a plan for what the attribute names/convention will be for keeping track of things.</p>",
        "id": 244998098,
        "sender_full_name": "Sean",
        "timestamp": 1625550840
    },
    {
        "content": "<p>that said, that's still really doing 1+2 again... so don't get caught up with that.  Worst case, to do #2 first, you could/should implement exactly what you were doing in _GLOBAL (i.e., 3 strings) in memory.  Even getting that working is going to present a couple challenges.</p>",
        "id": 244998239,
        "sender_full_name": "Sean",
        "timestamp": 1625550994
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/244969882\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> is it a good idea to use 2D bu_vls arrays to store the undo information? Im not able to figure out what would be the best way to create a stack which can be stored in a bin obj and then recovered</p>\n</blockquote>\n<p>if you pretend brl-cad's data structures don't exist, what is it you're trying to do??</p>",
        "id": 244998316,
        "sender_full_name": "Sean",
        "timestamp": 1625551084
    },
    {
        "content": "<p>I want to store a stack of string pairs</p>",
        "id": 244998375,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625551174
    },
    {
        "content": "<p>until you figure that out, the rest is inconsequential and can be incredibly distracting as you're not familiar with the structures.  bu_list can be made to work perfectly.  bu_attribute_value_sets can be made to work.  char *'s can be made to work...</p>",
        "id": 244998386,
        "sender_full_name": "Sean",
        "timestamp": 1625551187
    },
    {
        "content": "<p>a stack of vector of string pairs is even better</p>",
        "id": 244998474,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625551228
    },
    {
        "content": "<p>what are the string pairs?</p>",
        "id": 244998481,
        "sender_full_name": "Sean",
        "timestamp": 1625551240
    },
    {
        "content": "<p>examples are<br>\nlast changed object : obj1<br>\nmoved object old name: old_name etc</p>",
        "id": 244998506,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625551274
    },
    {
        "content": "<p>data-type wise, what are they?</p>",
        "id": 244998622,
        "sender_full_name": "Sean",
        "timestamp": 1625551410
    },
    {
        "content": "<p>char*</p>",
        "id": 244998685,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625551448
    },
    {
        "content": "<p>so that works for the object name, but what about it's pair?</p>",
        "id": 244998694,
        "sender_full_name": "Sean",
        "timestamp": 1625551471
    },
    {
        "content": "<p>I was thinking of an array of size 2</p>",
        "id": 244998714,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625551508
    },
    {
        "content": "<p>you mean a &lt;char<em>, char</em>&gt; pair?</p>",
        "id": 244998796,
        "sender_full_name": "Sean",
        "timestamp": 1625551581
    },
    {
        "content": "<p>char *</p>",
        "id": 244998801,
        "sender_full_name": "Sean",
        "timestamp": 1625551585
    },
    {
        "content": "<p>Yes</p>",
        "id": 244998802,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625551588
    },
    {
        "content": "<p>In your example, \"last changed object\" is a lot of senseless bytes to be storing that anywhere...</p>",
        "id": 244998846,
        "sender_full_name": "Sean",
        "timestamp": 1625551670
    },
    {
        "content": "<p>Okayy</p>",
        "id": 244998906,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625551712
    },
    {
        "content": "<p>So we decide on positions previously itself and then assign values?</p>",
        "id": 244998917,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625551731
    },
    {
        "content": "<p>positions??</p>",
        "id": 244998925,
        "sender_full_name": "Sean",
        "timestamp": 1625551765
    },
    {
        "content": "<p>Like index 0, will be last command, second might be the object we are making, old object name, object we are killing based on the prev index value</p>",
        "id": 244998932,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625551784
    },
    {
        "content": "<p>that's essentially itemizing the second pair element in your description, the  &lt;..., string&gt; value</p>",
        "id": 244999009,
        "sender_full_name": "Sean",
        "timestamp": 1625551880
    },
    {
        "content": "<p>but what I think you're getting at is also storing the \"action\" with it</p>",
        "id": 244999016,
        "sender_full_name": "Sean",
        "timestamp": 1625551896
    },
    {
        "content": "<p>which would probably be more appropriate as an enumeration, an ID of sorts, so the pairing is &lt;int, string&gt;</p>",
        "id": 244999045,
        "sender_full_name": "Sean",
        "timestamp": 1625551923
    },
    {
        "content": "<p>So that said, why don't you start there with exactly that as simply as possible, with as few changes as possible.</p>",
        "id": 244999199,
        "sender_full_name": "Sean",
        "timestamp": 1625552101
    },
    {
        "content": "<p>what I mean is don't worry about the in-memory data structures .. that's #2 and that can be later.  you can focus solving the undo logic, not the in-memory mechanism.</p>",
        "id": 244999218,
        "sender_full_name": "Sean",
        "timestamp": 1625552152
    },
    {
        "content": "<p>what I mean by that is look at how you're using _GLOBAL ... what changes did you make there?</p>",
        "id": 244999273,
        "sender_full_name": "Sean",
        "timestamp": 1625552174
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/244999273\">said</a>:</p>\n<blockquote>\n<p>what I mean by that is look at how you're using _GLOBAL ... what changes did you make there?</p>\n</blockquote>\n<p>there = undo code?</p>",
        "id": 244999279,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625552194
    },
    {
        "content": "<p>or changes to _GLOBAL?</p>",
        "id": 244999283,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625552202
    },
    {
        "content": "<p>how are you using _GLOBAL ?</p>",
        "id": 244999312,
        "sender_full_name": "Sean",
        "timestamp": 1625552218
    },
    {
        "content": "<p>Im storing information in attribute pairs</p>",
        "id": 244999339,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625552244
    },
    {
        "content": "<p>more specific</p>",
        "id": 244999340,
        "sender_full_name": "Sean",
        "timestamp": 1625552251
    },
    {
        "content": "<p>For any addition of object--<br>\nlast_change: created<br>\nlast_created_object: its_name</p>",
        "id": 244999392,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625552288
    },
    {
        "content": "<p>For move:-<br>\nlast_change: move<br>\nmv_old_name: old_name<br>\nmv_new_name: new_name</p>",
        "id": 244999403,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625552319
    },
    {
        "content": "<p>Kill and change are similar to make in terms of data stored</p>",
        "id": 244999414,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625552346
    },
    {
        "content": "<p>this is why talking about bu_list's and such is a HUGE leap... :)</p>",
        "id": 244999437,
        "sender_full_name": "Sean",
        "timestamp": 1625552392
    },
    {
        "content": "<p>okay, so you have a whole slew of attribute names and values, and they're apparently command-specific</p>",
        "id": 244999495,
        "sender_full_name": "Sean",
        "timestamp": 1625552422
    },
    {
        "content": "<p>Theres only 4 types as of now in which I have accommodated all cmds Ive worked on till now</p>",
        "id": 244999522,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625552460
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/244999495\">said</a>:</p>\n<blockquote>\n<p>okay, so you have a whole slew of attribute names and values, and they're apparently command-specific</p>\n</blockquote>\n<p>but yes</p>",
        "id": 244999528,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625552472
    },
    {
        "content": "<p>so there's already a problem to consider ... how does move fit into the pair paradigm?</p>",
        "id": 244999638,
        "sender_full_name": "Sean",
        "timestamp": 1625552601
    },
    {
        "content": "<p>because I see &lt;int, string, string&gt; with old_name and new_name ... are both needed?</p>",
        "id": 244999651,
        "sender_full_name": "Sean",
        "timestamp": 1625552625
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/244999651\">said</a>:</p>\n<blockquote>\n<p>because I see &lt;int, string, string&gt; with old_name and new_name ... are both needed?</p>\n</blockquote>\n<p>Yeah both names will be needed to stored somewhere to properly undo the change</p>",
        "id": 244999721,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625552680
    },
    {
        "content": "<p>so you have an action that is &lt;UNDO, string, string&gt; ... and &lt;CHANGED, string&gt;... what else data-wise?</p>",
        "id": 244999856,
        "sender_full_name": "Sean",
        "timestamp": 1625552798
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/244999856\">said</a>:</p>\n<blockquote>\n<p>so you have an action that is &lt;UNDO, string, string&gt; ... and &lt;CHANGED, string&gt;... what else data-wise?</p>\n</blockquote>\n<p>for the move command that's it I would say</p>",
        "id": 244999884,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625552842
    },
    {
        "content": "<p>note that this is no longer a \"pair\" in CS terms, I'm just referring to an abstract tuple concept at the moment</p>",
        "id": 244999885,
        "sender_full_name": "Sean",
        "timestamp": 1625552842
    },
    {
        "content": "<p>sorry, &lt;MOVE, string, string&gt;</p>",
        "id": 244999905,
        "sender_full_name": "Sean",
        "timestamp": 1625552866
    },
    {
        "content": "<p>so what else is there?</p>",
        "id": 245000014,
        "sender_full_name": "Sean",
        "timestamp": 1625553000
    },
    {
        "content": "<p>itemize all the info being stored in _GLOBAL that way</p>",
        "id": 245000066,
        "sender_full_name": "Sean",
        "timestamp": 1625553024
    },
    {
        "content": "<p><em>For any addition of object--</em><br>\nlast_change: created<br>\nlast_created_object: its_name</p>\n<p><em>For move:-</em><br>\nlast_change: move<br>\nmv_old_name: old_name<br>\nmv_new_name: new_name</p>\n<p><em>For kill:-</em><br>\nlast_change: kill<br>\nlast_killed: killed_object</p>\n<p><em>For object modifiication</em>:<br>\nlast_change: modify<br>\nlast_modified: modified_object</p>",
        "id": 245000167,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625553137
    },
    {
        "content": "<p>now convert that into tuples...</p>",
        "id": 245000207,
        "sender_full_name": "Sean",
        "timestamp": 1625553184
    },
    {
        "content": "<p>&lt;CREATE, string&gt;<br>\n&lt;MOVE, string, string&gt;<br>\n&lt;KILL, string&gt;<br>\n&lt;MODIFY, string&gt;</p>",
        "id": 245000291,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625553246
    },
    {
        "content": "<p>that's great, so let's go with the simplest route and consolidate</p>",
        "id": 245000606,
        "sender_full_name": "Sean",
        "timestamp": 1625553592
    },
    {
        "content": "<p>since MOVE is an outlier, lets ignore it for the moment</p>",
        "id": 245000649,
        "sender_full_name": "Sean",
        "timestamp": 1625553606
    },
    {
        "content": "<p>you can, however, easily consolidate CREATE, KILL, and MODIFY</p>",
        "id": 245000661,
        "sender_full_name": "Sean",
        "timestamp": 1625553617
    },
    {
        "content": "<p>using a simple convention, you can combine them into a single field.  so I suggest trying that next.</p>",
        "id": 245000711,
        "sender_full_name": "Sean",
        "timestamp": 1625553703
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/245000711\">said</a>:</p>\n<blockquote>\n<p>using a simple convention, you can combine them into a single field.  so I suggest trying that next.</p>\n</blockquote>\n<p>Okay, like all this data in 1 string?</p>",
        "id": 245000956,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625553920
    },
    {
        "content": "<p>with a recognizable separator?</p>",
        "id": 245000958,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625553933
    },
    {
        "content": "<p>without a separator I'd think, but yes -- 1 string</p>",
        "id": 245000966,
        "sender_full_name": "Sean",
        "timestamp": 1625553952
    },
    {
        "content": "<p>using just 1 avs, change create, kill, and modify into one string</p>",
        "id": 245000974,
        "sender_full_name": "Sean",
        "timestamp": 1625553960
    },
    {
        "content": "<p>they're all identical, so you can always get any of them by iterating two at a time.</p>",
        "id": 245001060,
        "sender_full_name": "Sean",
        "timestamp": 1625554050
    },
    {
        "content": "<p>action: int string int string int string</p>",
        "id": 245001072,
        "sender_full_name": "Sean",
        "timestamp": 1625554066
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/245000974\">said</a>:</p>\n<blockquote>\n<p>using just 1 avs, change create, kill, and modify into one string</p>\n</blockquote>\n<p>Why do we need an avs now? if we have only 1 string?</p>",
        "id": 245001225,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625554241
    },
    {
        "content": "<p>Okay for the undo no and then action?</p>",
        "id": 245001238,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625554259
    },
    {
        "content": "<p>\"last_change: created\" is an avs</p>",
        "id": 245001257,
        "sender_full_name": "Sean",
        "timestamp": 1625554286
    },
    {
        "content": "<p>again, making as few changes as possible so we don't get lost in complexity... where/how are you going to store a list of actions like  \"action: int string int string int string\" ?</p>",
        "id": 245001393,
        "sender_full_name": "Sean",
        "timestamp": 1625554418
    },
    {
        "content": "<p>how are you storing \"last_change: kill\" ?</p>",
        "id": 245001500,
        "sender_full_name": "Sean",
        "timestamp": 1625554504
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/245001257\">said</a>:</p>\n<blockquote>\n<p>\"last_change: created\" is an avs</p>\n</blockquote>\n<p>avs is an attribute value set<br>\nSo it can store a lot of pairs<br>\nNow that we have 1 command stored just in 1 string, eg:MAKE_obj1, KILL_obj2, CHANGE_obj3<br>\nThat will be the value, and the key is the undo no like 1 for first undo?</p>",
        "id": 245001573,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625554565
    },
    {
        "content": "<p>sorry, I'm being loose with terminology -- I meant it's an\"avp\", it's not a set.  _GLOBAL is effectively an avs (or more technically, it <em>has</em> an avs)</p>",
        "id": 245001730,
        "sender_full_name": "Sean",
        "timestamp": 1625554716
    },
    {
        "content": "<p>So we have many avps for 1 cmd or only 1 avp?</p>",
        "id": 245001789,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625554786
    },
    {
        "content": "<p>don't get lost....<br>\nhow are you storing \"last_change: kill\" ?</p>",
        "id": 245001847,
        "sender_full_name": "Sean",
        "timestamp": 1625554808
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/245001847\">said</a>:</p>\n<blockquote>\n<p>don't get lost....<br>\nhow are you storing \"last_change: kill\" ?</p>\n</blockquote>\n<p>Im lost already <span aria-label=\"grimacing\" class=\"emoji emoji-1f62c\" role=\"img\" title=\"grimacing\">:grimacing:</span> <br>\nI did not get your question, Im just storng it as a pair in _GLOBAL' avs</p>",
        "id": 245002019,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625554947
    },
    {
        "content": "<p>yes, but HOW</p>",
        "id": 245002027,
        "sender_full_name": "Sean",
        "timestamp": 1625554958
    },
    {
        "content": "<p>as a pair of strings I suppose</p>",
        "id": 245002049,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625554993
    },
    {
        "content": "<p>no.. no</p>",
        "id": 245002053,
        "sender_full_name": "Sean",
        "timestamp": 1625554999
    },
    {
        "content": "<p>what line of code make it store that pair into _GLOBAL?</p>",
        "id": 245002062,
        "sender_full_name": "Sean",
        "timestamp": 1625555009
    },
    {
        "content": "<p>Okay</p>",
        "id": 245002075,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625555019
    },
    {
        "content": "<p>that's how...</p>",
        "id": 245002079,
        "sender_full_name": "Sean",
        "timestamp": 1625555021
    },
    {
        "content": "<p>So first I extract the avs from global, store a copy locally, add the attributes I want to add and then I replace the avs in _GLOBAL with the copy I made</p>",
        "id": 245002134,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625555053
    },
    {
        "content": "<p>how do you do that last step?</p>",
        "id": 245002163,
        "sender_full_name": "Sean",
        "timestamp": 1625555087
    },
    {
        "content": "<p>and/or the second step</p>",
        "id": 245002176,
        "sender_full_name": "Sean",
        "timestamp": 1625555096
    },
    {
        "content": "<p>there is a function db5_replace_attributes()</p>",
        "id": 245002184,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625555107
    },
    {
        "content": "<p>how do you add the attributes you want to add?</p>",
        "id": 245002186,
        "sender_full_name": "Sean",
        "timestamp": 1625555108
    },
    {
        "content": "<p>Using bu_avs_add</p>",
        "id": 245002240,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625555159
    },
    {
        "content": "<p>okay, so that's your next step....</p>",
        "id": 245002290,
        "sender_full_name": "Sean",
        "timestamp": 1625555179
    },
    {
        "content": "<p>how are you going to store a list of actions like \"action: int string int string int string\"?</p>",
        "id": 245002320,
        "sender_full_name": "Sean",
        "timestamp": 1625555203
    },
    {
        "content": "<p>make them into 3 avps and then add them to the avs, have a marker in the key that all of them belong to the same action</p>",
        "id": 245002391,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625555275
    },
    {
        "content": "<p>no good</p>",
        "id": 245002454,
        "sender_full_name": "Sean",
        "timestamp": 1625555303
    },
    {
        "content": "<p>find a solution that is just 1 avp</p>",
        "id": 245002475,
        "sender_full_name": "Sean",
        "timestamp": 1625555323
    },
    {
        "content": "<p>Can be done, we put a separator like double undo or | in the string and store them as a single string in the avp's value</p>",
        "id": 245002570,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625555409
    },
    {
        "content": "<p>what purpose does the separator serve?</p>",
        "id": 245002606,
        "sender_full_name": "Sean",
        "timestamp": 1625555440
    },
    {
        "content": "<p>To distinguish between different data</p>",
        "id": 245002650,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625555478
    },
    {
        "content": "<p>for eg, MOVE|old_name|new_name</p>",
        "id": 245002670,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625555500
    },
    {
        "content": "<p>stop it.. we're ignoring MOVE...</p>",
        "id": 245002685,
        "sender_full_name": "Sean",
        "timestamp": 1625555512
    },
    {
        "content": "<p>keep it simple...</p>",
        "id": 245002737,
        "sender_full_name": "Sean",
        "timestamp": 1625555536
    },
    {
        "content": "<p>Okayy <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 245002748,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625555545
    },
    {
        "content": "<p>the value could be <code>ACTION|int|string|int|string|int|string</code></p>",
        "id": 245002872,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625555645
    },
    {
        "content": "<p>what is ACTION?</p>",
        "id": 245002945,
        "sender_full_name": "Sean",
        "timestamp": 1625555707
    },
    {
        "content": "<p>\"action\" was going to be the name, so I'm not sure why you'd put it in the value too...</p>",
        "id": 245002976,
        "sender_full_name": "Sean",
        "timestamp": 1625555729
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/245002976\">said</a>:</p>\n<blockquote>\n<p>\"action\" was going to be the name, so I'm not sure why you'd put it in the value too...</p>\n</blockquote>\n<p>Shouldnt have put it</p>",
        "id": 245003058,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625555774
    },
    {
        "content": "<p>My bad</p>",
        "id": 245003086,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625555823
    },
    {
        "content": "<p>okay, so then i'm back to saying you don't need a delimiter</p>",
        "id": 245003136,
        "sender_full_name": "Sean",
        "timestamp": 1625555873
    },
    {
        "content": "<p>Let me think of another method then, if there were no numbers in the string then there would be no need otherwise.... <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 245003284,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625556000
    },
    {
        "content": "<p>at least not now, not yet. just complicates it.. if the value is \"1 obj2 3 obj2 1 obj4 2 obj3\"  is that ambiguous?</p>",
        "id": 245003333,
        "sender_full_name": "Sean",
        "timestamp": 1625556014
    },
    {
        "content": "<p>No</p>",
        "id": 245003361,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625556037
    },
    {
        "content": "<p>so go with something that simple then</p>",
        "id": 245003377,
        "sender_full_name": "Sean",
        "timestamp": 1625556053
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/245003333\">said</a>:</p>\n<blockquote>\n<p>at least not now, not yet. just complicates it.. if the value is \"1 obj2 3 obj2 1 obj4 2 obj3\"  is that ambiguous?</p>\n</blockquote>\n<p>but we do have a separator that is a space in this example right?</p>",
        "id": 245003422,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625556082
    },
    {
        "content": "<p>sure, and we're assuming object names don't have spaces for now too</p>",
        "id": 245003520,
        "sender_full_name": "Sean",
        "timestamp": 1625556133
    },
    {
        "content": "<p>that's okay</p>",
        "id": 245003525,
        "sender_full_name": "Sean",
        "timestamp": 1625556140
    },
    {
        "content": "<p>So I'll just use spaces between different data</p>",
        "id": 245003531,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625556143
    },
    {
        "content": "<p>you'll have to get the avp to add new values to it, but you can continually add easily.  undo can read from that and remove the last two values</p>",
        "id": 245003533,
        "sender_full_name": "Sean",
        "timestamp": 1625556144
    },
    {
        "content": "<p>so try doing that so that kill, create, and change all add to that avp, and undo removes the last one ...</p>",
        "id": 245003579,
        "sender_full_name": "Sean",
        "timestamp": 1625556206
    },
    {
        "content": "<p>disable the move code if it causes problems</p>",
        "id": 245003595,
        "sender_full_name": "Sean",
        "timestamp": 1625556226
    },
    {
        "content": "<p>it's not the focus</p>",
        "id": 245003601,
        "sender_full_name": "Sean",
        "timestamp": 1625556232
    },
    {
        "content": "<p>Just to confirm<br>\nSo every command adds to the same avs(to be precise) and undo keeps popping things from it?</p>",
        "id": 245003822,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625556382
    },
    {
        "content": "<p>once you get it working, I suggest putting the code that adds/removes from the avp into a function.  make the kill/create/change functions call those functions</p>",
        "id": 245003828,
        "sender_full_name": "Sean",
        "timestamp": 1625556392
    },
    {
        "content": "<p>adds to the same <em>avp</em></p>",
        "id": 245003845,
        "sender_full_name": "Sean",
        "timestamp": 1625556412
    },
    {
        "content": "<p>an \"action\" avp</p>",
        "id": 245003854,
        "sender_full_name": "Sean",
        "timestamp": 1625556426
    },
    {
        "content": "<p>or whatever you want to name it</p>",
        "id": 245003861,
        "sender_full_name": "Sean",
        "timestamp": 1625556434
    },
    {
        "content": "<p>no other avp's</p>",
        "id": 245003866,
        "sender_full_name": "Sean",
        "timestamp": 1625556440
    },
    {
        "content": "<p>make sense?</p>",
        "id": 245003880,
        "sender_full_name": "Sean",
        "timestamp": 1625556453
    },
    {
        "content": "<p>once you do that, you should be able to implement an \"undo list\" subcommand that lists all the actions that can be undone...</p>",
        "id": 245003950,
        "sender_full_name": "Sean",
        "timestamp": 1625556500
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/245003854\">said</a>:</p>\n<blockquote>\n<p>an \"action\" avp</p>\n</blockquote>\n<p>Sorry for getting confused<br>\nSo one action avp can contain many commands?<br>\nfor eg, an action might have make+kill+kill<br>\nand its avp comes out to be<br>\nACTION: 1 obj1.s 2 obj2.s 2 obj3.s</p>",
        "id": 245003995,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625556550
    },
    {
        "content": "<p>right</p>",
        "id": 245004260,
        "sender_full_name": "Sean",
        "timestamp": 1625556736
    },
    {
        "content": "<p>Do that, and you will have succinctly solved #1</p>",
        "id": 245004319,
        "sender_full_name": "Sean",
        "timestamp": 1625556803
    },
    {
        "content": "<p>Yes got it</p>",
        "id": 245004340,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625556820
    },
    {
        "content": "<p>I have implemented undo for a multi-command action<br>\neg, <br>\nWe have few objects when we open the db, next we do \"make+make+kill+make+make\" , and then call undo<br>\nIt undoes all changes since we have kept track i.e. only the initial objects are left</p>",
        "id": 245236214,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625688880
    },
    {
        "content": "<p>Right now a single undo removes all changes, I will reconfigure this to 1 change per undo</p>",
        "id": 245236952,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625689306
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/245236952\">said</a>:</p>\n<blockquote>\n<p>Right now a single undo removes all changes, I will reconfigure this to 1 change per undo</p>\n</blockquote>\n<p>Done!</p>",
        "id": 245238387,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625690026
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/244383650\">said</a>:</p>\n<blockquote>\n<p>2) If you're still using _GLOBAL, switch to using some other convention.  ideally, make it so undo command knows how many undo  actions there are and/or what the next one is</p>\n</blockquote>\n<p>I will proceed to the next task then, for this implementing a new struct with <code>char**</code> and no_of_undos should suffice, where the <code>char**</code> can store the action strings<br>\nWhat are your thoughts <span class=\"user-mention\" data-user-id=\"102902\">@Sean</span> ?</p>",
        "id": 245240496,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625691169
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"353338\">@Vikram Atreya</span> I'd recommend you tackle #1.5 next ...  account for the remaining attributes you were storing on _GLOBAL (i.e., rename) ... figure out a way for handling that, ideally without using additional delimiters or command-specific logic.</p>",
        "id": 245526828,
        "sender_full_name": "Sean",
        "timestamp": 1625887721
    },
    {
        "content": "<p>curious how you're thinking to handle it.  I can think of a few ways, one in particular...</p>",
        "id": 245526908,
        "sender_full_name": "Sean",
        "timestamp": 1625887851
    },
    {
        "content": "<p>The first thing that comes to mind is a command-specific logic where, lets say 3 represents rename, then we iterate till we find 2 object names separated by a space.</p>",
        "id": 245526945,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625887923
    },
    {
        "content": "<p>right, that's an option, but as you note it has a huge downside that the parsing logic has to suddenly become command-aware, it has to know that rename takes 3</p>",
        "id": 245526985,
        "sender_full_name": "Sean",
        "timestamp": 1625888027
    },
    {
        "content": "<p>it also can't instantly know how many undo actions remain without inspecting all the command labels to know how many to skip.</p>",
        "id": 245526989,
        "sender_full_name": "Sean",
        "timestamp": 1625888036
    },
    {
        "content": "<p>any other ideas?</p>",
        "id": 245526990,
        "sender_full_name": "Sean",
        "timestamp": 1625888042
    },
    {
        "content": "<p>Another idea could be keep iterating till we find the next number</p>",
        "id": 245527044,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625888105
    },
    {
        "content": "<p>eh?  how's that implement support for undoing rename?</p>",
        "id": 245527107,
        "sender_full_name": "Sean",
        "timestamp": 1625888170
    },
    {
        "content": "<p>For rename we need to store 2 strings unlike make/kill</p>",
        "id": 245527120,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625888212
    },
    {
        "content": "<p>Not true...</p>",
        "id": 245527124,
        "sender_full_name": "Sean",
        "timestamp": 1625888225
    },
    {
        "content": "<p>that's not a need, that's just how you're currently handling it</p>",
        "id": 245527128,
        "sender_full_name": "Sean",
        "timestamp": 1625888236
    },
    {
        "content": "<p>Rn Im storing the action value as  \"1 obj1.s 2 obj2.s 1 obj3.s ..... \" where 1 represents make and 2 represents kill</p>",
        "id": 245527136,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625888266
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/245527128\">said</a>:</p>\n<blockquote>\n<p>that's not a need, that's just how you're currently handling it</p>\n</blockquote>\n<p>Okay, let me think with only 1 string</p>",
        "id": 245527174,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625888293
    },
    {
        "content": "<p>yep, sounds good</p>",
        "id": 245527175,
        "sender_full_name": "Sean",
        "timestamp": 1625888297
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/245527136\">said</a>:</p>\n<blockquote>\n<p>Rn Im storing the action value as  \"1 obj1.s 2 obj2.s 1 obj3.s ..... \" where 1 represents make and 2 represents kill</p>\n</blockquote>\n<p>So if i stored 3 obj2.s obj5.s in this, to not make it command specific, I keep iterating and storing any number of words till I find the next no or the string ends</p>",
        "id": 245527196,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625888386
    },
    {
        "content": "<p>that's not really any different</p>",
        "id": 245527247,
        "sender_full_name": "Sean",
        "timestamp": 1625888432
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/245527107\">said</a>:</p>\n<blockquote>\n<p>eh?  how's that implement support for undoing rename?</p>\n</blockquote>\n<p>I was replying to this</p>",
        "id": 245527258,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625888473
    },
    {
        "content": "<p>well, yeah, but you said that's another idea ... that's the same idea.  that's literally how you'd have to handle it, but it has problems that I mentioned.</p>",
        "id": 245527311,
        "sender_full_name": "Sean",
        "timestamp": 1625888535
    },
    {
        "content": "<p>the parsing logic has to be aware</p>",
        "id": 245527316,
        "sender_full_name": "Sean",
        "timestamp": 1625888556
    },
    {
        "content": "<p>I mean I get what you're saying, that it doesn't need to know it's a 3 and just keeps looking for a number, but that's still not deterministic.  It's a linear cost operation O(n) to figure out what a given field entry is...</p>",
        "id": 245527331,
        "sender_full_name": "Sean",
        "timestamp": 1625888624
    },
    {
        "content": "<p>you can't look at a stream like \"1 foo 2 bar 3 foo bar 2 foo 1 bar 3 bar foo 1 foo 2 bar\" and tell me whether the 7th argument is an object name or an undo identifier without parsing everything that came before it</p>",
        "id": 245527375,
        "sender_full_name": "Sean",
        "timestamp": 1625888672
    },
    {
        "content": "<p>Yes.</p>",
        "id": 245527384,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625888691
    },
    {
        "content": "<p>whereas if it was always pairs \"1 foo 2 bar 3 foo 2 foo 1 bar 3 bar 1 foo 2 bar\", the 7th is odd, so that's always an identifier and is constant time O(1)</p>",
        "id": 245527445,
        "sender_full_name": "Sean",
        "timestamp": 1625888771
    },
    {
        "content": "<p>so how can you implement undo support for renames and still remain constant time?</p>",
        "id": 245527462,
        "sender_full_name": "Sean",
        "timestamp": 1625888832
    },
    {
        "content": "<p>using a hash we can separate both names</p>",
        "id": 245527469,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625888866
    },
    {
        "content": "<p>hm?  what're you suggesting?</p>",
        "id": 245527523,
        "sender_full_name": "Sean",
        "timestamp": 1625888921
    },
    {
        "content": "<p>obj_name1_hash_obj_name2</p>",
        "id": 245527539,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625888970
    },
    {
        "content": "<p>explain...</p>",
        "id": 245527544,
        "sender_full_name": "Sean",
        "timestamp": 1625888986
    },
    {
        "content": "<p>A separator (kinda), let me give an example</p>",
        "id": 245527587,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625889008
    },
    {
        "content": "<p>obj1.s_sep!#asdjfhfjnrbs#!!_obj2.s</p>",
        "id": 245527600,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625889055
    },
    {
        "content": "<p>so I think you're suggesting you generate a random string and use that as a separator between the two object names?</p>",
        "id": 245527620,
        "sender_full_name": "Sean",
        "timestamp": 1625889122
    },
    {
        "content": "<p>Not a random string every time, some fixed string, and yes</p>",
        "id": 245527662,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625889147
    },
    {
        "content": "<p>why does it need to be encoded/hashed/long like that?</p>",
        "id": 245527663,
        "sender_full_name": "Sean",
        "timestamp": 1625889152
    },
    {
        "content": "<p>why not obj1.s|obj2.s or something similar?</p>",
        "id": 245527669,
        "sender_full_name": "Sean",
        "timestamp": 1625889187
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/245527663\">said</a>:</p>\n<blockquote>\n<p>why does it need to be encoded/hashed/long like that?</p>\n</blockquote>\n<p>To avoid that pattern occurring in the object name</p>",
        "id": 245527671,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625889193
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/245527669\">said</a>:</p>\n<blockquote>\n<p>why not obj1.s|obj2.s or something similar?</p>\n</blockquote>\n<p>Imnt sure but cant \"|\" be put in an object name?</p>",
        "id": 245527726,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625889256
    },
    {
        "content": "<p>there are a number of chracters that are incredibly inconvenient/difficult to have in object names that you could use</p>",
        "id": 245527736,
        "sender_full_name": "Sean",
        "timestamp": 1625889276
    },
    {
        "content": "<p>you could also use quoting rules to encode the pairing like /obj1.s/obj2.s/ and it would recognize the use of / or , or whatever else being used as a separator</p>",
        "id": 245527762,
        "sender_full_name": "Sean",
        "timestamp": 1625889360
    },
    {
        "content": "<p>so that's an option, and not a terrible one, but not great too because we're now similarly no longer deterministic on the even number arguments that were previously all object names (or former object names)</p>",
        "id": 245527808,
        "sender_full_name": "Sean",
        "timestamp": 1625889415
    },
    {
        "content": "<p>so keep that one in your back pocket, it could work but I think we can do better.  The real issue is that rename is introducing command-specific behavior and we're scrambling to come up with awkward ways to encode it instead of trying to find a way to handle it like everything else</p>",
        "id": 245527872,
        "sender_full_name": "Sean",
        "timestamp": 1625889497
    },
    {
        "content": "<p>If we were to handle it like other commands, we will need a new place to store the old_name, could be in the attributes of the object itself but again that will be a pain for multiple renames</p>",
        "id": 245527960,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625889613
    },
    {
        "content": "<p>think about what rename is doing and other ways you might handle it without code having logic specific to rename anywhere (i.e., 3 != \"rename\").</p>",
        "id": 245527963,
        "sender_full_name": "Sean",
        "timestamp": 1625889616
    },
    {
        "content": "<p>Yes!  excellent observation</p>",
        "id": 245527989,
        "sender_full_name": "Sean",
        "timestamp": 1625889638
    },
    {
        "content": "<p>you could just have 3 = rename and \"3 foo\" might be \"we renamed foo\" and in the backup \"foo\" object, it has an attribute like \"renamed_from\" = \"bar\" where we could keep track of the additional/former name</p>",
        "id": 245528017,
        "sender_full_name": "Sean",
        "timestamp": 1625889700
    },
    {
        "content": "<p>Yes this can totally be done</p>",
        "id": 245528059,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625889733
    },
    {
        "content": "<p>that's better and makes the undo parsing completely deterministic, but I think you're right .. it's potentially a pain for multiple renames... maybe.</p>",
        "id": 245528070,
        "sender_full_name": "Sean",
        "timestamp": 1625889741
    },
    {
        "content": "<p>Not if we are using the backup_object</p>",
        "id": 245528077,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625889756
    },
    {
        "content": "<p>Then every new name will have a different backup object</p>",
        "id": 245528084,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625889770
    },
    {
        "content": "<p>Only problem is when object is renamed to new_name and then again back to old_name</p>",
        "id": 245528089,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625889796
    },
    {
        "content": "<p>sure, because nothing says the backup object's name has to have meaning.  it could be \"3 jjk2h34hk24k12kj1h5\" and in that object, it has the from and to names recorded</p>",
        "id": 245528094,
        "sender_full_name": "Sean",
        "timestamp": 1625889808
    },
    {
        "content": "<p>This can be solved later on when by adding the undo_step_no to all backup objects</p>",
        "id": 245528104,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625889831
    },
    {
        "content": "<p>so that's good and if we had lots of time, I might say do that next, but let me hint you towards another solution</p>",
        "id": 245528145,
        "sender_full_name": "Sean",
        "timestamp": 1625889859
    },
    {
        "content": "<p>consider what rename does...</p>",
        "id": 245528152,
        "sender_full_name": "Sean",
        "timestamp": 1625889878
    },
    {
        "content": "<p>I'd argue you can encode it already without introducing a new undo code.  do you see why?</p>",
        "id": 245528164,
        "sender_full_name": "Sean",
        "timestamp": 1625889909
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/245528164\">said</a>:</p>\n<blockquote>\n<p>I'd argue you can encode it already without introducing a new undo code.  do you see why?</p>\n</blockquote>\n<p>Encode the backup object or in the action value string?</p>",
        "id": 245528249,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625889991
    },
    {
        "content": "<p>nope</p>",
        "id": 245528252,
        "sender_full_name": "Sean",
        "timestamp": 1625889997
    },
    {
        "content": "<p>I mean using the convention you have already where 1=make and 2=kill</p>",
        "id": 245528268,
        "sender_full_name": "Sean",
        "timestamp": 1625890058
    },
    {
        "content": "<p>Ohh yes</p>",
        "id": 245528275,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625890070
    },
    {
        "content": "<p>Make object with old_name and kill the one with the new name</p>",
        "id": 245528318,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625890098
    },
    {
        "content": "<p>right!  now what's the problem with that?</p>",
        "id": 245528330,
        "sender_full_name": "Sean",
        "timestamp": 1625890133
    },
    {
        "content": "<p>Extra space to store the backup object</p>",
        "id": 245528335,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625890148
    },
    {
        "content": "<p>meh, don't care about that</p>",
        "id": 245528339,
        "sender_full_name": "Sean",
        "timestamp": 1625890166
    },
    {
        "content": "<p>or extra information required to know which object to make a copy of</p>",
        "id": 245528342,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625890177
    },
    {
        "content": "<p>the suggestion is \"rename foo bar\" can be encoded as \"1 bar 2 foo\" right?  what's the problem with that?</p>",
        "id": 245528347,
        "sender_full_name": "Sean",
        "timestamp": 1625890196
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/245528347\">said</a>:</p>\n<blockquote>\n<p>the suggestion is \"rename foo bar\" can be encoded as \"1 bar 2 foo\" right?  what's the problem with that?</p>\n</blockquote>\n<p>Yeah, but to make bar we need to either make a copy of an existing object or get it from a backup that we stored</p>",
        "id": 245528404,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625890253
    },
    {
        "content": "<p>er, sure, but you have that...  rename command has foo so it could define bar by copying foo</p>",
        "id": 245528425,
        "sender_full_name": "Sean",
        "timestamp": 1625890321
    },
    {
        "content": "<p>and then store that copy as the backup object</p>",
        "id": 245528467,
        "sender_full_name": "Sean",
        "timestamp": 1625890345
    },
    {
        "content": "<p>that's not a problem</p>",
        "id": 245528470,
        "sender_full_name": "Sean",
        "timestamp": 1625890350
    },
    {
        "content": "<p>what is a problem is ...</p>",
        "id": 245528471,
        "sender_full_name": "Sean",
        "timestamp": 1625890357
    },
    {
        "content": "<p>what happens when the user calls \"undo\"?</p>",
        "id": 245528473,
        "sender_full_name": "Sean",
        "timestamp": 1625890368
    },
    {
        "content": "<p>and your action string is \"1 bar 2 foo\"</p>",
        "id": 245528488,
        "sender_full_name": "Sean",
        "timestamp": 1625890436
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/245528488\">said</a>:</p>\n<blockquote>\n<p>and your action string is \"1 bar 2 foo\"</p>\n</blockquote>\n<p>Search for a backup for bar, make it and then kill foo</p>",
        "id": 245528534,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625890466
    },
    {
        "content": "<p>not quite.. it wouldn't know to do all that...</p>",
        "id": 245528543,
        "sender_full_name": "Sean",
        "timestamp": 1625890490
    },
    {
        "content": "<p>\"undo\" is going to just undo \"2 foo\"</p>",
        "id": 245528558,
        "sender_full_name": "Sean",
        "timestamp": 1625890511
    },
    {
        "content": "<p>Okay, yes</p>",
        "id": 245528566,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625890524
    },
    {
        "content": "<p>i.e., the kill is undone, then a second undo will undo the make (by killing bar)</p>",
        "id": 245528573,
        "sender_full_name": "Sean",
        "timestamp": 1625890550
    },
    {
        "content": "<p>so in that respect, undo is not terribly different from killall ..</p>",
        "id": 245528635,
        "sender_full_name": "Sean",
        "timestamp": 1625890616
    },
    {
        "content": "<p>what's action type 3 ?</p>",
        "id": 245528707,
        "sender_full_name": "Sean",
        "timestamp": 1625890731
    },
    {
        "content": "<p>1=make, 2=kill, 3=?</p>",
        "id": 245528710,
        "sender_full_name": "Sean",
        "timestamp": 1625890742
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/245528710\">said</a>:</p>\n<blockquote>\n<p>1=make, 2=kill, 3=?</p>\n</blockquote>\n<p>not decided?</p>",
        "id": 245528789,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625890859
    },
    {
        "content": "<p>it could be combination cmd like g</p>",
        "id": 245528804,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625890890
    },
    {
        "content": "<p>or rather a change</p>",
        "id": 245528811,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625890909
    },
    {
        "content": "<p>oh, so you didn't do what we talked about earlier then...</p>",
        "id": 245528814,
        "sender_full_name": "Sean",
        "timestamp": 1625890912
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/245000661\">said</a>:</p>\n<blockquote>\n<p>you can, however, easily consolidate CREATE, KILL, and MODIFY</p>\n<p>using a simple convention, you can combine them into a single field. so I suggest trying that next.</p>\n</blockquote>",
        "id": 245528876,
        "sender_full_name": "Sean",
        "timestamp": 1625890966
    },
    {
        "content": "<p>I havent dealt with MODIFY yet in the code, but can be done in a few min</p>",
        "id": 245528893,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625891018
    },
    {
        "content": "<p>okay, no worries, but lets pretend you've done that :)</p>",
        "id": 245528896,
        "sender_full_name": "Sean",
        "timestamp": 1625891038
    },
    {
        "content": "<p>so 3=change or whatever</p>",
        "id": 245528935,
        "sender_full_name": "Sean",
        "timestamp": 1625891046
    },
    {
        "content": "<p>so yeah, assuming that, how would you encode \"killall foo\" where bar=obj1 u obj2 - foo</p>",
        "id": 245529044,
        "sender_full_name": "Sean",
        "timestamp": 1625891205
    },
    {
        "content": "<p>using 1/2/3 ...</p>",
        "id": 245529110,
        "sender_full_name": "Sean",
        "timestamp": 1625891293
    },
    {
        "content": "<p>1 foo 3 comb_obj</p>",
        "id": 245529124,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625891341
    },
    {
        "content": "<p>or modify more comb objects if necessary</p>",
        "id": 245529134,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625891357
    },
    {
        "content": "<p>what's comb_obj?</p>",
        "id": 245529137,
        "sender_full_name": "Sean",
        "timestamp": 1625891366
    },
    {
        "content": "<p>it could be any combination object which had a reference to foo before killall</p>",
        "id": 245529143,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625891398
    },
    {
        "content": "<p>it's not unknown, I gave all the db objects.. the db has objects: foo bar obj1 obj2</p>",
        "id": 245529210,
        "sender_full_name": "Sean",
        "timestamp": 1625891477
    },
    {
        "content": "<p>so killall foo does what?</p>",
        "id": 245529212,
        "sender_full_name": "Sean",
        "timestamp": 1625891485
    },
    {
        "content": "<p>assume obj1 and obj2 are primitives</p>",
        "id": 245529268,
        "sender_full_name": "Sean",
        "timestamp": 1625891570
    },
    {
        "content": "<p>obj1 u obj2 - foo<br>\ni did not get this<br>\nwhat is the relation between obj1 and bar</p>",
        "id": 245529320,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625891658
    },
    {
        "content": "<p>that's the CSG recipe.  it just means bar is a combination and it references foo, so it will be modified by killall</p>",
        "id": 245529327,
        "sender_full_name": "Sean",
        "timestamp": 1625891692
    },
    {
        "content": "<p>3 bar 2 foo</p>",
        "id": 245529345,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625891756
    },
    {
        "content": "<p>This should be stored in the string</p>",
        "id": 245529387,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625891776
    },
    {
        "content": "<p>excellent, right</p>",
        "id": 245529544,
        "sender_full_name": "Sean",
        "timestamp": 1625892122
    },
    {
        "content": "<p>so you see then if you undo, that would only first undo 2 foo, which is only a partial undo of the killall command</p>",
        "id": 245529583,
        "sender_full_name": "Sean",
        "timestamp": 1625892149
    },
    {
        "content": "<p>what's needed to fix that?</p>",
        "id": 245529584,
        "sender_full_name": "Sean",
        "timestamp": 1625892152
    },
    {
        "content": "<p>or how would you fix that for killall? ... without introducing logic that is specific to killall</p>",
        "id": 245529590,
        "sender_full_name": "Sean",
        "timestamp": 1625892178
    },
    {
        "content": "<p>Just asking, is there a plan to undo the whole action all at once in the future and have multiple actions where 1 action was just 1 command?<br>\nkill all would have action string as \"3 bar1 3 bar2 3 bar3 2 foo\" and 1 undo would undo all this</p>",
        "id": 245529645,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625892278
    },
    {
        "content": "<p>heh</p>",
        "id": 245529720,
        "sender_full_name": "Sean",
        "timestamp": 1625892446
    },
    {
        "content": "<p>OF COURSE that's the plan... :)  otherwise that's not really undo support for commands like undo.</p>",
        "id": 245529766,
        "sender_full_name": "Sean",
        "timestamp": 1625892499
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/245529590\">said</a>:</p>\n<blockquote>\n<p>or how would you fix that for killall? ... without introducing logic that is specific to killall</p>\n</blockquote>\n<p>but right now Idk, I'm thinking</p>",
        "id": 245529777,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625892546
    },
    {
        "content": "<p>assuming you're still thinking about it <span class=\"user-mention\" data-user-id=\"353338\">@Vikram Atreya</span> ... here's a suggestion:  keep the same 1/2/3 action codes, but make 0 be a set / grouping action and let the object that follows be an attribute object (just like _GLOBAL) that contains the list of things to undo for that set.</p>",
        "id": 245532182,
        "sender_full_name": "Sean",
        "timestamp": 1625896935
    },
    {
        "content": "<p>so in our db with four objects, maybe the undo history looks like this: \"1 foo 1 obj1 1 obj2 1 obj3 1 bar 3 bar 2 obj3\"</p>",
        "id": 245532257,
        "sender_full_name": "Sean",
        "timestamp": 1625897089
    },
    {
        "content": "<p>then you run \"killall foo\", and the undo string in _GLOBAL looks like: \"1 foo 1 obj1 1 obj2 1 obj3 1 bar 3 bar 2 obj3 0 killtree_2b4a7c20\"</p>",
        "id": 245532319,
        "sender_full_name": "Sean",
        "timestamp": 1625897190
    },
    {
        "content": "<p>and the object killtree_2b4a7c20 has an action = \"3 bar 2 foo\"</p>",
        "id": 245532332,
        "sender_full_name": "Sean",
        "timestamp": 1625897230
    },
    {
        "content": "<p>so running undo pops off the 0 action, reads the object, and recursively handles undoing the entire action list in killtree_2b4a7c201</p>",
        "id": 245532393,
        "sender_full_name": "Sean",
        "timestamp": 1625897326
    },
    {
        "content": "<p>once you get that working, make sure everything that accesses _GLOBAL directly or indirectly is going through a function, not directly accessing it from each command.</p>",
        "id": 245532467,
        "sender_full_name": "Sean",
        "timestamp": 1625897434
    },
    {
        "content": "<p>I had to go to the bank for some work, I got the idea; Will start working on it</p>",
        "id": 245540097,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1625909130
    },
    {
        "content": "<p>Any luck?  Youll probably have to figure out how to write an attribute object..</p>",
        "id": 245730755,
        "sender_full_name": "Sean",
        "timestamp": 1626115992
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/245730755\">said</a>:</p>\n<blockquote>\n<p>Any luck?  Youll probably have to figure out how to write an attribute object..</p>\n</blockquote>\n<p>Was a lil busy with another project submission the past 2-3 days. Will update you on progress tomorrow for sure<br>\nSorry for the delay</p>",
        "id": 245733649,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1626117143
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/245532182\">said</a>:</p>\n<blockquote>\n<p>assuming you're still thinking about it <span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> ... here's a suggestion:  keep the same 1/2/3 action codes, but make 0 be a set / grouping action and let the object that follows be an attribute object (just like _GLOBAL) that contains the list of things to undo for that set.</p>\n</blockquote>\n<p>Can we have different numbers that mean a group</p>",
        "id": 245920272,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1626239580
    },
    {
        "content": "<p>For eg, 4 is the code for move, and the object passed after it contains attributes related to the command</p>",
        "id": 245920285,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1626239621
    },
    {
        "content": "<p>Working :</p>\n<div class=\"codehilite\"><pre><span></span><code>&gt;mv obj1.s obj2.s\n//An attribute object attr_hash is created with info about old name and new name\n//4 attr_hash is appended to action&#39;s value\n&gt;undo\n//code &quot;4&quot; is seen, it accesses attr_hash and using info in it undoes the move\n</code></pre></div>",
        "id": 245920456,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1626239844
    },
    {
        "content": "<p>curious why not zero?  grouping is the first \"meta\" action representing a transaction, so it doesn't make sense in the middle of the numbering scheme</p>",
        "id": 246000671,
        "sender_full_name": "Sean",
        "timestamp": 1626287528
    },
    {
        "content": "<p>consider if more actions or specializations get added (e.g., editing an object's attribute could be tracked separately more efficiently with 3 more attr_add/attr_remove/attr_change codes</p>",
        "id": 246000941,
        "sender_full_name": "Sean",
        "timestamp": 1626287645
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/246000671\">said</a>:</p>\n<blockquote>\n<p>curious why not zero?  grouping is the first \"meta\" action representing a transaction, so it doesn't make sense in the middle of the numbering scheme</p>\n</blockquote>\n<p>As I was implementing it, I realize 0 is a better choice. I had this doubt, would it be better if we could specify what command inside the attribute object, for eg, make the attr_obj have <br>\ncommand: move<br>\nold_name: obj1.s<br>\nnew_name: obj2.s<br>\nor we only want to have a string like \"2 obj1.s 1 obj2.s\"</p>",
        "id": 246016418,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1626294931
    },
    {
        "content": "<p>If we specify the command, it would make the logic more command-specific but will also be better in terms of space complexity</p>",
        "id": 246016529,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1626294966
    },
    {
        "content": "<p>Also what is the best way to generate random names for these attribute objects, is there a built-in function?</p>",
        "id": 246017788,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1626295537
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/246016418\">said</a>:</p>\n<blockquote>\n<p>. . . specify what command inside the attribute object, for eg, make the attr_obj have <br>\ncommand: move<br>\nold_name: obj1.s<br>\nnew_name: obj2.s</p>\n</blockquote>\n<p>I have implemented this</p>",
        "id": 246136460,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1626373855
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"102902\">@Sean</span> is this method fine or should I implement it like action value sequence (1 obj1.s 2 obj2.s)</p>",
        "id": 246136717,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1626373984
    },
    {
        "content": "<p>Well, it greatly depends.  I mean in general it doesn't (yet) matter ... but it will.</p>",
        "id": 246311014,
        "sender_full_name": "Sean",
        "timestamp": 1626507342
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"353338\">@Vikram Atreya</span> I would think you want to use the exact same parsing/handling logic that you have/had as this is the basis for recursive transactions.</p>",
        "id": 246311075,
        "sender_full_name": "Sean",
        "timestamp": 1626507429
    },
    {
        "content": "<p>You're going to want to handle actions within actions within actions that need to be undone and the logic for handling that needs to be as simple as possible in order to be understandable, maintainable, particularly for others.</p>",
        "id": 246311095,
        "sender_full_name": "Sean",
        "timestamp": 1626507477
    },
    {
        "content": "<p>Let me ask you, though, what made you want to not do \"2 obj1.s 1 obj2.s\" ?</p>",
        "id": 246311143,
        "sender_full_name": "Sean",
        "timestamp": 1626507548
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/246311143\">said</a>:</p>\n<blockquote>\n<p>Let me ask you, though, what made you want to not do \"2 obj1.s 1 obj2.s\" ?</p>\n</blockquote>\n<p>No reason, 2 obj1.s 1obj2.s could be better as max memory over time would be lesser</p>",
        "id": 246329563,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1626535145
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/246311075\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> I would think you want to use the exact same parsing/handling logic that you have/had as this is the basis for recursive transactions.</p>\n</blockquote>\n<p>Understood, will make this change</p>",
        "id": 246329678,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1626535314
    },
    {
        "content": "<p>Part of the reason for making it it same is so that the parsing logic is exactly the same as was used on _GLOBAL, so there's no duplicate code</p>",
        "id": 246388496,
        "sender_full_name": "Sean",
        "timestamp": 1626628137
    },
    {
        "content": "<p>Keep in mind that the string-based format is not the likely end-state.  That's just to keep it simple for now.  We'll want to change that to binary later.</p>",
        "id": 246388522,
        "sender_full_name": "Sean",
        "timestamp": 1626628199
    },
    {
        "content": "<p>Binary begs for a different storage container or binary attributes, which are things that will require testing and rethinking, so they're deferred until later.</p>",
        "id": 246388579,
        "sender_full_name": "Sean",
        "timestamp": 1626628233
    },
    {
        "content": "<p>(We have binary objects, but that code doesn't have any examples and needs to be enabled/tested.)</p>",
        "id": 246388591,
        "sender_full_name": "Sean",
        "timestamp": 1626628264
    },
    {
        "content": "<p>I'm trying to finish this recursive logic by today (with strings)</p>",
        "id": 246388599,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1626628278
    },
    {
        "content": "<p>The current string implementation is also flawed if an object name has spaces or quotes in it, but that's okay (for now).</p>",
        "id": 246388609,
        "sender_full_name": "Sean",
        "timestamp": 1626628307
    },
    {
        "content": "<p>binary will fix that later.</p>",
        "id": 246388619,
        "sender_full_name": "Sean",
        "timestamp": 1626628316
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/246017788\">said</a>:</p>\n<blockquote>\n<p>Also what is the best way to generate random names for these attribute objects, is there a built-in function?</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"102902\">@Sean</span> ping?</p>",
        "id": 246390425,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1626630948
    },
    {
        "content": "<p>just about any name can work for now, maybe try using ged_make_name()?  Could add a -r option if you really want something random.  It generates a sequential name.</p>",
        "id": 246395227,
        "sender_full_name": "Sean",
        "timestamp": 1626637994
    },
    {
        "content": "<p>so you could have it make something like .undo.###</p>",
        "id": 246395228,
        "sender_full_name": "Sean",
        "timestamp": 1626638011
    },
    {
        "content": "<p>Im refactoring a lot of code so that there very less redundant code, so it is taking some time. I will mostly complete the recursive function for executing actions today.</p>",
        "id": 246490408,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1626717941
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"353338\">@Vikram Atreya</span> that's great, keep it up.  Be sure to post updated code so I can check it out.</p>",
        "id": 246549212,
        "sender_full_name": "Sean",
        "timestamp": 1626762322
    },
    {
        "content": "<p>On that note, I think we should also code deep and address that fundamental issue supporting objects with special spaces in the name.  I suggest you introduce a separator, since that's pretty much the simplest thing you can do right now, at least that I can think of, to fix it.</p>",
        "id": 246549311,
        "sender_full_name": "Sean",
        "timestamp": 1626762458
    },
    {
        "content": "<p>I think you still want \"int[space]name\" pairings so you can assume the number is the code, followed by whitespace, followed by the object name.  I suggest something like '/' or ';' for the separator since they're problematic in names anyways.</p>",
        "id": 246549739,
        "sender_full_name": "Sean",
        "timestamp": 1626762919
    },
    {
        "content": "<p>You will want to make sure the object names you're writing do not have that separator in them (and if they do, just print a message and abort the undo recording).</p>",
        "id": 246549771,
        "sender_full_name": "Sean",
        "timestamp": 1626762964
    },
    {
        "content": "<p>If you don't know how to tokenize over a separator, it's something like this:</p>\n<div class=\"codehilite\" data-code-language=\"BBCode\"><pre><span></span><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\nint main(int ac, char *av[]) {\n  char *str = strdup(\"1 foo;2 bar;0 asjdsdfjal\");\n  char *token;\n  while ((token = strsep(&amp;str, \";\")) != NULL) {\n    printf(\"token is [%s]\\n\", token);\n  }\n  return 0;\n}\n</code></pre></div>",
        "id": 246549830,
        "sender_full_name": "Sean",
        "timestamp": 1626763022
    },
    {
        "content": "<p>I will make a PR soon.</p>",
        "id": 246562196,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1626773001
    },
    {
        "content": "<p>I have implemented the recursive logic to execute \"0 attr_obj\"</p>",
        "id": 246647203,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1626813990
    },
    {
        "content": "<p>So undo works for move now using the new logic</p>",
        "id": 246647229,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1626814008
    },
    {
        "content": "<p>I have written functions to reduce redundant code, but still haven't replaced it at all places <br>\nand there's a lot of useless code commented across files, ill remove all that and make a PR tomorrow</p>",
        "id": 246647326,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1626814065
    },
    {
        "content": "<p>Made a patch</p>",
        "id": 246774433,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1626899515
    },
    {
        "content": "<p>I havent yet randomized the names of the attribute objects<br>\nIm also planning on making modify into a grouped cmd using 0, instead of having 3</p>",
        "id": 246776666,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1626900642
    },
    {
        "content": "<p>Not sure I follow what you mean there..  You talking abou the modify \"code\", switching it from 3 to instead being the same as grouping, i.e., 0?</p>",
        "id": 246808645,
        "sender_full_name": "Sean",
        "timestamp": 1626929378
    },
    {
        "content": "<p>Not sure I see how that'd work.</p>",
        "id": 246808653,
        "sender_full_name": "Sean",
        "timestamp": 1626929389
    },
    {
        "content": "<p>Modify is nothing but kill the present object and recover old object</p>",
        "id": 246808821,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1626929641
    },
    {
        "content": "<p>So cant it be grouped as a kill+make</p>",
        "id": 246808864,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1626929660
    },
    {
        "content": "<p>I suppose that's true, just as how a rename operation can also be thought of as a make+kill, but handling it specifically would be a likely optimization to reduce memory churn.</p>",
        "id": 246818792,
        "sender_full_name": "Sean",
        "timestamp": 1626940852
    },
    {
        "content": "<p>Welcome to do it however you like but I'd suggest saving your time if it works.</p>",
        "id": 246818817,
        "sender_full_name": "Sean",
        "timestamp": 1626940875
    },
    {
        "content": "<p>Next I will focus on giving random names to attr objs and changing the code to store all backup objects as binary objects<br>\nrn only combination backup objects are stored as binay objects</p>",
        "id": 246819175,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1626941189
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"353338\">@Vikram Atreya</span> did you finish all the other parts?  that is, there is just one set of functions handling the storing/parsing of undo information from an attribute field (both _GLOBAL and stand-alone objects), attribute-only objects are working for groupings (case 0), code is refactored for all the commands from before, and undo is working with the recursive stores?</p>",
        "id": 247060319,
        "sender_full_name": "Sean",
        "timestamp": 1627110115
    },
    {
        "content": "<p>if so, next step I think would help greatly will be some basic unit tests that succeed and fail.  see src/libged/tests/test_tops.c for an example, but you'll want to make it call ged_undo() in various ways.  e.g., undo with no db, undo with db but no prior commands, undo after make, N undos after N makes, undo after unsupported command, etc</p>",
        "id": 247060708,
        "sender_full_name": "Sean",
        "timestamp": 1627110733
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/247060319\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> did you finish all the other parts?  that is, there is just one set of functions handling the storing/parsing of undo information from an attribute field (both _GLOBAL and stand-alone objects), attribute-only objects are working for groupings (case 0), code is refactored for all the commands from before, and undo is working with the recursive stores?</p>\n</blockquote>\n<p>At the top of my head, I feel all of this has been done, but I have still left some code from the previous logic just in case, the idea was switched again. I will clean that up first and check for all the things you have mentioned.</p>",
        "id": 247062588,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1627113794
    },
    {
        "content": "<p>I will get back to you tonight, once Im sure</p>",
        "id": 247062589,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1627113805
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/247060319\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> did you finish all the other parts?  that is, there is just one set of functions handling the storing/parsing of undo information from an attribute field (both _GLOBAL and stand-alone objects), attribute-only objects are working for groupings (case 0), code is refactored for all the commands from before, and undo is working with the recursive stores?</p>\n</blockquote>\n<p>Yes, all of this is done. There is some small bug in the code, after I changed it to store binary objects for all killed objects. Solving that right now</p>",
        "id": 247094469,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1627161743
    },
    {
        "content": "<p>when I store binary objects and try to recover them, I need to give it flags (SOLID/ COMB/ REGION). Can I found out what the object is from its external representation?</p>",
        "id": 247120388,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1627209687
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"353338\">@Vikram Atreya</span> it depends on what you mean by external representation.  if you serialized to a bu_external on-disk representation, then you'd get the type by cracking the header (getting a raw internal5).</p>",
        "id": 247454199,
        "sender_full_name": "Sean",
        "timestamp": 1627476874
    },
    {
        "content": "<p>I'm a little confused as to what you changed though -- kill shouldn't need to encode anything I'd think.. having it just store the object that was deleted seems ideal so that recovery is as simple as possibly renaming the object or just changing an attribute or similar.</p>",
        "id": 247454425,
        "sender_full_name": "Sean",
        "timestamp": 1627476976
    },
    {
        "content": "<p>what I thought you were working on was a way to story \"case 0\" groupings.  how to store their string into an object as there is no existing object to hang that information off of.  I suggested an attribute-only object, which is a special non-geometric object (_GLOBAL is an example... it's an object, but it's not geometry).</p>",
        "id": 247454558,
        "sender_full_name": "Sean",
        "timestamp": 1627477074
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/247454558\">said</a>:</p>\n<blockquote>\n<p>what I thought you were working on was a way to story \"case 0\" groupings.  how to store their string into an object as there is no existing object to hang that information off of.  I suggested an attribute-only object, which is a special non-geometric object (_GLOBAL is an example... it's an object, but it's not geometry).</p>\n</blockquote>\n<p>Right now, I am using attribute objects only</p>",
        "id": 247480681,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1627489141
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/247454425\">said</a>:</p>\n<blockquote>\n<p>I'm a little confused as to what you changed though -- kill shouldn't need to encode anything I'd think.. having it just store the object that was deleted seems ideal so that recovery is as simple as possibly renaming the object or just changing an attribute or similar.</p>\n</blockquote>\n<p>this was regarding to combination objects, they were planned to be stored as binary objects and then recovered.</p>",
        "id": 247480741,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1627489184
    },
    {
        "content": "<p>I thought of generalizing it to all objects</p>",
        "id": 247480764,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1627489196
    },
    {
        "content": "<p>I have written a few tests for make, kill and move</p>",
        "id": 247629602,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1627586858
    },
    {
        "content": "<p>I will also write tests for arb, mirror, etc tomorrow</p>",
        "id": 247629646,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1627586874
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"353338\">Vikram Atreya</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/247480764\">said</a>:</p>\n<blockquote>\n<p>I thought of generalizing it to all objects</p>\n</blockquote>\n<p>That does sound good if it really can be generalized so there's one code for all objects, but probably not a problem if combinations are handled separately (unless that means other objects will then also need to be handled separately like dsp or extrude or other objects that refer to other objects by name).</p>",
        "id": 247740222,
        "sender_full_name": "Sean",
        "timestamp": 1627667175
    },
    {
        "content": "<p>So if you can generalize it, great; but if not, that's probably okay too.</p>",
        "id": 247740250,
        "sender_full_name": "Sean",
        "timestamp": 1627667197
    },
    {
        "content": "<p>Yeah i'm generlaizing it</p>",
        "id": 247745093,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1627669670
    },
    {
        "content": "<p>Also what is the target that you are expecting before the end of the coding period?</p>",
        "id": 247745156,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1627669691
    },
    {
        "content": "<p>er, undo working for all commands, no? :)</p>",
        "id": 247778814,
        "sender_full_name": "Sean",
        "timestamp": 1627695933
    },
    {
        "content": "<p>All 300+ commands?</p>",
        "id": 247787001,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1627709177
    },
    {
        "content": "<p>Im right now focussing on killall, and a lot of simple commands can be dealt with quickly. but dbconcat might be a big challenge</p>",
        "id": 247872980,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1627845647
    },
    {
        "content": "<p>That's why it's important to take this one step at a time.  Once a half dozen commands are handled properly, the remaining 294 should actually be really easy (or perhaps even automatic for all but a few).</p>",
        "id": 247957418,
        "sender_full_name": "Sean",
        "timestamp": 1627931301
    },
    {
        "content": "<p>So right now i should proceed with killall?</p>",
        "id": 247958147,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1627931624
    },
    {
        "content": "<p>I will try to finish it by tomorrow</p>",
        "id": 247958161,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1627931636
    },
    {
        "content": "<p>For killall, I can have code within killall.c also right?<br>\nSince only having it in the wrapper will not suffice?</p>",
        "id": 248199539,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1627982924
    },
    {
        "content": "<p>ideally killall and the other commands are changed to emit/record the actions taken, so they can be undone</p>",
        "id": 248227157,
        "sender_full_name": "Sean",
        "timestamp": 1628000366
    },
    {
        "content": "<p>killall should be a chain of deletes that recurses dwon the tree, wouldn't just saving the deletes to journal be adequate? or does it need to be marked to go back several? (hehe, killall, the great linux vs unix litmus)</p>",
        "id": 248230804,
        "sender_full_name": "Erik",
        "timestamp": 1628001940
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"102902\">Sean</span> <a href=\"#narrow/stream/111975-Google-Summer.20of.20Code/topic/UNDO/near/248227157\">said</a>:</p>\n<blockquote>\n<p>ideally killall and the other commands are changed to emit/record the actions taken, so they can be undone</p>\n</blockquote>\n<p>Yes, so we write the changes to our action string, the code writing that event will be inside ged_killall_core</p>",
        "id": 248237443,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1628004675
    },
    {
        "content": "<p>killall is proving to be slightly tough, imnt getting the idea of exactly how ill do it. is there anything else I could focus on for sometime? <span class=\"user-mention\" data-user-id=\"102902\">@Sean</span></p>",
        "id": 248385598,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1628100222
    },
    {
        "content": "<p>For the final submission can I write the blog in brlcad's website?</p>",
        "id": 250230554,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1629570140
    },
    {
        "content": "<p>Absolutely <span class=\"user-mention\" data-user-id=\"353338\">@Vikram Atreya</span>.  We don't have a blog, but can post it as a page or put it in the wiki and we can showcase it on fb and our mailing list.</p>",
        "id": 250233912,
        "sender_full_name": "Sean",
        "timestamp": 1629575338
    },
    {
        "content": "<p>Sure, i will make a page on the wiki</p>",
        "id": 250234640,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1629576365
    },
    {
        "content": "<p>Is there any example from previous years?</p>",
        "id": 250234645,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1629576376
    },
    {
        "content": "<p>the gsoc archive page seems to be down</p>",
        "id": 250234654,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1629576385
    },
    {
        "content": "<p><a href=\"https://brlcad.org/wiki/User:Vikram_Atreya/GSoC21/Project_Report\">https://brlcad.org/wiki/User:Vikram_Atreya/GSoC21/Project_Report</a><br>\nThis is the link I have submitted for final evaluations, do suggest changes if any</p>",
        "id": 250337504,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1629717513
    },
    {
        "content": "<p>I think that looks pretty good.  Only suggestion would be to add a section with your thoughts on what's needed next, and what's needed to \"finish\" the effort -- for some definition of complete.</p>",
        "id": 250443850,
        "sender_full_name": "Sean",
        "timestamp": 1629782837
    },
    {
        "content": "<p>Sure will add it</p>",
        "id": 250525090,
        "sender_full_name": "Vikram Atreya",
        "timestamp": 1629828839
    }
]