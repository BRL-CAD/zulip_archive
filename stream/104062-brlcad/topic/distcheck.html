<html>
<head><meta charset="utf-8"><title>distcheck · brlcad · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/index.html">brlcad</a></h2>
<h3>Topic: <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/distcheck.html">distcheck</a></h3>

<hr>

<base href="https://brlcad.zulipchat.com">

<head><link href="https://brl-cad.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="455712803"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/distcheck/near/455712803" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/distcheck.html#455712803">(Aug 01 2024 at 17:30)</a>:</h4>
<p>Anyone else seeing distcheck-full errors on main?  I'm getting a handful that look like valid bugs:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>...
 35/922 Test  #33: bu_file ....................................................***Failed    0.01 sec

file [FAIL] test input file bu_file_test_dir/bu_file_1 is incorrectly reported to be executable
...
373/922 Test #374: bu_color_to_rgb_floats_1 ...................................***Failed    0.00 sec
Result: 0.752941,0.305882,0.839216
...
Start 922: ged_test_drawing_quad
919/922 Test #922: ged_test_drawing_quad ......................................Subprocess aborted***Exception:   0.00 sec
dyld[94599]: Library not loaded: @executable_path/../lib/libtcl8.6.dylib
  Referenced from: &lt;77324E71-4FC8-3FA9-B662-6DD9330C4344&gt; /Volumes/X10/brlcad/.build.debug/distcheck-in_src_dir/brlcad-7.40.1/src/libged/tests/draw/ged_test_quad
  Reason: tried: '/Volumes/X10/brlcad/.build.debug/distcheck-in_src_dir/brlcad-7.40.1/src/libged/tests/lib/libtcl8.6.dylib' (no such file)

920/922 Test #907: rt_cache_serial_multiple_different_objects .................   Passed    7.23 sec
921/922 Test #555: bu_mappedfile_serial_16384 .................................   Passed  100.26 sec
922/922 Test #556: bu_mappedfile_parallel_16384 ...............................   Passed  120.57 sec

99% tests passed, 12 tests failed out of 922

Total Test time (real) = 125.61 sec

The following tests FAILED:
         33 - bu_file (Failed)
        374 - bu_color_to_rgb_floats_1 (Failed)
        910 - rt_search_tests (Subprocess aborted)
        914 - ged_test_tops_moss (Subprocess aborted)
        915 - ged_test_list (Subprocess aborted)
        916 - ged_test_material (Subprocess aborted)
        917 - ged_test_search (Subprocess aborted)
        918 - ged_test_drawing_basic (Subprocess aborted)
        919 - ged_test_drawing_faceplate (Subprocess aborted)
        920 - ged_test_drawing_lod (Subprocess aborted)
        921 - ged_test_drawing_select (Subprocess aborted)
        922 - ged_test_drawing_quad (Subprocess aborted)
Errors while running CTest
</code></pre></div>
<p>First two look like bugs, subprocess looks to be maybe something wrong in the relocatability dylib/exec editing.</p>



<a name="455731489"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/distcheck/near/455731489" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/distcheck.html#455731489">(Aug 01 2024 at 18:52)</a>:</h4>
<p>I've not seen those errors - are they only in the in-src-dir config or do they pop up in others as well?</p>



<a name="455760039"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/distcheck/near/455760039" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/distcheck.html#455760039">(Aug 01 2024 at 21:31)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> I just ran distcheck-full… didn’t see any other errors.  I haven’t just run a plain distcheck too but was going to check that also.</p>



<a name="455794065"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/distcheck/near/455794065" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/distcheck.html#455794065">(Aug 02 2024 at 01:07)</a>:</h4>
<p>Just an update, ran make check and the errors are agnostic.  Fails debug and release on those tests, so something newish.</p>



<a name="455840434"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/distcheck/near/455840434" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/distcheck.html#455840434">(Aug 02 2024 at 06:08)</a>:</h4>
<p>Failures are also on RELEASE branch just the same. </p>
<p>Looking into the lib issues, looks like it's because the unit tests are wired wrong, as if they were installed into bin:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>morrison@Miniagua tests % ./ged_test_tops
dyld[47269]: Library not loaded: @executable_path/../lib/libtcl8.6.dylib
  Referenced from: &lt;82312D51-F510-33AC-9283-067C3FBAFF54&gt; /Volumes/X10/brlcad.RELEASE/.build.release/src/libged/tests/ged_test_tops
  Reason: tried: '/Volumes/X10/brlcad.RELEASE/.build.release/src/libged/lib/libtcl8.6.dylib' (no such file)
zsh: abort      ./ged_test_tops
morrison@Miniagua tests % DYLD_LIBRARY_PATH=../../../lib ./ged_test_tops
Usage: ./ged_test_tops file.g
morrison@Miniagua tests % otool -L ./ged_test_tops
./ged_test_tops:
    @rpath/libged.20.dylib (compatibility version 20.0.0, current version 20.0.1)
    @rpath/libanalyze.20.dylib (compatibility version 20.0.0, current version 20.0.1)
    @rpath/libwdb.20.dylib (compatibility version 20.0.0, current version 20.0.1)
    @rpath/liboptical.20.dylib (compatibility version 20.0.0, current version 20.0.1)
    @executable_path/../lib/libtcl8.6.dylib (compatibility version 8.6.0, current version 8.6.14)
    @rpath/libdm.20.dylib (compatibility version 20.0.0, current version 20.0.1)
    @rpath/libicv.20.dylib (compatibility version 20.0.0, current version 20.0.1)
    @rpath/libnetpbm.dylib (compatibility version 0.0.0, current version 0.0.0)
    @rpath/libutahrle.19.dylib (compatibility version 19.0.0, current version 19.0.1)
    @rpath/librt.20.dylib (compatibility version 20.0.0, current version 20.0.1)
    @rpath/libbrep.20.dylib (compatibility version 20.0.0, current version 20.0.1)
    @rpath/libnmg.dylib (compatibility version 0.0.0, current version 0.0.0)
    @rpath/libbv.20.dylib (compatibility version 20.0.0, current version 20.0.1)
    @rpath/libbg.20.dylib (compatibility version 20.0.0, current version 20.0.1)
    @rpath/libbn.20.dylib (compatibility version 20.0.0, current version 20.0.1)
    @rpath/libOpenNURBS.dylib (compatibility version 0.0.0, current version 0.0.0)
    @rpath/libmanifold.2.dylib (compatibility version 2.0.0, current version 2.4.5)
    @rpath/libassimp.5.dylib (compatibility version 5.0.0, current version 5.4.1)
    @rpath/libgeogram.1.dylib (compatibility version 1.0.0, current version 1.9.0)
    @rpath/libpkg.20.dylib (compatibility version 20.0.0, current version 20.0.1)
    @rpath/libbu.20.dylib (compatibility version 20.0.0, current version 20.0.1)
    /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1336.61.1)
    @rpath/png.framework/Versions/1.6.43/png (compatibility version 0.0.0, current version 0.0.0)
    @rpath/libz_brl.1.dylib (compatibility version 1.0.0, current version 1.3.1)
    @rpath/liblmdb.dylib (compatibility version 0.0.0, current version 0.0.0)
    @rpath/libregex_brl.1.dylib (compatibility version 1.0.0, current version 1.0.4)
morrison@Miniagua tests % pwd
/Volumes/X10/brlcad.RELEASE/.build.release/src/libged/tests
</code></pre></div>



<a name="456036621"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/distcheck/near/456036621" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/distcheck.html#456036621">(Aug 02 2024 at 20:24)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> investigated the dyld issue a few hours and don't understand why libtcl is being changed/installed with a @executable_path into the lib.  Do you recall why? </p>
<p>That seems to fundamentally be the issue.  If I replace @executable_path/../lib/libtcl8.6.dylib with @rpath/libtcl8.6.dylib like all the other libs, it works just fine.  I had to replace them in libtcl itself as well as all the libs and apps that link tcl, but presumably they're inheriting from libtcl's original setting.</p>
<p>I found the section in the patch file where you override it, but wanted to check why before mucking with it.</p>



<a name="456053022"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/distcheck/near/456053022" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/distcheck.html#456053022">(Aug 02 2024 at 22:27)</a>:</h4>
<p>At a guess I probably was using the settings from elsewhere in our build, and didn't properly clue in that I needed to go that route for libtcl</p>



<hr><p>Last updated: Aug 03 2024 at 00:39 UTC</p>
</html>