<html>
<head><meta charset="utf-8"><title>Architecture · brlcad · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/index.html">brlcad</a></h2>
<h3>Topic: <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/Architecture.html">Architecture</a></h3>

<hr>

<base href="https://brlcad.zulipchat.com">

<head><link href="https://brl-cad.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="164845169"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/Architecture/near/164845169" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/Architecture.html#164845169">(May 04 2019 at 02:25)</a>:</h4>
<p>This has been shared with a few developers already, but opening the discussion to a broader community for input, feedback, awareness.  It's a work-in-progress diagram showing a near-term path for BRL-CAD's major architecture, particularly as it relates to major libraries and a push towards a single graphical application framework. <a href="/user_uploads/1549/a7bRNbCM-cBju18SQOs9iB8N/BRL-CAD-Architecture-Prospectus.pdf" target="_blank" title="BRL-CAD-Architecture-Prospectus.pdf">BRL-CAD-Architecture-Prospectus.pdf</a></p>



<a name="164845766"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/Architecture/near/164845766" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/Architecture.html#164845766">(May 04 2019 at 02:43)</a>:</h4>
<p>The main implications of this are in line with the massive consolidation and reduction efforts announced over a year ago (to get command-line apps down below 10 and ged commands below 100), namely that a lot of the complexity that currently exists in command-line form is getting grouped together with related features or eliminated where out of scope, immature, and/or undeveloped.</p>
<p>It indicates we're planning to drop a few major dependencies (like Tcl/Tk for GUI) and adopt a few major dependencies that we've already proofed in some form (like Qt and OSPray for GUI) along with TBB and C++11 for our core runtime, the latter of which is already under way.</p>
<p>Some aspects are heavily dependent on how quickly GUI development matures and whether we can secure dedicated development support, but other work hinted at include integration of 3rd party framework like OSG for scene management, appleseed for advanced rendering, and possible consolidation of BU+BN+BG into a LIBBPR. </p>
<p>Not depicted but intended with this rearchitecting is a change to how BRL-CAD has been historically packaged and deployed.  Instead of hundreds of binaries with adhoc conflict with system facilities, adopting modern packaging standards for Mac, Linux, and Windows where there is a singular entry point into our ecosystem that can be made to comply with LSB, iOS, Windows 10, and other common standards.</p>



<a name="186419707"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/Architecture/near/186419707" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/Architecture.html#186419707">(Jan 23 2020 at 18:32)</a>:</h4>
<p>Hi All, it's been a year of reflection, so I've updated the architecture diagram.  This is in response to code discoveries, development, discussions, and more.  Feedback and discussion is of course always welcome, particularly from any of you new guys from GCI seeing things for the first time, and core devs of course.</p>



<a name="186419729"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/Architecture/near/186419729" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/Architecture.html#186419729">(Jan 23 2020 at 18:33)</a>:</h4>
<p><a href="/user_uploads/1549/TxmGQ84lI5Y-xEK7OXp6eaaN/BRL-CAD-Architecture-Prospectus.png" target="_blank" title="BRL-CAD-Architecture-Prospectus.png">BRL-CAD-Architecture-Prospectus.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/1549/TxmGQ84lI5Y-xEK7OXp6eaaN/BRL-CAD-Architecture-Prospectus.png" target="_blank" title="BRL-CAD-Architecture-Prospectus.png"><img src="/user_uploads/1549/TxmGQ84lI5Y-xEK7OXp6eaaN/BRL-CAD-Architecture-Prospectus.png"></a></div>



<a name="186419979"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/Architecture/near/186419979" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/Architecture.html#186419979">(Jan 23 2020 at 18:35)</a>:</h4>
<p>Just a note, but the spacings in the GUI app denote where we currently have code "air gapped" in separate repos.  The biggest change is making MOOSE be the main engine and interface through which the GUI represents and interacts with geometry.</p>



<a name="186421063"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/Architecture/near/186421063" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Rossberg <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/Architecture.html#186421063">(Jan 23 2020 at 18:47)</a>:</h4>
<p>I like the libcad <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="282142279"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/Architecture/near/282142279" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/Architecture.html#282142279">(May 12 2022 at 17:26)</a>:</h4>
<p><span class="user-mention" data-user-id="252475">@Himanshu Sekhar Nayak</span> diagram is maybe useful context?  This isn't the current state, but a proposed direction (at least that I'm slowly working towards)</p>



<a name="282145405"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/Architecture/near/282145405" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Himanshu <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/Architecture.html#282145405">(May 12 2022 at 17:47)</a>:</h4>
<p>Wow so many libraries that I have never seen and heard about it. In my free time, I will look into it. What I understand that MOOSE will be the main kernel where it will take requests from the GUI side and will send to the libraries. It is similar to what I know about OS kernel <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span>.</p>



<a name="282145737"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/Architecture/near/282145737" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Himanshu <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/Architecture.html#282145737">(May 12 2022 at 17:49)</a>:</h4>
<p>There will be one GUI for total number of command line applications or for each command line application there will be each gui?</p>



<a name="282147949"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/Architecture/near/282147949" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/Architecture.html#282147949">(May 12 2022 at 18:02)</a>:</h4>
<p>That's the hope/goal (for me at least) that there will be one primary GUI application environment built on top of MOOSE.  There will also be other CLI applications where needed (e.g., for rendering, image and data conversion, scripting needs, etc).</p>



<a name="529680578"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/Architecture/near/529680578" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Rossberg <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/Architecture.html#529680578">(Jul 20 2025 at 11:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112516">starseeker</span> <a href="#narrow/channel/111975-Google-Summer-of-Code/topic/New.20BRL-CAD.20GUI/near/529607057">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="102939">Daniel Rossberg</span> Is there a good example somewhere of an implementation of that pattern (ideally cross platform?)</p>
</blockquote>
<p><span class="user-mention" data-user-id="112516">@starseeker</span>, <span class="user-mention" data-user-id="102902">@Sean</span>, I think, this is more a general architectural discussion now:</p>
<p>Cross platform: yes, Open source: no. However, here are some principles and practice:</p>



<a name="529680655"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/Architecture/near/529680655" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Rossberg <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/Architecture.html#529680655">(Jul 20 2025 at 11:12)</a>:</h4>
<p>For the OS part, I use Qt. Doing this for every OS separately with its low-level functions would be error-prone and like a hare and tortoise game, when they decide to change something in their API for the new version. I.e., I do shared library handling with Qt.</p>



<a name="529682166"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/Architecture/near/529682166" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Rossberg <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/Architecture.html#529682166">(Jul 20 2025 at 11:36)</a>:</h4>
<p>There, I search for something like</p>
<div class="codehilite" data-code-language="C++"><pre><span></span><code><span class="n">BRLCAD_MODULE_EXPORT</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">RegisterBrlCadModule</span><span class="p">(</span><span class="n">BrlCadModuleRegisterCallback</span><span class="o">&amp;</span><span class="w"> </span><span class="n">callback</span><span class="p">);</span>
</code></pre></div>
<p>in the shared libraries. (In fact, it's C call and it looks for a <strong>RegisterBrlCadModule</strong> only.)</p>
<p>If <code>RegisterBrlCadModule</code> is found, it will be executed with a <code>BrlCadModuleCallback</code> object, which has methods like</p>
<div class="codehilite" data-code-language="C++"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">RegisterGedCommand</span><span class="p">(</span><span class="n">GedCommand</span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">create</span><span class="p">)(</span><span class="n">BRLCAD</span><span class="o">::</span><span class="n">Core</span><span class="o">&amp;</span><span class="p">)</span>
<span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">commandName</span><span class="p">,</span>
<span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">helpString</span><span class="p">);</span>
</code></pre></div>
<p>I.e., what's typed after <strong>commandName</strong> will be handed over to the corresponding <code>GedCommand</code> object.</p>



<a name="529682966"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/Architecture/near/529682966" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Rossberg <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/Architecture.html#529682966">(Jul 20 2025 at 11:48)</a>:</h4>
<p>Then, there are the "call-backs" to the core. One could imagine to make the important librt functionality, which cannot reached via <code>BRLCAD::Database</code>, accessible via a <code>BRLCAD::Core</code> object. But libbu stuff?</p>
<p>This can be done as a header-only implementation. For more complex objects, an additional source file can be provided, which had to be compiled and linked to the module's binary.</p>



<a name="529683457"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/Architecture/near/529683457" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Rossberg <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/Architecture.html#529683457">(Jul 20 2025 at 11:56)</a>:</h4>
<p>The memory management needs special attention. When the core and the module use different registries, one side cannot free what the other allocated. This already happens when booth sides where build with different versions of MS Visual Studio.</p>
<p>This issue can be solved by providing virtual functions for features, which require allocation or freeing of heap memory. Sometimes, even destructing of objects had to be done this way.</p>



<a name="530082560"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/Architecture/near/530082560" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/Architecture.html#530082560">(Jul 22 2025 at 07:18)</a>:</h4>
<p>Reviving an old architecture discussion thread, love it!  That diagram should be revisited, but it's an interesting reminder that relates to this discussion as well.</p>
<p>Qt to me is fine for apps to use, particularly as a layer to OS facilities, just as STL and Boost are -- but would be a significant architectural change to put underneath libbu for example, which nominally serves the same purpose but is more directly tested and dependency-free.  To balance the hare and tortoise game (which is practically non-existent for fundamental OS constructs), we've been adopting C11 and C++17 (and STL accordingly) underneath libbu.  I think that works pretty well.</p>
<p>Before diving deeper, though -- some sanity checks.  Are you describing what moose is currently doing, what you'd like it to do, what you think some brl-cad lib should be doing/providing for a general callback mechanism? </p>
<p>There is no "BRLCAD" library (at least not canonically) to register against at present, but libbu would nominally be the place to have a global publish-subscribe callback API that librt and/or libged and/or moose could use..</p>



<a name="530789958"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/Architecture/near/530789958" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Rossberg <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/Architecture.html#530789958">(Jul 25 2025 at 14:41)</a>:</h4>
<p>Therefore, MOOSE doesn't do it and I don't plan to implement it. I'ts just the requested example translated to BRL-CAD.</p>



<a name="531166136"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/Architecture/near/531166136" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Rossberg <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/Architecture.html#531166136">(Jul 27 2025 at 16:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112516">starseeker</span> <a href="#narrow/channel/111975-Google-Summer-of-Code/topic/New.20BRL-CAD.20GUI/near/530892509">said</a>:</p>
<blockquote>
<p>Hmm.  So I guess what you'd ideally like from the main BRL-CAD build would be a single <a href="http://libbrlad.so">libbrlad.so</a> with everything (including all the plugins) included?  And basically have some mechanism for the libged initializer to recognize that it already has the commands and doesn't need to try to load shared libraries?</p>
</blockquote>
<p><span class="user-mention" data-user-id="112516">@starseeker</span>, this is a much more general question ;)</p>
<p>However, the real question is: What do you want? What does the Army want? You Army people keep <a href="https://github.com/BRL-CAD/brlcad/commits/main/">heavily committing</a>. I cannot compete with you.</p>
<p>Usual development goals would be "easy to use" and "easy to contribute to", but you are moving in the opposite direction. I made myself a bit independent of it by using my C++ core interface. There, I handled the changes in the main BRL-CAD in the DLL, keeping its API stable. But with the changes in the build system, I don't know if it is still possible to build the usual brlcad.dll. I would need to say bext that it shall use static C-runtime linking, which doesn't work in general for sure, but maybe for the stuff needed to build the core libraries. This is some work I plan for the time after I got my new office PC.</p>
<p>BTW, because I don't need the ged stuff, I don't care much about the issues connected with it.</p>



<a name="532825122"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/Architecture/near/532825122" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/Architecture.html#532825122">(Aug 05 2025 at 03:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="102939">Daniel Rossberg</span> <a href="#narrow/channel/104062-brlcad/topic/Architecture/near/530789958">said</a>:</p>
<blockquote>
<p>Therefore, MOOSE doesn't do it and I don't plan to implement it. I'ts just the requested example translated to BRL-CAD.</p>
</blockquote>
<p>Been thinking about how something like this could be implemented more generally. <br>
 Seems like it has elements of bu_cmdtab (which is a simple string to function callback mechanism), but with some semblance of library scoping/registration, maybe auto-loading/unloading.</p>
<p>Do like the idea of implementing a more general publish/subscribe mechanism that extends to library callers.  There is already the cmdtab interface in libbu that binds</p>



<a name="532827334"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/Architecture/near/532827334" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/Architecture.html#532827334">(Aug 05 2025 at 03:33)</a>:</h4>
<p>The mechanism sounds almost identical to what Tcl itself does during library loading.  A special init function that can be automatically found and executed, which in turn performs registration.</p>
<p>Think that could possibly address the issue of a library being combined into another  static as it wouldn't find that one, but then the one it could find (e.g., libbrlcad) could call any other static lib init function(s).</p>



<hr><p>Last updated: Oct 23 2025 at 00:53 UTC</p>
</html>