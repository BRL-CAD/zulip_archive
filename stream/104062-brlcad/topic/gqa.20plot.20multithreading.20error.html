<html>
<head><meta charset="utf-8"><title>gqa plot multithreading error · brlcad · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/index.html">brlcad</a></h2>
<h3>Topic: <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/gqa.20plot.20multithreading.20error.html">gqa plot multithreading error</a></h3>

<hr>

<base href="https://brlcad.zulipchat.com">

<head><link href="https://brl-cad.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="220403214"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/gqa%20plot%20multithreading%20error/near/220403214" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/gqa.20plot.20multithreading.20error.html#220403214">(Dec 18 2020 at 17:33)</a>:</h4>
<p>Well, looks like I was wrong about the gqa multithreaded plotting failure being a recent issue - just confirmed its presence in r73078 (2019-05-17)</p>



<a name="220403791"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/gqa%20plot%20multithreading%20error/near/220403791" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/gqa.20plot.20multithreading.20error.html#220403791">(Dec 18 2020 at 17:37)</a>:</h4>
<p>It DID work in r71532</p>



<a name="220404074"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/gqa%20plot%20multithreading%20error/near/220404074" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/gqa.20plot.20multithreading.20error.html#220404074">(Dec 18 2020 at 17:39)</a>:</h4>
<p>r72000 works</p>



<a name="220404350"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/gqa%20plot%20multithreading%20error/near/220404350" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/gqa.20plot.20multithreading.20error.html#220404350">(Dec 18 2020 at 17:41)</a>:</h4>
<p>r72500 works</p>



<a name="220404837"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/gqa%20plot%20multithreading%20error/near/220404837" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/gqa.20plot.20multithreading.20error.html#220404837">(Dec 18 2020 at 17:45)</a>:</h4>
<p>r73011 works</p>



<a name="220405352"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/gqa%20plot%20multithreading%20error/near/220405352" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/gqa.20plot.20multithreading.20error.html#220405352">(Dec 18 2020 at 17:49)</a>:</h4>
<p>r73012 doesn't work</p>



<a name="220407649"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/gqa%20plot%20multithreading%20error/near/220407649" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/gqa.20plot.20multithreading.20error.html#220407649">(Dec 18 2020 at 18:02)</a>:</h4>
<p>r73053 doesn't work, r73054 does, r73077 does, r73078 doesn't.  So those correspond to:</p>
<p>r73012 - initial introduction of the new semaphore specification system<br>
r73054 - revert to previous system due to Windows issues<br>
r73078 - second introduction of new semaphore specification system</p>



<a name="220407721"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/gqa%20plot%20multithreading%20error/near/220407721" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/gqa.20plot.20multithreading.20error.html#220407721">(Dec 18 2020 at 18:03)</a>:</h4>
<p>Looks like the GQA multithreaded plotting was a causality of the semaphore changes.  Now the question is why...</p>



<a name="220408236"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/gqa%20plot%20multithreading%20error/near/220408236" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/gqa.20plot.20multithreading.20error.html#220408236">(Dec 18 2020 at 18:07)</a>:</h4>
<p><span class="user-mention" data-user-id="102902">@Sean</span> Am I correct that 2019 semaphore changes are pretty thoroughly out of context?  If so I'll try to dig into this, but I can't claim it's my forte...</p>



<a name="220411949"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/gqa%20plot%20multithreading%20error/near/220411949" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/gqa.20plot.20multithreading.20error.html#220411949">(Dec 18 2020 at 18:39)</a>:</h4>
<p>No, they're not out of context.  They're entangled with the threaded debugging I was working on.  Let me take a stab at reproducing the issue -- what steps are you taking to observe the failure?</p>



<a name="220412044"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/gqa%20plot%20multithreading%20error/near/220412044" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/gqa.20plot.20multithreading.20error.html#220412044">(Dec 18 2020 at 18:40)</a>:</h4>
<p>I added a test in latest trunk... hang on, let me get the sequence</p>



<a name="220412267"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/gqa%20plot%20multithreading%20error/near/220412267" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/gqa.20plot.20multithreading.20error.html#220412267">(Dec 18 2020 at 18:42)</a>:</h4>
<p>Setup is running a gqa multi threaded plotting example:</p>
<div class="codehilite"><pre><span></span><code>./bin/gqa -Ao -p ovlp_ ../src/libged/tests/ged_tests.g ovlp
Trying initial grid spacing: 50 mm
Using grid spacing lower limit: 0.005 mm
Plotting overlaps to ovlp_overlaps.plot3
Processing with grid spacing 50 mm 44 x 48 x 39
Summary (50mm grid spacing):
list Overlaps:
/ovlp/r1 /ovlp/r2 count:2277 dist:1780.3mm @ (-248 350 -903.325)
</code></pre></div>
<p>Then the new utility to validate the plot file:</p>
<div class="codehilite"><pre><span></span><code>./src/libbn/tests/bn_plot3 -b ovlp_overlaps.plot3
INVALID: ovlp_overlaps.plot3
</code></pre></div>



<a name="220412335"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/gqa%20plot%20multithreading%20error/near/220412335" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/gqa.20plot.20multithreading.20error.html#220412335">(Dec 18 2020 at 18:43)</a>:</h4>
<p>ok cool, i'll try that</p>



<a name="220412357"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/gqa%20plot%20multithreading%20error/near/220412357" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/gqa.20plot.20multithreading.20error.html#220412357">(Dec 18 2020 at 18:43)</a>:</h4>
<p>As a control, you can do the same thing but add -P 1 to the gqa line - in that mode I get:</p>
<div class="codehilite"><pre><span></span><code>./src/libbn/tests/bn_plot3 -b ovlp_overlaps.plot3
VALID:   ovlp_overlaps.plot3
</code></pre></div>



<a name="220450846"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/gqa%20plot%20multithreading%20error/near/220450846" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/gqa.20plot.20multithreading.20error.html#220450846">(Dec 19 2020 at 03:15)</a>:</h4>
<p>O.o<br>
gqa test on bz:</p>
<div class="codehilite"><pre><span></span><code>gqa &quot;-P&quot; &quot;1&quot; &quot;-Ao&quot; &quot;-p&quot; &quot;ovlp_&quot; &quot;/home/user/brlcad/src/gtools/tests/../../libged/tests/ged_tests.g&quot; &quot;ovlp&quot;
878: Test timeout computed to be: 1500
878: Trying initial grid spacing: 50 mm
878: Using grid spacing lower limit: 0.005 mm
878: Plotting overlaps to ovlp_overlaps.plot3
878: Processing with grid spacing 50 mm 44 x 48 x 39
878: bu_semaphore_init(): could not initialize 11106121 semaphores, max is 1024
1/4 Test #878: gqa_plot .........................***Failed    0.09 sec
</code></pre></div>



<a name="220451387"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/gqa%20plot%20multithreading%20error/near/220451387" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/gqa.20plot.20multithreading.20error.html#220451387">(Dec 19 2020 at 03:28)</a>:</h4>
<p>78020 may fix that bit - gets the failure back down to just the multithreaded plot verification</p>



<a name="225340177"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/gqa%20plot%20multithreading%20error/near/225340177" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/gqa.20plot.20multithreading.20error.html#225340177">(Feb 05 2021 at 18:51)</a>:</h4>
<p><span class="user-mention" data-user-id="102902">@Sean</span>  I added a semaphore guard for plotting specifically to the gqa code - on Linux, the multithreaded test is passing now.  Don't know if that's the long term fix, but hopefully it will do for release.</p>



<hr><p>Last updated: Nov 10 2024 at 00:49 UTC</p>
</html>