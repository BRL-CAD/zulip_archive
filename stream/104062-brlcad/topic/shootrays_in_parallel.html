<html>
<head><meta charset="utf-8"><title>shootrays_in_parallel · brlcad · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/index.html">brlcad</a></h2>
<h3>Topic: <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html">shootrays_in_parallel</a></h3>

<hr>

<base href="https://brlcad.zulipchat.com">

<head><link href="https://brl-cad.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="192803804"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/192803804" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#192803804">(Apr 03 2020 at 13:31)</a>:</h4>
<p>Hello All<br>
I was  planning to complete shootrays_in_parallel function  to speed up.  I could not understand " (while (rays-&gt;ap[i].a_magic != RT_AP_MAGIC)) "why Magic numbers are neccessary in the shootrays_in_parallel function. struct application has already initilalized with RT_AP_MAGIC so the while loop is already False ?<br>
It would be good to get some help <br>
stay safe</p>



<a name="192818865"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/192818865" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Erik <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#192818865">(Apr 03 2020 at 15:12)</a>:</h4>
<p>it's a BU_LIST iirc, which is circular and uses that to understand the "beginning"/"end" somehow</p>



<a name="192820440"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/192820440" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#192820440">(Apr 03 2020 at 15:22)</a>:</h4>
<p><span class="user-mention" data-user-id="103542">@Erik</span>  still could not understand. what is iirc ?</p>



<a name="192829891"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/192829891" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Erik <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#192829891">(Apr 03 2020 at 16:30)</a>:</h4>
<p>iirc == "if I recall correctly". I'm old. it's been a while. I could be wrong.</p>



<a name="192831546"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/192831546" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#192831546">(Apr 03 2020 at 16:41)</a>:</h4>
<p><span class="user-mention" data-user-id="103542">@Erik</span>  why BU_BITSET is neccessary ? to shift bits after the shoot ?</p>



<a name="193367632"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/193367632" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#193367632">(Apr 08 2020 at 19:28)</a>:</h4>
<p>Before the shoot do I need to run rt_prerp_parallel or rt_prep ? I do not know the difference actually...</p>



<a name="193718952"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/193718952" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#193718952">(Apr 12 2020 at 16:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="228172">scorp08</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/193367632" title="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/193367632">said</a>:</p>
<blockquote>
<p>Before the shoot do I need to run rt_prerp_parallel or rt_prep ? I do not know the difference actually...</p>
</blockquote>
<p>Any help would be great  :)</p>



<a name="193726139"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/193726139" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Erik <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#193726139">(Apr 12 2020 at 19:17)</a>:</h4>
<p>if I remember, just one or the other. they both do the same thing, one just does it in parallel (good for smp, not so much for single core). might wanna check the docs, though</p>



<a name="194526185"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/194526185" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#194526185">(Apr 18 2020 at 04:53)</a>:</h4>
<p><span class="user-mention" data-user-id="228172">@scorp08</span> it's not that BU_BITSET is necessary, but the code must define some way for multiple threads to coordinate, and there needs to be some book keeping.</p>
<p>BU_BITSET does both, conveniently.</p>



<a name="194526187"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/194526187" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#194526187">(Apr 18 2020 at 04:53)</a>:</h4>
<p>it's atomic, or at least close enough to atomic for testing purposes, and it's a set of flags that can help keep track of what's been done.</p>



<a name="200822438"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/200822438" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#200822438">(Jun 14 2020 at 16:04)</a>:</h4>
<p>Hello<br>
I finally got time  yesterday. I tried a couple of stuff, shooted rays without error but  not sure if it is parallel.  Could you pls check and  guide me ?? Here is the file <a href="/user_uploads/1549/kVlhHMNoqSh6w_4IWleHGDWf/rt_shootrays_parallel.c">rt_shootrays_parallel.c</a></p>



<a name="200903984"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/200903984" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#200903984">(Jun 15 2020 at 15:22)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="228172">@scorp08</span> at a glance, this looks like it could work in parallel.  I'm just not sure it's right book-keeping without some in-depth testing.  You're loop is centered around the nbits array becoming zero, so it may depend on how the caller initialized the initial threads and ray_num.  It's definitely on the right track for a semaphore-protected approach.  You do want to call rt_shootray outside of semaphore protection, otherwise the threads will all end up waiting on each other.</p>



<a name="201233579"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/201233579" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#201233579">(Jun 18 2020 at 07:01)</a>:</h4>
<p>I tested but It seems my loop is not a  proper  way. Could not figure it out, also tried with different ways</p>



<a name="201463259"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/201463259" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#201463259">(Jun 20 2020 at 05:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="228172">scorp08</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/201233579">said</a>:</p>
<blockquote>
<p>I tested but It seems my loop is not a  proper  way. Could not figure it out, also tried with different ways</p>
</blockquote>
<p>It would  be great to get help :)</p>



<a name="201964277"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/201964277" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#201964277">(Jun 25 2020 at 12:52)</a>:</h4>
<p><span class="user-mention" data-user-id="228172">@scorp08</span> Can you post the latest version of your code and any other changes you've made?</p>



<a name="208075694"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/208075694" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#208075694">(Aug 26 2020 at 10:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="102902">Sean</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/201964277">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="228172">scorp08</span> Can you post the latest version of your code and any other changes you've made?</p>
</blockquote>
<p><span class="user-mention" data-user-id="102902">@Sean</span>  Hello, and sorry for my late reply , holiday and virus issues. Did not do much changes. Just added an  nray variable  to the struct and while loop inside  the function. I am not sure how to proceed :)</p>



<a name="208109033"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/208109033" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#208109033">(Aug 26 2020 at 15:40)</a>:</h4>
<p><span class="user-mention" data-user-id="228172">@scorp08</span> can you share your code here?</p>



<a name="212221817"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/212221817" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#212221817">(Oct 04 2020 at 12:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="102902">Sean</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/208109033">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="228172">scorp08</span> can you share your code here?</p>
</blockquote>
<p><span class="user-mention" data-user-id="102902">@Sean</span>  Hello , l Iost the drive but did not do much change than posted  code. I could not  spend time more on it unfortunately. :/</p>



<a name="213900742"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/213900742" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#213900742">(Oct 20 2020 at 10:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="228172">scorp08</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/212221817">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="102902">Sean</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/208109033">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="228172">scorp08</span> can you share your code here?</p>
</blockquote>
<p><span class="user-mention silent" data-user-id="102902">Sean</span>  Hello , l Iost the drive but did not do much change than posted  code. I could not  spend time more on it unfortunately. :/</p>
</blockquote>
<p>Any help is great for me :)))</p>



<a name="214079054"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/214079054" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#214079054">(Oct 21 2020 at 16:45)</a>:</h4>
<p><span class="user-mention" data-user-id="228172">@scorp08</span> Did you take a look at how the rt* tools shoot rays in parallel?  take a look at src/rt/worker.c</p>



<a name="214079095"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/214079095" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#214079095">(Oct 21 2020 at 16:45)</a>:</h4>
<p>understanding how they work is probably a good first step towards making a parallel function as they shoot in parallel</p>



<a name="214079135"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/214079135" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#214079135">(Oct 21 2020 at 16:45)</a>:</h4>
<p>one possible approach is to simply do what they're doing in a function.</p>



<a name="214297416"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/214297416" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#214297416">(Oct 23 2020 at 10:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="102902">Sean</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/214079054">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="228172">scorp08</span> Did you take a look at how the rt* tools shoot rays in parallel?  take a look at src/rt/worker.c</p>
</blockquote>
<p>Hello, thanks I did some changes and it worked ! I run with 10 million ray (all hit) and got around x8 speed-up with my  old 12 core  laptop (measured with chrono and disabled all log functions  in my bundle_hit function). However at the end rt_clean(rtip) returned with error , probably issue about resource free operation. Could not figure it out.  Can I upload here my bundle.c file here ?</p>



<a name="214341460"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/214341460" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#214341460">(Oct 23 2020 at 17:24)</a>:</h4>
<p><span class="user-mention" data-user-id="228172">@scorp08</span> that's amazing, congratulations!  absolutely, can share files here any time without asking.</p>



<a name="214347987"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/214347987" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#214347987">(Oct 23 2020 at 18:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="102902">Sean</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/214341460">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="228172">scorp08</span> that's amazing, congratulations!  absolutely, can share files here any time without asking.</p>
</blockquote>
<p>ok, here... <a href="/user_uploads/1549/iEFuJCvC7EVEizu0GCpRu_hl/bundle.c">bundle.c</a></p>



<a name="214475291"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/214475291" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#214475291">(Oct 25 2020 at 07:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="228172">scorp08</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/214347987">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="102902">Sean</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/214341460">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="228172">scorp08</span> that's amazing, congratulations!  absolutely, can share files here any time without asking.</p>
</blockquote>
<p>ok, here... <a href="/user_uploads/1549/iEFuJCvC7EVEizu0GCpRu_hl/bundle.c">bundle.c</a></p>
</blockquote>
<p>is there a good way to shoot 10^7 or more rays , eliminating memory limits. I tried with heap allocation but it is still near limits...</p>



<a name="214492851"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/214492851" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#214492851">(Oct 25 2020 at 14:42)</a>:</h4>
<p><span class="user-mention" data-user-id="228172">@scorp08</span> the typical way for shooting massive quantities of rays is to do them in batches.  typically done with something like a streaming queue where rays are added as needed, and rays are bundled together into smaller sets (like 64x64) and evaluated until there are no more.</p>



<a name="214493001"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/214493001" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#214493001">(Oct 25 2020 at 14:44)</a>:</h4>
<p>I looked over your bundle.c code .. impressive work from different directions! </p>
<p>so I see you have one version that is basically the entire guts to rt_shootrays and you have this shootrays_in_parallel version, right?  which one are you working on ?</p>



<a name="214493016"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/214493016" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#214493016">(Oct 25 2020 at 14:45)</a>:</h4>
<p>I ask only because it looks like shootrays_in_parallel is disabled.</p>



<a name="214493033"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/214493033" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#214493033">(Oct 25 2020 at 14:45)</a>:</h4>
<p>and I don't see the other being used</p>



<a name="214509050"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/214509050" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#214509050">(Oct 25 2020 at 20:01)</a>:</h4>
<p>the typical way for shooting massive quantities of rays is to do them in batches. typically done with something like a streaming queue where rays are added as needed, and rays are bundled together into smaller sets (like 64x64) and evaluated until there are no more.<br>
<span class="user-mention silent" data-user-id="102902">Sean</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/214493001">said</a>:</p>
<blockquote>
<p>I looked over your bundle.c code .. impressive work from different directions! </p>
<p>so I see you have one version that is basically the entire guts to rt_shootrays and you have this shootrays_in_parallel version, right?  which one are you working on ?</p>
</blockquote>
<p><span class="user-mention" data-user-id="102902">@Sean</span>  Thanks It should be active, I worked in shootrays_in_parallel  (putted a #define SHOOTRAYS_IN_PARALLEL).   I could not imagine how to use a queue, could you direct me to a tutorial or any other resource so I understand this kind of streaming proccess ?</p>



<a name="214681123"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/214681123" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#214681123">(Oct 27 2020 at 10:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="102902">Sean</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/214492851">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="228172">scorp08</span> the typical way for shooting massive quantities of rays is to do them in batches.  typically done with something like a streaming queue where rays are added as needed, and rays are bundled together into smaller sets (like 64x64) and evaluated until there are no more.</p>
</blockquote>
<p><span class="user-mention" data-user-id="102902">@Sean</span>  If divided into batches, continously respawning of threads can lead similar time of running as serial shooting(not parallel) ?</p>



<a name="215287050"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/215287050" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#215287050">(Nov 02 2020 at 07:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="102902">Sean</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/214341460">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="228172">scorp08</span> that's amazing, congratulations!  absolutely, can share files here any time without asking.</p>
</blockquote>
<p><span class="user-mention" data-user-id="102902">@Sean</span> <br>
I did some changes both rt_shootrays and shootrays_in_parallel. Measured the speedup wtih time.h.  It is about x2  , I do not know why it is so low <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span>  <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span>  . I compared with rtcheck which is quite fast with same number of rays.  Is It because I build dll   files and link my exe  (librt and deps.), check all stuff in run time ? Here is the bundle.c <a href="/user_uploads/1549/c44r6YSVzCYezr0BSfedOTlK/bundle.c">bundle.c</a></p>



<a name="217967546"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/217967546" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#217967546">(Nov 26 2020 at 05:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="228172">scorp08</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/215287050">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="102902">Sean</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/214341460">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="228172">scorp08</span> that's amazing, congratulations!  absolutely, can share files here any time without asking.</p>
</blockquote>
<p><span class="user-mention silent" data-user-id="102902">Sean</span> <br>
I did some changes both rt_shootrays and shootrays_in_parallel. Measured the speedup wtih time.h.  It is about x2  , I do not know why it is so low <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span>  <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span>  . I compared with rtcheck which is quite fast with same number of rays.  Is It because I build dll   files and link my exe  (librt and deps.), check all stuff in run time ? Here is the bundle.c <a href="/user_uploads/1549/c44r6YSVzCYezr0BSfedOTlK/bundle.c">bundle.c</a></p>
</blockquote>
<p>does anybody had a chance to check the file:)) ??</p>



<a name="219167017"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/219167017" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#219167017">(Dec 08 2020 at 03:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="228172">scorp08</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/217967546">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="228172">scorp08</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/215287050">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="102902">Sean</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/214341460">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="228172">scorp08</span> that's amazing, congratulations!  absolutely, can share files here any time without asking.</p>
</blockquote>
<p><span class="user-mention silent" data-user-id="102902">Sean</span> <br>
I did some changes both rt_shootrays and shootrays_in_parallel. Measured the speedup wtih time.h.  It is about x2  , I do not know why it is so low <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span>  <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span>  . I compared with rtcheck which is quite fast with same number of rays.  Is It because I build dll   files and link my exe  (librt and deps.), check all stuff in run time ? Here is the bundle.c <a href="/user_uploads/1549/c44r6YSVzCYezr0BSfedOTlK/bundle.c">bundle.c</a></p>
</blockquote>
<p>does anybody had a chance to check the file:)) ??</p>
</blockquote>
<p>guess no <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span> <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>



<a name="219167082"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/219167082" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#219167082">(Dec 08 2020 at 03:16)</a>:</h4>
<p>Sorry <span class="user-mention" data-user-id="228172">@scorp08</span> I haven't had a chance to set up the profiling to see why</p>



<a name="219167096"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/219167096" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#219167096">(Dec 08 2020 at 03:16)</a>:</h4>
<p>It's not due to dll linkage</p>



<a name="219167100"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/219167100" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#219167100">(Dec 08 2020 at 03:16)</a>:</h4>
<p>I can say that :)</p>



<a name="219167128"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/219167128" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#219167128">(Dec 08 2020 at 03:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="102902">Sean</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/219167082">said</a>:</p>
<blockquote>
<p>Sorry <span class="user-mention silent" data-user-id="228172">scorp08</span> I haven't had a chance to set up the profiling to see why</p>
</blockquote>
<p>not a technical issue  I guess</p>



<a name="219167133"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/219167133" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#219167133">(Dec 08 2020 at 03:18)</a>:</h4>
<p>A low rate means you have a bottleneck.  Threads are waiting on something they'll all trying to access simultaneously.</p>



<a name="219167304"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/219167304" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#219167304">(Dec 08 2020 at 03:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="102902">Sean</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/219167133">said</a>:</p>
<blockquote>
<p>A low rate means you have a bottleneck.  Threads are waiting on something they'll all trying to access simultaneously.</p>
</blockquote>
<p>I actually gained around x3 speedup , measured before and after bu_parallel(), but free struct re  and others after  bu_parallel,  takes too long, thats I guess one of the problem</p>



<a name="219167319"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/219167319" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#219167319">(Dec 08 2020 at 03:21)</a>:</h4>
<p>well it's technical in the sense that it requires setting up profile to see what's going on -- that is something fun you can set up if you're interesting in learning more about performance.  The Intel profiler is free and really quite good.</p>



<a name="219167598"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/219167598" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#219167598">(Dec 08 2020 at 03:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="102902">Sean</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/219167319">said</a>:</p>
<blockquote>
<p>well it's technical in the sense that it requires setting up profile to see what's going on -- that is something fun you can set up if you're interesting in learning more about performance.  The Intel profiler is free and really quite good.</p>
</blockquote>
<p>Oh, okay I'll look,  V-tune . I dont know it is required a pre- knowledge of architecture or any other technical point of view. It seems very hand to use</p>



<a name="219169834"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/219169834" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#219169834">(Dec 08 2020 at 04:15)</a>:</h4>
<p>It doesn't require knowledge of arch</p>



<a name="219169888"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/219169888" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#219169888">(Dec 08 2020 at 04:16)</a>:</h4>
<p>you basically compile and then run from inside vtune and it watches the program.  then it shows you were in the code it spent the most time.</p>



<a name="220469913"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/220469913" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#220469913">(Dec 19 2020 at 13:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="102902">Sean</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/219169888">said</a>:</p>
<blockquote>
<p>you basically compile and then run from inside vtune and it watches the program.  then it shows you were in the code it spent the most time.</p>
</blockquote>
<p><span class="user-mention" data-user-id="102902">@Sean</span>  I did a check with Vtune and bu_parallel seems ok  (all  threads are active) and it is faster than serial shoots but Rtfreeheap in windows seems  the most time spent So in total execution time is longer than  serial shoots. I missed something while free all the memory in parallel. How should I free resources and partion lists etc. after bu_parallel??<br>
By the way, Vtune is very handy to use, shows everything you need.</p>



<a name="221199837"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/221199837" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#221199837">(Dec 30 2020 at 09:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="228172">scorp08</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/220469913">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="102902">Sean</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/219169888">said</a>:</p>
<blockquote>
<p>you basically compile and then run from inside vtune and it watches the program.  then it shows you were in the code it spent the most time.</p>
</blockquote>
<p><span class="user-mention silent" data-user-id="102902">Sean</span>  I did a check with Vtune and bu_parallel seems ok  (all  threads are active) and it is faster than serial shoots but Rtfreeheap in windows seems  the most time spent So in total execution time is longer than  serial shoots. I missed something while free all the memory in parallel. How should I free resources and partion lists etc. after bu_parallel??<br>
By the way, Vtune is very handy to use, shows everything you need.</p>
</blockquote>
<p>Any cleanup help ?:))</p>



<a name="224585392"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/224585392" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#224585392">(Jan 30 2021 at 13:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="228172">scorp08</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/221199837">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="228172">scorp08</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/220469913">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="102902">Sean</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/219169888">said</a>:</p>
<blockquote>
<p>you basically compile and then run from inside vtune and it watches the program.  then it shows you were in the code it spent the most time.</p>
</blockquote>
<p><span class="user-mention silent" data-user-id="102902">Sean</span>  I did a check with Vtune and bu_parallel seems ok  (all  threads are active) and it is faster than serial shoots but Rtfreeheap in windows seems  the most time spent So in total execution time is longer than  serial shoots. I missed something while free all the memory in parallel. How should I free resources and partion lists etc. after bu_parallel??<br>
By the way, Vtune is very handy to use, shows everything you need.</p>
</blockquote>
<p>Any cleanup help ?:))</p>
</blockquote>
<p>I feel my cleanup help in the box <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span> <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>



<a name="224970428"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/224970428" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#224970428">(Feb 03 2021 at 03:40)</a>:</h4>
<p><span class="user-mention" data-user-id="228172">@scorp08</span> Sorry I was on vacation when you first wrote and then I've been focused on our github migration since.  If vtune is showing most time in rtfreeheap, that sounds like a problem...</p>



<a name="226224395"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/226224395" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#226224395">(Feb 13 2021 at 03:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="102902">Sean</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/224970428">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="228172">scorp08</span> Sorry I was on vacation when you first wrote and then I've been focused on our github migration since.  If vtune is showing most time in rtfreeheap, that sounds like a problem...</p>
</blockquote>
<p>Is it the free of resource and partion_list the problem ( I guess so)</p>



<a name="226772555"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/226772555" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#226772555">(Feb 18 2021 at 07:10)</a>:</h4>
<p>That would be a good guess.  It should only be freeing the heap when it's all done.  Perhaps you have it re-initializing and releasing/cleaning the rtip every ray or something.</p>



<a name="226772598"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/226772598" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#226772598">(Feb 18 2021 at 07:11)</a>:</h4>
<p>try not releasing any memory, does performance improve dramatically?  You don't want that for anything production, but it can help figure out where time is going in parallel.</p>



<a name="232086875"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/232086875" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#232086875">(Mar 27 2021 at 12:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="102902">Sean</span> <a href="#narrow/stream/104062-general/topic/shootrays_in_parallel/near/226772555">said</a>:</p>
<blockquote>
<p>That would be a good guess.  It should only be freeing the heap when it's all done.  Perhaps you have it re-initializing and releasing/cleaning the rtip every ray or something.</p>
</blockquote>
<p>after long time :) If I call rt_clean_resource , do I need to call also  RT_FREE_SEG_LIST ? or   rt_clean_resource  also handle it ?</p>



<a name="232215562"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/232215562" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#232215562">(Mar 29 2021 at 04:04)</a>:</h4>
<p><span class="user-mention" data-user-id="228172">@scorp08</span> My point earlier was that you may be calling some expensive cleanup too frequently... like cleaning up resources.  You shouldn't need to clean very often and Rtfreeheap shouldn't be where most time is spent.</p>



<a name="232215897"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/232215897" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#232215897">(Mar 29 2021 at 04:10)</a>:</h4>
<p>Still, to answer your question, rt_clean_resource is only going to reset the re_seg segments (by simply dropping the pointers), and free the rt_seg_blocks (pool of segments).  If you're not dealing with those, then you very well will likely need to call RT_FREE_SEG_LIST (e.g., on finished_segs).</p>



<a name="244814440"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/104062-brlcad/topic/shootrays_in_parallel/near/244814440" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scorp08 <a href="https://brl-cad.github.io/zulip_archive/stream/104062-brlcad/topic/shootrays_in_parallel.html#244814440">(Jul 03 2021 at 16:55)</a>:</h4>
<p>here is a small result  from my experiment. I run with rt and parallel (12 cpu) ,1 cpu. what I did is ,  I generate same nhit counts and arrange the nrays according to nhit since I shoot from the same point in rt_shootrays but it is changing in rt . So basically nray is lower in rt_shootrays than rt but at the end ,  same nhit. <a href="/user_uploads/1549/9zJVMpt-TpJtNjz2coXlDPC8/results.dat">results.dat</a></p>



<hr><p>Last updated: Dec 07 2025 at 01:01 UTC</p>
</html>