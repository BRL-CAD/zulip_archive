<html>
<head><meta charset="utf-8"><title>search -exec · Google Summer of Code · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/index.html">Google Summer of Code</a></h2>
<h3>Topic: <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html">search -exec</a></h3>

<hr>

<base href="https://brlcad.zulipchat.com">

<head><link href="https://brl-cad.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="126678319"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/126678319" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#126678319">(May 17 2018 at 03:25)</a>:</h4>
<blockquote>
<p>I realized I didn't make a proper announciation so I'm doing that now:<br>
<a href="https://brlcad.org/wiki/User:Paddedto10/GSoC18/Project" target="_blank" title="https://brlcad.org/wiki/User:Paddedto10/GSoC18/Project">https://brlcad.org/wiki/User:Paddedto10/GSoC18/Project</a></p>
<p>I've already written some code but my commits are local so far. (using git svn)</p>
</blockquote>
<p>Thanks for the intro <span class="user-mention" data-user-id="111633">@Peter Pronai</span>, looking forward to seeing your project in action!  Before you make a bunch of local commits, please remember to submit patches so progress can be incrementally inspected and discussed.</p>
<p>Ideally, you should carve off the most simple patch(es) you can think of and submit them for review.  Typically, two "perfect" patches will earn you commit rights so you can do all those commits to the actual repository.</p>



<a name="126755415"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/126755415" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#126755415">(May 18 2018 at 15:33)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> should I send patches of the smaller changes I have so far? it's just some typedefs/additional fields + the c_exec function is implemented, although I would like nicer error handling in it, but that would probably take some larger changes, outside of that specific function.</p>



<a name="126777601"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/126777601" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#126777601">(May 19 2018 at 01:07)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> sure, go ahead and submit the patch if it's in a clean state</p>



<a name="126779702"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/126779702" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#126779702">(May 19 2018 at 02:28)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> At least with GCC 8 locally here, I can now build strict with latest trunk.</p>



<a name="126836814"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/126836814" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#126836814">(May 20 2018 at 16:26)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span>  oh forgot to write this: yup, strict build now works here as well</p>
<p>other thing: I think I'm basically done with the librt part of things, so the next thing would be actually changing db_search to actually accept the new arguments (the exec handler and the userdata), but that would mean having to rewrite every call to it, and there seem to be a lot of them</p>



<a name="126836820"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/126836820" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#126836820">(May 20 2018 at 16:27)</a>:</h4>
<p>of course none of them use -exec _now_, so it'd be fine to just pass some NULL pointers, but later that might lead to problems</p>



<a name="126836870"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/126836870" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#126836870">(May 20 2018 at 16:29)</a>:</h4>
<p>alternative: I could write the TCL exec evaluation function for MGED and test it on its own, and I still need to actually deliver on my promise to do TDD but the CMake testing is quite intimidating, so I've been putting it off</p>



<a name="126836921"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/126836921" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#126836921">(May 20 2018 at 16:30)</a>:</h4>
<p>so, I think I'll do a head first dive into the testing framework and set up the tests for the currently existing functionality and then I'll do another dive into the TCL API</p>



<a name="126903753"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/126903753" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#126903753">(May 22 2018 at 02:56)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> Out of curiosity, why start with Tcl?</p>



<a name="126903801"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/126903801" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#126903801">(May 22 2018 at 02:58)</a>:</h4>
<p>We need to be able to exec libged commands, which as a starting point would avoid the need to tangle with the Tcl API.</p>



<a name="126903811"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/126903811" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#126903811">(May 22 2018 at 02:59)</a>:</h4>
<p>I'd also suggest prototyping a db_search function signature, so we can think about how we want to set up the API</p>



<a name="126919197"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/126919197" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#126919197">(May 22 2018 at 11:52)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span>  I already have the part that calls the callback, writing the MGED side exec handler sounded like something I could do relatively easily, but it's a lot more complicated than I thought.</p>



<a name="126925949"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/126925949" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#126925949">(May 22 2018 at 14:28)</a>:</h4>
<p>well, it's not exactly complicated, more like not very well documented. I just have to call a Tcl command with a list of strings as its parameters.</p>



<a name="126925960"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/126925960" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#126925960">(May 22 2018 at 14:29)</a>:</h4>
<p>but idk which API calls are relevant</p>



<a name="126925977"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/126925977" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#126925977">(May 22 2018 at 14:29)</a>:</h4>
<p>anyways, I think I'll do tests instead</p>



<a name="127060936"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127060936" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127060936">(May 25 2018 at 02:32)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> is calling libged functions directly actually needed? since they get registered as TCL commands, it makes more sense to me to just call them from TCL. That also makes things like calling TCL builtins more straightforward.</p>



<a name="127111257"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127111257" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127111257">(May 26 2018 at 02:02)</a>:</h4>
<p>TCL is (eventually) going to be pushed out of the lower level libraries (including libged) and will live only in libtclcad and above.  So TCL shouldn't be necessary to the core functioning of the system.</p>



<a name="127149676"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127149676" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127149676">(May 27 2018 at 03:15)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> Do you have a "working" -exec option to search?  If so, what does your new db_search function callback look like?</p>



<a name="127149767"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127149767" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127149767">(May 27 2018 at 03:19)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> You'll need to be able to pass a function callback into db_search and execute it - how are you thinking to set this up?  It shouldn't be Tcl specific</p>



<a name="127149805"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127149805" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127149805">(May 27 2018 at 03:20)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> not yet, I'm doing one of the parts I've been putting off: changing the function signatures so I can pass the callback and the userdata around. It's almost done, just one definition left to change.</p>
<p>I also looked into where libged's "commands" are used and it does seem to me like they are only used in MGED.</p>
<p>I postponed the MGED side callback because I thought it will be better if I can test it properly with db_search. Testing the function on its own, without db_search being done, would have meant having to figure out a bunch of build system things and that would have just been wasted time.</p>



<a name="127149814"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127149814" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127149814">(May 27 2018 at 03:21)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> before I sent my proposal we agreed with <span class="user-mention" data-user-id="102902">@Sean</span> on the following:<br>
callback function takes an int argc, char *argv[], and a void *userdata</p>



<a name="127149815"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127149815" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127149815">(May 27 2018 at 03:21)</a>:</h4>
<p>the userdata in MGED's case is the Tcl interpeter pointer</p>



<a name="127149817"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127149817" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127149817">(May 27 2018 at 03:21)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> OK, so the argv array is the path list from the search run?</p>



<a name="127149857"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127149857" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127149857">(May 27 2018 at 03:22)</a>:</h4>
<p>the argv is what the command is called with, the '{}' get replaced with the current node's path</p>



<a name="127149899"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127149899" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127149899">(May 27 2018 at 03:24)</a>:</h4>
<p>I think this is as abstract as it can usefully get. It supports every argc/argv kind of command reasonable.</p>



<a name="127149900"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127149900" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127149900">(May 27 2018 at 03:24)</a>:</h4>
<p>OK, so the -exec "template" will be populated on a per-search-path basis and the function will be execed separately on each path?</p>



<a name="127149904"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127149904" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127149904">(May 27 2018 at 03:24)</a>:</h4>
<p>Yes, exacly. Can't really do it any other way as far as I know.</p>



<a name="127149913"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127149913" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127149913">(May 27 2018 at 03:25)</a>:</h4>
<p>something like: search /  -name "a*.r" -exec "myfunc --special-option1 --special-option2 {}"</p>



<a name="127149951"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127149951" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127149951">(May 27 2018 at 03:26)</a>:</h4>
<p>and a ';' at the end</p>



<a name="127149956"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127149956" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127149956">(May 27 2018 at 03:26)</a>:</h4>
<p>oh wait. nah, nvm, that's only in the search syntax</p>



<a name="127149957"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127149957" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127149957">(May 27 2018 at 03:26)</a>:</h4>
<p>libged then uses a function table to look up the function in question (translating "myfunc" into an actual function) and the options and {} are assembled on a per path basis as the arguments to that function.</p>



<a name="127149958"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127149958" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127149958">(May 27 2018 at 03:26)</a>:</h4>
<p>it doesn't get passed.</p>



<a name="127149963"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127149963" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127149963">(May 27 2018 at 03:27)</a>:</h4>
<p>libged is not touched directly, Tcl already has the functions registered so it is left up to Tcl to call them</p>



<a name="127149965"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127149965" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127149965">(May 27 2018 at 03:27)</a>:</h4>
<p>otherwise it wouldn't be able to handle:<br>
-renamed functions<br>
-Tcl builtins</p>



<a name="127149968"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127149968" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127149968">(May 27 2018 at 03:28)</a>:</h4>
<p>That might work for a first cut, but libged will eventually not have any direct knowledge of Tcl</p>



<a name="127150008"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127150008" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127150008">(May 27 2018 at 03:28)</a>:</h4>
<p>MGED (or libtclcad) will need to register a callback for handling Tcl processing with libged</p>



<a name="127150013"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127150013" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127150013">(May 27 2018 at 03:29)</a>:</h4>
<p>hmmm, can you give an example where it won't work?</p>



<a name="127150014"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127150014" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127150014">(May 27 2018 at 03:29)</a>:</h4>
<p>the current one, I mean.</p>



<a name="127150067"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127150067" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127150067">(May 27 2018 at 03:31)</a>:</h4>
<p>For now, as long as any command you want to run is known to the Tcl command execution environment, that should work.  But my point is that eventually we don't want to assume Tcl in order to run commands.  Let's say someone makes a Python version of MGED.  Or they want to link to libged and construct their own search commands programattically, then register their own custom exec function callbacks with libged and run them on the search results.</p>



<a name="127150109"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127150109" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127150109">(May 27 2018 at 03:32)</a>:</h4>
<p>You can start with Tcl execing in order to get something going for testing, but once that is demonstrated we need to think about how to generalize things.</p>



<a name="127150116"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127150116" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127150116">(May 27 2018 at 03:33)</a>:</h4>
<p>(the latter scenario in particular - linking to libged and supplying customer defined exec functions to run - is fairly likely to crop up eventually)</p>



<a name="127150117"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127150117" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127150117">(May 27 2018 at 03:33)</a>:</h4>
<p>Hmm, I guess if it's Python, we would have to indicate which parameter is the path, so that it is presented as the right type.</p>



<a name="127150165"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127150165" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127150165">(May 27 2018 at 03:35)</a>:</h4>
<p>I guess if the customer links to libged directly, we can provide a pre-made callback that simply searches for commands in the command table and calls them directly. That's even easier than the Tcl evaling.</p>



<a name="127150168"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127150168" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127150168">(May 27 2018 at 03:35)</a>:</h4>
<p>Well, if the function callback hook is a generic int my_exec_func(int argc, const char **argv, void *userdata) and the exec string supplied to the -exec search option is broken out into the argv input passed to my_exec_func (after replacing {} with one path) then the only questions are how to match the string "my_exec_func" in the search -exec function to the actual function pointer to call and how to pass all that around</p>



<a name="127150216"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127150216" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127150216">(May 27 2018 at 03:37)</a>:</h4>
<p>oh, the callback is not the one that is matched, the callback does the matching</p>



<a name="127150217"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127150217" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127150217">(May 27 2018 at 03:37)</a>:</h4>
<p>right - we need some way (probably in libged) to define a language agnostic "string to exec function pointer" mapping that can be populated, and then either pass that map to the db_search call so it can figure out how to do the exec there, or have libged do the string to pointer breakdown ahead of time and pass the actual exec pointer to db_search</p>



<a name="127150258"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127150258" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127150258">(May 27 2018 at 03:38)</a>:</h4>
<p>if you're almost there with a design, go ahead and finish and we can use that as a basis for further discussion</p>



<a name="127150264"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127150264" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127150264">(May 27 2018 at 03:39)</a>:</h4>
<p>ok, I'll fix this part that I'm working on then call it a day</p>



<a name="127150266"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127150266" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127150266">(May 27 2018 at 03:39)</a>:</h4>
<p>I guess we could make the callback function find the "actual" function that will do the work... not sure about that one.</p>



<a name="127150267"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127150267" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127150267">(May 27 2018 at 03:39)</a>:</h4>
<p>sounds good.</p>



<a name="127150268"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127150268" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127150268">(May 27 2018 at 03:39)</a>:</h4>
<p>also,seeing how I've changed db_search's prototype, there will be a lot of broken calls to it</p>



<a name="127150309"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127150309" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127150309">(May 27 2018 at 03:40)</a>:</h4>
<p>don't worry about that too much yet - let's see how you're thinking about changing it before you go too far.</p>



<a name="127150313"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127150313" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127150313">(May 27 2018 at 03:41)</a>:</h4>
<p>yeah, better stay focused</p>



<a name="127150317"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127150317" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127150317">(May 27 2018 at 03:41)</a>:</h4>
<p>btw I have my code up on gitlab if you wanna take a look:<br>
<a href="https://gitlab.com/raingloom/brlcad/" target="_blank" title="https://gitlab.com/raingloom/brlcad/">https://gitlab.com/raingloom/brlcad/</a></p>



<a name="127150318"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127150318" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127150318">(May 27 2018 at 03:41)</a>:</h4>
<p>the relevant branch is "gsoc-search-exec"</p>



<a name="127150358"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127150358" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127150358">(May 27 2018 at 03:42)</a>:</h4>
<p>anyways, back to work</p>



<a name="127207968"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127207968" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127207968">(May 28 2018 at 14:26)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> so, I'm trying to fit the exec specific parameters into ged_search but it breaks the command tab, so I'm thinking about adding it to <code>struct ged</code>. Is that ok? Is this supposed to be thread safe and stuff?</p>



<a name="127208005"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127208005" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127208005">(May 28 2018 at 14:26)</a>:</h4>
<p>command tab?</p>



<a name="127208051"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127208051" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127208051">(May 28 2018 at 14:28)</a>:</h4>
<p>this thing: src/libtclcad/tclcad_obj.c:989</p>



<a name="127208102"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127208102" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127208102">(May 28 2018 at 14:28)</a>:</h4>
<p>it depends on all the functions having the same prototype</p>



<a name="127208200"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127208200" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127208200">(May 28 2018 at 14:30)</a>:</h4>
<blockquote>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> so, I'm trying to fit the exec specific parameters into ged_search but it breaks the command tab, so I'm thinking about adding it to <code>struct ged</code>. Is that ok? Is this supposed to be thread safe and stuff?</p>
</blockquote>
<p>many commands have custom command hooks, so you shouldn't need to modify the struct ged...</p>



<a name="127208390"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127208390" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127208390">(May 28 2018 at 14:35)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> I think the way that's going to have to be handled is to have the calling code "wrap up" the to_cmds information into one container struct that can be passed through the generic exec function, and then have an "unpack and run" function that is the actual hook function supplied to search exec for the Tcl commands.  In essence, the unpack function will serve as the dispatcher to the to_cmd interface.</p>



<a name="127208460"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127208460" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127208460">(May 28 2018 at 14:36)</a>:</h4>
<p>basically, "unpack" will turn the argv string exec generates and the contents of the data structure into a to_cmd call.</p>



<a name="127264353"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127264353" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127264353">(May 29 2018 at 17:55)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> where would the client entry point(s) be? There is a <code>to_open_tcl</code> that seems to allow for some userdata.</p>



<a name="127282980"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127282980" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127282980">(May 30 2018 at 00:50)</a>:</h4>
<p>I'm not following - what do you mean by client entry points?</p>



<a name="127283200"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127283200" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127283200">(May 30 2018 at 00:56)</a>:</h4>
<blockquote>
<p>I think the way that's going to have to be handled is to have the calling code "wrap up" the to_cmds information</p>
</blockquote>
<p>I'm trying to figure out where the client code would do this and which info to wrap</p>



<a name="127284761"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127284761" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127284761">(May 30 2018 at 01:48)</a>:</h4>
<p>Ah.  <span class="user-mention" data-user-id="102902">@Sean</span> , what would be the "right" way to pass application client data through a libged command call?</p>



<a name="127284769"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127284769" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127284769">(May 30 2018 at 01:49)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> in this particular case you could probably use the ged_interp pointer in struct ged for testing purposes - it's not intended to be relied upon (at least, not in that form) but right now I believe that's holding the Tcl interpreter used by the libged commands working with Tcl.</p>



<a name="127284819"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127284819" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127284819">(May 30 2018 at 01:50)</a>:</h4>
<p>So a libged db_search call could pass the gedp-&gt;ged_interp pointer through the call with a void cast, and then your "run_to_cmd" function would cast it back to a Tcl_Interp before calling the actual to_cmd.</p>



<a name="127284826"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127284826" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127284826">(May 30 2018 at 01:51)</a>:</h4>
<p>Probably the ged_interp should morph into a generic "userdata" pointer</p>



<a name="127284985"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127284985" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127284985">(May 30 2018 at 01:56)</a>:</h4>
<p>struct ged is defined in include/ged/defines.h</p>



<a name="127285107"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127285107" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127285107">(May 30 2018 at 02:00)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> thanks! Gonna try that.</p>



<a name="127292390"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127292390" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127292390">(May 30 2018 at 06:12)</a>:</h4>
<blockquote>
<p>Ah.  <span class="user-mention" data-user-id="102902">@Sean</span> , what would be the "right" way to pass application client data through a libged command call?</p>
</blockquote>
<p>the only way for a librt function to call into libged state without creating an architecture cycle or violating modularity is for librt to take a function pointer AND a data pointer (which both get passed to the function).  qsort() is a quintessential example of this.</p>
<p>there are common ways for doing this statefully (e.g., context = db_search_register_callback(mycallback); db_search(context, ...); // data passed internally or explicitly) or stateless (e.g., db_search(mycallback, ...); // data passed internally or explicitly).</p>



<a name="127292449"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127292449" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127292449">(May 30 2018 at 06:13)</a>:</h4>
<p>since you're talking about an interpreter, it likely needs to be explicit</p>



<a name="127292550"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127292550" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127292550">(May 30 2018 at 06:16)</a>:</h4>
<p>which in that pattern could be as simple as a separate db_search_register_data() call</p>
<p>so with a stateful context, something like ctx = db_search_context_create(); db_search_register_exec(ctx, callback); db_search_register_data(ctx, interp);</p>



<a name="127447328"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127447328" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127447328">(Jun 02 2018 at 01:20)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> How are things going?</p>



<a name="127449226"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127449226" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127449226">(Jun 02 2018 at 02:25)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> the last few days were a bit hectic so I'm catching up with the coding today, I just finished modifying librt to use a single context struct pointer instead of separate userdata and callback parameters</p>



<a name="127449228"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127449228" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127449228">(Jun 02 2018 at 02:25)</a>:</h4>
<p>right now i'm building mged to see where it broke and where i have to change things in libged</p>



<a name="127612340"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127612340" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127612340">(Jun 05 2018 at 17:39)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> ok, so I have some basic eval thing working, specifically this:</p>
<div class="codehilite"><pre><span></span>% echo &#39;search * -exec echo yay &quot;;&quot;&#39; | ./bin/mged ../../db/axis.g
yay
</pre></div>


<p>produces some output without crashing</p>
<p>but I think it should be printing that multiple times?? not sure what's going on on the Tcl side, I should probably look at existing scripts for commands I should try.</p>



<a name="127612481"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127612481" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127612481">(Jun 05 2018 at 17:42)</a>:</h4>
<p>I tried <code>-exec true ";"</code> but it gives an "invalid command name: true" in the log....but still prints every item.....</p>
<p>oh, of course, this is not a C main, 0 is abnormal return here</p>



<a name="127613337"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127613337" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127613337">(Jun 05 2018 at 18:00)</a>:</h4>
<p>-exec echo "{}" ";" seems to do the right thing now but it only printed one path, no idea why. but it returned true for everything so exec printed them all</p>



<a name="127613454"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127613454" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127613454">(Jun 05 2018 at 18:02)</a>:</h4>
<p>That looks like invalid find/search syntax.. asterisk?</p>



<a name="127613643"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127613643" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127613643">(Jun 05 2018 at 18:07)</a>:</h4>
<p>Might I suggest running in immediate mode:  mged f.g obj search . -exec echo yay \;</p>



<a name="127613731"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127613731" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127613731">(Jun 05 2018 at 18:09)</a>:</h4>
<p>That way you know exactly what the argc/argv should be.</p>



<a name="127613981"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127613981" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127613981">(Jun 05 2018 at 18:14)</a>:</h4>
<p><span class="user-mention" data-user-id="102902">@Sean</span> the -exec true and the current -exec echo I'm trying are without the asterisk</p>



<a name="127614069"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127614069" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127614069">(Jun 05 2018 at 18:16)</a>:</h4>
<p>i know that the f_exec in the plan is evaluated the right number of times so it must be something else messing up</p>



<a name="127614099"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127614099" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127614099">(Jun 05 2018 at 18:17)</a>:</h4>
<p>this is what <code>echo 'search -exec echo "{}" ";"' | ./bin/mged ../../db/axis.g</code> does:</p>
<div class="codehilite"><pre><span></span>/axis/x.r/x
X1
X2
X
X.r
...bunch more names
</pre></div>



<a name="127743938"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127743938" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127743938">(Jun 07 2018 at 23:05)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> ok so I think I know what's going on and it's probably not my code that's wrong</p>
<p>I've noticed that many parts of the code actually "print" into memory, the echo output I see there is the last node in the db that librt looked at, so what's probably happening is:</p>
<ul>
<li>there is a buffer</li>
<li>Tcl <code>echo</code> writes to that buffer</li>
<li>Tcl <code>echo</code> overwrites that buffer when it's called again</li>
<li>Tcl <code>echo</code> should be appending, not overwriting</li>
<li>or it should at least flush to stdout</li>
<li>basic Tcl I/O is broken and that's.... quite sad, really.</li>
</ul>
<p>anyways, I guess that's the core functionality done??</p>



<a name="127744656"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127744656" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127744656">(Jun 07 2018 at 23:24)</a>:</h4>
<p>ah. apparently it might not be broken, just.... really, <strong>really</strong> weird and counterintuitive</p>
<p>one would think that <code>echo</code> prints to stdout, right? but no, there is a result field in Tcl_Interp</p>
<p>I guess that should be printed after every Tcl_Eval??? this is weird, why would somebody want this??? can't this be done with pipes???</p>



<a name="127778113"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127778113" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127778113">(Jun 08 2018 at 15:34)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> well, I added an extra <code>puts()</code> call so now the eval function I wrote takes care of printing, but it still comes <strong>after</strong> the Tcl output (in this case: the list of found items) unless I explicitly <code>fflush(stdout)</code></p>



<a name="127778143"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127778143" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127778143">(Jun 08 2018 at 15:35)</a>:</h4>
<p>but yeah, that's... about it??? should I send a patch so others can try it as well?</p>



<a name="127778237"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127778237" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127778237">(Jun 08 2018 at 15:36)</a>:</h4>
<p>what I think _could_ be done:<br>
the context is currently the last parameter, but leaving the database pointer to be last might be better? it would be pretty easy to switch their order.</p>



<a name="127778295"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127778295" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127778295">(Jun 08 2018 at 15:37)</a>:</h4>
<p>BSD find has the <code>-ok</code> variant, which asks before execution, is this needed?<br>
then there is the "{}" "+" version, which adds things at the end. that's just a minor change in the parser</p>



<a name="127778482"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127778482" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127778482">(Jun 08 2018 at 15:41)</a>:</h4>
<p>also, <code>find(1)</code> does not have the implicit <code>-print</code> when <code>-exec</code> or <code>-ok</code> are present, leaving printing up to them</p>
<p>however, librt does not actually print, it just returns an array and the interpeter has no easy way to do that, so I think this should be left out to keep things simple??? or the presence of <code>-exec</code> should be communicated towards the client code, so that it can decide if it wants to do implicit printing</p>



<a name="127778563"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127778563" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127778563">(Jun 08 2018 at 15:42)</a>:</h4>
<p>oh and of course existing code outside mged that uses db_search beeds to be updated</p>



<a name="127779547"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127779547" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127779547">(Jun 08 2018 at 16:03)</a>:</h4>
<p>it's not broken -- tcl does exactly what we tell it to do so if the behavior isn't right, it's pretty much on us -- and how it's been set up in mged/libged</p>



<a name="127779610"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127779610" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127779610">(Jun 08 2018 at 16:04)</a>:</h4>
<p>there is a result field and most commands call Tcl_AppendResult to add to it.  some commands clear the result before printing to start fresh, some merely append, some return a partial result and tell tcl more will come later</p>



<a name="127796972"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127796972" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127796972">(Jun 08 2018 at 22:34)</a>:</h4>
<p>yeah, figured it out later, but damn that was frustrating. i'm used to I/O working on the standard files, so this was very weird.</p>



<a name="127796992"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127796992" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127796992">(Jun 08 2018 at 22:35)</a>:</h4>
<p>so, what should I do with the remaining thingies? what to implement? what to change?</p>



<a name="127803090"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127803090" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127803090">(Jun 09 2018 at 01:58)</a>:</h4>
<p>I'd get things working across the system first (update all the db_search calls, add documentation to the man page for search including syntax documentation and examples)</p>



<a name="127803097"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127803097" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127803097">(Jun 09 2018 at 01:59)</a>:</h4>
<p>what is the new db_search function signature?</p>



<a name="127803101"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127803101" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127803101">(Jun 09 2018 at 01:59)</a>:</h4>
<p>definitely put together a patch so other people can try it out</p>



<a name="127875482"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127875482" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127875482">(Jun 11 2018 at 00:39)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> submitted patch on SF</p>



<a name="127875706"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127875706" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127875706">(Jun 11 2018 at 00:46)</a>:</h4>
<p>the sig is the same except there is a <code>ctx</code> parameter at the end</p>



<a name="127931217"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127931217" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127931217">(Jun 12 2018 at 02:28)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> ok, got it right this time, the Tcl result is now properly interpreted<br>
I only tested it with <code>search -exec echo yes ";"</code> and <code>search -exec echo no ";"</code> so far, but those work.</p>



<a name="127932249"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127932249" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127932249">(Jun 12 2018 at 03:05)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> your latest patch file on sourceforge is empty?</p>



<a name="127932343"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127932343" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127932343">(Jun 12 2018 at 03:07)</a>:</h4>
<p>...wha... oh hell.</p>



<a name="127932391"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127932391" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127932391">(Jun 12 2018 at 03:08)</a>:</h4>
<p>a sec, gonna regenerate it</p>



<a name="127932394"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127932394" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127932394">(Jun 12 2018 at 03:08)</a>:</h4>
<p>np</p>



<a name="127932577"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127932577" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127932577">(Jun 12 2018 at 03:14)</a>:</h4>
<p>well this is... odd... <code>git diff master</code> works but <code>git diff master -- &lt;some files I took from the diff output&gt;</code> produces an empty output</p>



<a name="127932875"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127932875" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127932875">(Jun 12 2018 at 03:23)</a>:</h4>
<p>ok, i uploaded it again</p>



<a name="127932989"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127932989" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127932989">(Jun 12 2018 at 03:27)</a>:</h4>
<p>OK, one thing I see right away - you're allocating the db_search_context with bu_malloc, but calling free on it rather than bu_free.  I'd recommend for this situation, if you're going to have a db_search_context_create function, you also add a db_search_context_destroy to handle the deallocation.</p>



<a name="127933053"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127933053" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127933053">(Jun 12 2018 at 03:29)</a>:</h4>
<p>minor point - mged_db_search_callback  has some trailing whitespace in it, which we generally try to avoid.</p>



<a name="127933112"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127933112" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127933112">(Jun 12 2018 at 03:31)</a>:</h4>
<p>For vim, I use this trick to highlight it:  <a href="https://stackoverflow.com/questions/4617059/showing-trailing-spaces-in-vim" target="_blank" title="https://stackoverflow.com/questions/4617059/showing-trailing-spaces-in-vim">https://stackoverflow.com/questions/4617059/showing-trailing-spaces-in-vim</a></p>



<a name="127933118"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127933118" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127933118">(Jun 12 2018 at 03:31)</a>:</h4>
<p>Not sure what other editors do... Sean can probably advise on Emacs</p>



<a name="127933173"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127933173" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127933173">(Jun 12 2018 at 03:33)</a>:</h4>
<p>I uh, use Acme. &gt;_&gt;</p>



<a name="127933231"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127933231" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127933231">(Jun 12 2018 at 03:34)</a>:</h4>
<p>heh.  maybe this? (untested):  <a href="https://gist.github.com/echosa/a5fd4b6637718c455e43" target="_blank" title="https://gist.github.com/echosa/a5fd4b6637718c455e43">https://gist.github.com/echosa/a5fd4b6637718c455e43</a></p>



<a name="127933371"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127933371" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127933371">(Jun 12 2018 at 03:38)</a>:</h4>
<p>I'll probably just run <code>sed -i</code> over them <span class="emoji emoji-1f937" title="shrug">:shrug:</span></p>



<a name="127933380"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127933380" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127933380">(Jun 12 2018 at 03:39)</a>:</h4>
<p>that way I don't even have to open the files</p>



<a name="127933792"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127933792" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127933792">(Jun 12 2018 at 03:52)</a>:</h4>
<p>that works too</p>



<a name="127984684"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/127984684" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#127984684">(Jun 13 2018 at 01:53)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> did you get a chance to update the patch?</p>



<a name="128009924"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128009924" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128009924">(Jun 13 2018 at 14:01)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> if you have it all working, check out the manual page for search (brlman search) and see which of the examples it has at the end can turn into shorter search -exec examples.  it's also a good test set in general to make sure everything is working right.</p>



<a name="128021973"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128021973" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128021973">(Jun 13 2018 at 18:16)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> I changed the calls to bu_free but I haven't uploaded it yet, I will in a bit<br>
<span class="user-mention" data-user-id="102902">@Sean</span> thanks, I'll check those (and add some examples with -exec)</p>



<a name="128085643"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128085643" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128085643">(Jun 14 2018 at 20:46)</a>:</h4>
<p>bu_free complains at runtime about freeing a null pointer, but afaik <code>free(0)</code> is supposed to be a no-op??? does this need an extra check?</p>



<a name="128150165"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128150165" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128150165">(Jun 16 2018 at 01:12)</a>:</h4>
<p>Erm.  <span class="user-mention" data-user-id="102902">@Sean</span> , is bu_free supposed to be OK in that situation?</p>



<a name="128222615"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128222615" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128222615">(Jun 18 2018 at 00:44)</a>:</h4>
<p>i'm trying to do the examples in the manpage but uhh, i'm getting errors and since Tcl is <strong>so</strong> amazing, it doesn't even tell me where the error comes from</p>



<a name="128222617"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128222617" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128222617">(Jun 18 2018 at 00:44)</a>:</h4>
<p>like... this: <code>echo [expr {int(rand()*225)+30}]</code></p>
<p><code>extra characters after close-brace</code></p>
<p><span class="emoji emoji-1f622" title="cry">:cry:</span></p>



<a name="128222624"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128222624" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128222624">(Jun 18 2018 at 00:45)</a>:</h4>
<p>and when it doesn't error it just prints it as a string</p>
<p>uhhggjhlkhl</p>



<a name="128222625"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128222625" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128222625">(Jun 18 2018 at 00:45)</a>:</h4>
<p>i'm reading a tutorial but so far it's been about the standard library</p>



<a name="128222673"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128222673" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128222673">(Jun 18 2018 at 00:47)</a>:</h4>
<p>and that's a reduced example, the one in the manpage was bigger and gave the same error</p>



<a name="128222679"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128222679" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128222679">(Jun 18 2018 at 00:47)</a>:</h4>
<p>well. i didn't run it directly so maybe this is some weird context sensitive thing</p>



<a name="128223170"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128223170" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128223170">(Jun 18 2018 at 01:06)</a>:</h4>
<p>also, <code>man search</code> doesn't work in <code>-c</code> mode apparently? it says <code>man: no manual page /home/rain/Sync/gsoc/build/debug/share/man/mann/search.nged</code></p>
<p>but that exact file is Right There <span class="emoji emoji-1f620" title="angry">:angry:</span></p>



<a name="128223286"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128223286" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128223286">(Jun 18 2018 at 01:11)</a>:</h4>
<p>uhhh. ok. so it works in the original script but as soon as i try to make the loop body into a function with <code>proc</code> it starts complaining when i call the function</p>



<a name="128223334"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128223334" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128223334">(Jun 18 2018 at 01:12)</a>:</h4>
<p>....huh. well it works now....</p>



<a name="128223335"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128223335" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128223335">(Jun 18 2018 at 01:12)</a>:</h4>
<p>idk what i did differently....</p>



<a name="128223336"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128223336" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128223336">(Jun 18 2018 at 01:12)</a>:</h4>
<p>well. nevermind i guess.</p>



<a name="128268945"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128268945" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128268945">(Jun 18 2018 at 20:40)</a>:</h4>
<p>uh turns out the full paths i was printing can't actually be used??? this is.... weird.</p>



<a name="128337961"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128337961" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128337961">(Jun 20 2018 at 00:57)</a>:</h4>
<p>ok, made another example work with -exec<br>
damn.<br>
global variables affecting seemingly basic commands..... yikes</p>



<a name="128338016"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128338016" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128338016">(Jun 20 2018 at 00:58)</a>:</h4>
<p>also now f_exec doesn't use full paths because it turns out that was just some debugging thing maybe? because the Tcl interpeter wanted nothing to do with them</p>



<a name="128338844"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128338844" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128338844">(Jun 20 2018 at 01:23)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> There are some commands that will use full paths - the example that comes to mind is arced, although I don't think I have a scripted example of using it handy</p>



<a name="128338850"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128338850" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128338850">(Jun 20 2018 at 01:23)</a>:</h4>
<p>"brlman arced" from the command or "man arced" from the MGED command line should give you the arced man page - I'd try a few experiments with it and then see if you can roll it into a search -exec example successfully</p>



<a name="128380110"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128380110" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128380110">(Jun 20 2018 at 19:57)</a>:</h4>
<p>that's quite confusing, i thought paths worked the same way they do in a shell</p>
<p>is there any reason for the differences?</p>



<a name="128380728"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128380728" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128380728">(Jun 20 2018 at 20:10)</a>:</h4>
<p>well, arced doesn't work with the short paths</p>
<p>but others don't work with the long ones</p>



<a name="128394017"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128394017" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128394017">(Jun 21 2018 at 01:36)</a>:</h4>
<p>hmm<br>
<code>r part1.r u rcc2.s – sph2.s</code> doesn't work in the classic ui</p>



<a name="128394331"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128394331" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128394331">(Jun 21 2018 at 01:47)</a>:</h4>
<p>That's OK (commands only working with obj or full path respectively) as long as the commands in question do work when given the correct inputs</p>



<a name="128394338"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128394338" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128394338">(Jun 21 2018 at 01:47)</a>:</h4>
<p>What's the error?</p>



<a name="128394756"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128394756" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128394756">(Jun 21 2018 at 02:00)</a>:</h4>
<p>i think it was "wrong number of arguments sph2.s"<br>
it went away when i quoted the "-"</p>



<a name="128394819"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128394819" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128394819">(Jun 21 2018 at 02:02)</a>:</h4>
<div class="codehilite"><pre><span></span>mged&gt; r foo.r u rcc2.s – sph2.s
 sph2.s
error in number of args!
mged&gt;
</pre></div>



<a name="128394827"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128394827" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128394827">(Jun 21 2018 at 02:02)</a>:</h4>
<p>oh. nvm the quoted one also errors</p>



<a name="128394880"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128394880" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128394880">(Jun 21 2018 at 02:04)</a>:</h4>
<div class="codehilite"><pre><span></span>mged&gt; r foo.r &quot;u&quot; rcc2.s &quot;–&quot; sph2.s
&quot; sph2.s
Defaulting item number to 1002
Creating region with attrs: region_id=1001, los=100, material_id=1
bad operation:  (0x0) skip member: sph2.s
</pre></div>



<a name="128397670"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128397670" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128397670">(Jun 21 2018 at 03:35)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> just throwing this out there: why not have a filter command? functional style? can Tcl do that?</p>



<a name="128397712"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128397712" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128397712">(Jun 21 2018 at 03:36)</a>:</h4>
<p>although... that would be language dependent... hm.</p>



<a name="128525019"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128525019" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128525019">(Jun 23 2018 at 16:08)</a>:</h4>
<p>I separated the -exec option into an <code>-execs</code> and and <code>-execf</code> one, the former uses the short name and the latter uses the full path.</p>



<a name="128525914"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128525914" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128525914">(Jun 23 2018 at 16:43)</a>:</h4>
<p>but full paths - as emitted by <code>db_path_to_string</code> - also don't work</p>



<a name="128558765"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128558765" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128558765">(Jun 24 2018 at 14:30)</a>:</h4>
<p>That might be the leading slash?</p>



<a name="128558812"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128558812" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128558812">(Jun 24 2018 at 14:32)</a>:</h4>
<p><span class="user-mention" data-user-id="102902">@Sean</span>   What do you think is the "right" thing to do here?  Teach commands that use a path to handle the search output paths, have exec "dumb down" the paths somehow for feeding to libged, ...?</p>



<a name="128558822"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128558822" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128558822">(Jun 24 2018 at 14:33)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> I'm not sure we're going to want to have two different exec options - that's OK for testing, but I think we'll want to resolve some sort of sane default behavior for all commands that doesn't require user awareness of that.</p>



<a name="128558862"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128558862" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128558862">(Jun 24 2018 at 14:34)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> what does "draw" do with full paths?  IIRC Bob updated that some years ago to be able to handle full paths, but there again that lead slash might be an issue...</p>



<a name="128558913"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128558913" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128558913">(Jun 24 2018 at 14:36)</a>:</h4>
<p>From a command standpoint, it might be as simple as ensuring sane failure behavior if the "wrong" form of the path (short vs. long) is supplied - then an exec with the wrong search path modifier will just not do anything, and the "fix" is to change the path modifier to produce the correct form for the exec in question.</p>



<a name="128558920"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128558920" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128558920">(Jun 24 2018 at 14:37)</a>:</h4>
<p>Of course, there's also the situation with multiple exec calls where some expect short paths and some are looking for long paths.</p>



<a name="128558961"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128558961" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128558961">(Jun 24 2018 at 14:38)</a>:</h4>
<p>Part of me almost wants to audit the commands and add (where appropriate) the ability to each command to handle full path inputs by "pre-processing" it down to the leaf object, if that's what the command is looking for.</p>



<a name="128559113"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128559113" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128559113">(Jun 24 2018 at 14:45)</a>:</h4>
<p>db_string_to_path -&gt; DB_FULL_PATH_CUR_DIR -&gt; dp-&gt;d_namep for each string supplied as a "geometry" object to commands that don't work with full paths, or something along those lines...</p>



<a name="128559161"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128559161" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128559161">(Jun 24 2018 at 14:47)</a>:</h4>
<p>I'm definitely much more inclined to fix the commands to do the "right" thing than I am to contort search-exec to try to "feed" them properly dumb-ed down  inputs</p>



<a name="128560718"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128560718" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128560718">(Jun 24 2018 at 15:42)</a>:</h4>
<p>free(0) is fine per the standard but is typically wrong or lazy memory management (often the prior), so bu will blather a warning expecting you to make sure the caller knows how much was allocated, how much will get freed, etc.</p>



<a name="128560751"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128560751" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128560751">(Jun 24 2018 at 15:44)</a>:</h4>
<p>For the r command, I believe your expression is wrong.  Don’t put the first op (u).</p>



<a name="128560770"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128560770" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128560770">(Jun 24 2018 at 15:44)</a>:</h4>
<p>c, r, comb, and g all take different types of expressions</p>



<a name="128568767"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128568767" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128568767">(Jun 24 2018 at 20:48)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> in that case I'll go through the commands and see which ones are doing weird things</p>



<a name="128586215"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128586215" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128586215">(Jun 25 2018 at 06:54)</a>:</h4>
<p>come to think of it.... the current behaviour might be ok, since the user could just concatenate the short path with some prefix</p>



<a name="128586971"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128586971" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128586971">(Jun 25 2018 at 07:19)</a>:</h4>
<p>i'm trying to figure out how but the Tcl concat command adds spaces between things</p>



<a name="128587021"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128587021" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128587021">(Jun 25 2018 at 07:20)</a>:</h4>
<p>i think this can only be done with a helper function?</p>



<a name="128588770"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128588770" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128588770">(Jun 25 2018 at 08:20)</a>:</h4>
<p>so this sort of works: <code>search Default -depth 1 -execs regsub bloop Default/bloop "{}" ";"</code></p>



<a name="128665871"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128665871" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128665871">(Jun 26 2018 at 16:35)</a>:</h4>
<p>what if instead of expecting a two part "path", arced just took two parameters?</p>



<a name="128680487"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128680487" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128680487">(Jun 26 2018 at 21:13)</a>:</h4>
<p>found another that takes paths: <code>listeval</code><br>
that one pretty much only makes sense with paths</p>



<a name="128683368"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128683368" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128683368">(Jun 26 2018 at 22:11)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> my sense is that we should come up with one or two path processing functions that will "digest" full path and object names and determine what was supplied, then have commands either reject the input (path command given non-path object, for example) or "do the right thing" (e.g. pull the leaf object from a full path and send that forward to the command.)</p>



<a name="128683385"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128683385" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128683385">(Jun 26 2018 at 22:11)</a>:</h4>
<p>Updating all the commands to be robust in that regard will be something of a slog, but we can at least establish the correct patterns.</p>



<a name="128683799"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128683799" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128683799">(Jun 26 2018 at 22:20)</a>:</h4>
<p>there needs to be a general object pathname processing, but that will require at least a case-by-case evaluation.  anything that takes an object name should take a pathname, and anything that takes a object name implicitly refers to a path.  fortunately, nearly all commands will easily update to supporting either.  the ones that don't will have to be considered separately (e.g., maybe we decide to eliminate or generalize the outliers).</p>



<a name="128683999"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128683999" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128683999">(Jun 26 2018 at 22:25)</a>:</h4>
<blockquote>
<p>come to think of it.... the current behaviour might be ok, since the user could just concatenate the short path with some prefix</p>
</blockquote>
<p>the 'join' command is the typical way to do this with tcl</p>



<a name="128938230"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128938230" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128938230">(Jul 02 2018 at 00:27)</a>:</h4>
<p>so, i have a function like <code>db_lookup</code> that uses paths, it's only missing the part where it checks if the path components are actually connected</p>



<a name="128938274"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128938274" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128938274">(Jul 02 2018 at 00:29)</a>:</h4>
<p>now, should it count any connection or should it be restricted somehow?</p>



<a name="128991108"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/128991108" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#128991108">(Jul 02 2018 at 22:24)</a>:</h4>
<p>...where in hecc is the function that lists connected nodes......</p>



<a name="129063261"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129063261" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129063261">(Jul 04 2018 at 04:33)</a>:</h4>
<blockquote>
<p>so, i have a function like <code>db_lookup</code> that uses paths, it's only missing the part where it checks if the path components are actually connected</p>
</blockquote>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> can you explain or show this please?  we don't want multiple lookup functions if we don't need to have them.  adding support for paths to db_lookup() would seem entirely reasonable if it doesn't support them already.  it would naturally need to fail lookup if the path was invalid.</p>



<a name="129063267"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129063267" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129063267">(Jul 04 2018 at 04:33)</a>:</h4>
<blockquote>
<p>now, should it count any connection or should it be restricted somehow?</p>
</blockquote>
<p>not sure what you mean here</p>



<a name="129064247"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129064247" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129064247">(Jul 04 2018 at 05:06)</a>:</h4>
<blockquote>
<p>global variables affecting seemingly basic commands..... yikes</p>
</blockquote>
<p>Eliminate them! ;)</p>



<a name="129064410"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129064410" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129064410">(Jul 04 2018 at 05:12)</a>:</h4>
<blockquote>
<p>I separated the -exec option into an <code>-execs</code> and and <code>-execf</code> one, the former uses the short name and the latter uses the full path.</p>
</blockquote>
<p>I don't think this is the right thing to do here.  whether short or full paths should replace {} is already implied via search . vs search / ... there should just be one -exec option regardless.</p>



<a name="129064421"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129064421" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129064421">(Jul 04 2018 at 05:13)</a>:</h4>
<blockquote>
<p>but full paths - as emitted by <code>db_path_to_string</code> - also don't work</p>
</blockquote>
<p>what did you mean by this?  invalid paths?  problems with commands that don't take paths?</p>



<a name="129104472"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129104472" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129104472">(Jul 04 2018 at 20:57)</a>:</h4>
<p>problems with commands that don't take paths and i think the ones that do take paths don't take absolute ones</p>



<a name="129104629"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129104629" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129104629">(Jul 04 2018 at 21:01)</a>:</h4>
<p>the function is the following:</p>
<div class="codehilite"><pre><span></span>struct directory *
db_lookup_path(const struct db_i *dbip, const char *_path, int noisy)
{
    struct directory *dir = RT_DIR_NULL;
    size_t i=0;
    size_t j=0;
    char tmp;
    char *path = bu_strdup(_path);

    /* skip leading slashes */
    while (path[i] == &#39;/&#39; &amp;&amp; path[i] != &#39;\0&#39;)
        i++;
    j=i;
    while (path[j] != &#39;/&#39; &amp;&amp; path[j] != &#39;\0&#39;)
        j++;
    tmp = path[j];
    path[j] = &#39;\0&#39;;
    /* start from the &quot;root&quot; */
    dir = db_lookup(dbip, path + i, noisy);
    if (dir == RT_DIR_NULL)
        goto exit;
    for(;;) {/* FIXME: figure out a better loop condition than `true`?? */
        path[j] = tmp;
        if (path[j] == &#39;\0&#39;) /* reached the last segment */
            goto exit;
        i = j + 1;
        while (path[i] == &#39;/&#39; &amp;&amp; path[i] != &#39;\0&#39;)
            i++;
        j = i;
        while (path[j] != &#39;/&#39; &amp;&amp; path[j] != &#39;\0&#39;)
            j++;
        tmp = path[j];
        path[j] = &#39;\0&#39;;
        if (1) {
            /* path segment connects to dir */
            dir = db_lookup(dbip, path + i, noisy);
        } else {
            bu_log(&quot;malformed path&quot;); /* FIXME: write more descriptive message once the connection check is implemented */
            return RT_DIR_NULL;
        }
    }
    exit:
    bu_free(path, &quot;mutable path&quot;);
    return dir;
}
</pre></div>



<a name="129104711"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129104711" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129104711">(Jul 04 2018 at 21:03)</a>:</h4>
<p>it builds on <code>db_lookup</code> and could replace it if necessary</p>



<a name="129104813"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129104813" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129104813">(Jul 04 2018 at 21:05)</a>:</h4>
<p>the connection thing: should it eg. only go down unions but not intersections?<br>
i think it should consider any connection a valid one and it any filtering is necessary, that could be added later</p>



<a name="129104945"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129104945" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129104945">(Jul 04 2018 at 21:09)</a>:</h4>
<p>there were some unexpected pet related troubles at home so i didn't have a lot of time to code :/<br>
tomorrow we're going on that vacation so i should have ample time to code and read more of the source in the car</p>



<a name="129286769"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129286769" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129286769">(Jul 08 2018 at 06:20)</a>:</h4>
<blockquote>
<p>it builds on <code>db_lookup</code> and could replace it if necessary</p>
</blockquote>
<p>this likely makes more sense.  existing db_lookup could be made a HIDDEN/static function renamed to just lookup_object() or something similarly simple, and your new one taking over as db_lookup() assuming the signature matches.  it would need to match.</p>



<a name="129286822"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129286822" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129286822">(Jul 08 2018 at 06:23)</a>:</h4>
<blockquote>
<p>the connection thing: should it eg. only go down unions but not intersections?<br>
i think it should consider any connection a valid one and it any filtering is necessary, that could be added later</p>
</blockquote>
<p>Ah, no, I don't think it should be arbitrarily limited by the operation.  Stopping doesn't make sense for intersections in particular.  The only real difficulty is that there can be multiple objects at a given point in the path (e.g., /path/to/foo/bar might have 'bar' in 'foo' N times, with different matrices on each one).  That is only really solved by switching from paths to URI's, and I think that's outside scope for this project.</p>



<a name="129382721"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129382721" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129382721">(Jul 10 2018 at 00:37)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span>  Peter, can you do another version of your patch that doesn't have extra whitespace in it?  I don't remember if we say it explicitly in HACKING, but generally we try to avoid trailing whitespace on lines.</p>



<a name="129411230"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129411230" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129411230">(Jul 10 2018 at 13:27)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> sure, i'll send a fixed one after i'm finished with this function</p>



<a name="129461921"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129461921" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129461921">(Jul 11 2018 at 10:13)</a>:</h4>
<p>well.. i have something that should check connections, but it seems like it just considers everything connected...? that took a lot longer than i hoped for and it still doesn't work. frick.</p>



<a name="129477965"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129477965" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129477965">(Jul 11 2018 at 15:23)</a>:</h4>
<p>Can you show your code?  Maybe another pair of eyes</p>



<a name="129505762"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129505762" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129505762">(Jul 11 2018 at 23:32)</a>:</h4>
<div class="codehilite"><pre><span></span>HIDDEN int
connected_directories(const struct db_i *dbip, const struct directory *dpa, const struct directory *dpb)
{
    int ret = 0xdead;
    struct directory *dpachild;
    size_t i;
    struct rt_db_internal interna, internb;
    struct rt_comb_internal *comba;
    size_t true_count, trueish_count;
    struct rt_tree_array *rt_tree_array = NULL;

    if (RT_DIR_NULL == dpa || RT_DIR_NULL == dpb) {
        /* FIXME: panic maybe instead??????? */
        ret = 0;
    } else if (!(dpa-&gt;d_flags &amp; RT_DIR_COMB)) {
        ret = 0; /* not a combination, so paths can&#39;t start from it */
    } else {
        if (!(dpa-&gt;d_flags &amp; RT_DIR_COMB)) {
            ret = 0;
        } else if (rt_db_get_internal(&amp;interna, dpa, dbip, (fastf_t *)NULL, &amp;rt_uniresource) &lt; 0 || rt_db_get_internal(&amp;internb, dpb, dbip, (fastf_t *)NULL, &amp;rt_uniresource) &lt; 0) {
            bu_log(&quot;Database read error, aborting&quot;);
            ret = 0;
        } else {
            comba = (struct rt_comb_internal *)interna.idb_ptr;
            if (comba-&gt;tree) {
                if (db_ck_v4gift_tree(comba-&gt;tree) &lt; 0) {
                    db_non_union_push(comba-&gt;tree, &amp;rt_uniresource);
                    if (db_ck_v4gift_tree(comba-&gt;tree) &lt; 0) {
                        bu_log(&quot;Cannot flatten tree for listing&quot;);
                        ret = 0;
                        goto exit;
                    }
                }
                trueish_count = db_tree_nleaves(comba-&gt;tree);
                if (trueish_count &gt; 0) {
                    rt_tree_array = (struct rt_tree_array *)bu_calloc(trueish_count,sizeof(struct rt_tree_array), &quot;tree list&quot;);
                    true_count = (struct rt_tree_array *)db_flatten_tree(
                        rt_tree_array, comba-&gt;tree, OP_UNION,
                        1, &amp;rt_uniresource) - rt_tree_array;
                    BU_ASSERT(true_count == trueish_count);
                    comba-&gt;tree = TREE_NULL;
                } else {
                    true_count = 0;
                    rt_tree_array = NULL;
                }

                for (i = 0; i &lt; true_count &amp;&amp; !ret; i++) {
                    dpachild = db_lookup(dbip, rt_tree_array[i].tl_tree-&gt;tr_l.tl_name, LOOKUP_QUIET);
                    if (RT_DIR_NULL != dpachild &amp;&amp; 0 == bu_strcmp(dpachild-&gt;d_namep, dpb-&gt;d_namep)) {
                        ret = 1;
                    }
                    db_free_tree(rt_tree_array[i].tl_tree, &amp;rt_uniresource);
                }

                while (i &lt; true_count) {
                    db_free_tree(rt_tree_array[i].tl_tree, &amp;rt_uniresource);
                    i++;
                }

                if (rt_tree_array)
                    bu_free((char *)rt_tree_array, &quot;printnode: rt_tree_array&quot;);

            } else {
                ret = 0;
            }
        }
    }
    exit:
    rt_db_free_internal(&amp;interna);
    rt_db_free_internal(&amp;internb);
    BU_ASSERT(ret != 0xdead);
    return ret;
}


HIDDEN int
connected_path(const struct db_i *dbip, const struct db_full_path *fp)
{
    size_t i;
    const struct directory *dpa, *dpb;
    switch (fp-&gt;fp_len) {
        case 0:
        case 1: return 1;
        default:
            dpb = fp-&gt;fp_names[0];
            if (RT_DIR_NULL == dpb) return 0;
            for (i=1; i&lt;fp-&gt;fp_len-1;i++) {
                dpa = dpb;
                dpb = fp-&gt;fp_names[i+1];
                if (! connected_directories(dbip, dpa, dpb))
                    return 0;
            }
    }
    return 1;
}
</pre></div>


<p>i couldn't find a way to check the connections starting from a <code>struct directory</code> so i hoped that the <code>tree</code> command's implementation will have something, that right there is a shameless plagiary of <code>_ged_print_node</code></p>



<a name="129555324"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129555324" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129555324">(Jul 12 2018 at 18:52)</a>:</h4>
<p>maybe the problem is that i'm testing it with the wrong file? I've been doing all my tests with the supplied NIST_MBE_PMI_7-10.g since it's pretty big so i thought it should be complex enough. maybe the output of <code>tree</code> just doesn't reflect the connections the way they really are?</p>



<a name="129555896"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129555896" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129555896">(Jul 12 2018 at 19:01)</a>:</h4>
<p>the tests that i expected to fail were things like<br>
<code>ls Default/Default</code> or  <code>ls Solid</code>.... oh..... OH!!!!!!!!!!!!!!!!</p>



<a name="129555907"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129555907" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129555907">(Jul 12 2018 at 19:01)</a>:</h4>
<p>.....wait</p>



<a name="129556340"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129556340" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129556340">(Jul 12 2018 at 19:08)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> that's a big file, but it's not a very complex database .. it's just got some big nurbs objects in it.  the havoc or m35 models are considerably more complex</p>



<a name="129556363"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129556363" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129556363">(Jul 12 2018 at 19:09)</a>:</h4>
<p>Default/Default?? ... that doesn't look right :)</p>



<a name="129562690"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129562690" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129562690">(Jul 12 2018 at 21:05)</a>:</h4>
<p>i know! and it works! and it shouldn't!</p>



<a name="129562739"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129562739" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129562739">(Jul 12 2018 at 21:06)</a>:</h4>
<p>and ya, i later realized it's pretty simple but i couldn't remember which one the big complex tank was. &gt;_&gt;</p>



<a name="129562758"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129562758" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129562758">(Jul 12 2018 at 21:06)</a>:</h4>
<p>and the NIST one was fine for just testing if <code>search</code> worked at all</p>



<a name="129562851"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129562851" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129562851">(Jul 12 2018 at 21:08)</a>:</h4>
<p>we don't have a big complex tank in our samples</p>



<a name="129562883"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129562883" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129562883">(Jul 12 2018 at 21:09)</a>:</h4>
<p>the "goliath.g" model kind of looks like a tank but is actually a tracked mine ... like a land mine that explodes, but it has tracks on it so it can be driven around</p>



<a name="129563196"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129563196" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129563196">(Jul 12 2018 at 21:15)</a>:</h4>
<p>it must have been that then. but anyways, Default/Default shouldn't work and it's not just some quirk of the database in question.</p>



<a name="129563752"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129563752" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129563752">(Jul 12 2018 at 21:25)</a>:</h4>
<p>maybe ls doesn't use db_lookup....? uhh.</p>
<p>i guess i can't avoid it. i'll have to step through this with gdb.</p>



<a name="129609838"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129609838" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129609838">(Jul 13 2018 at 16:04)</a>:</h4>
<blockquote>
<p>maybe ls doesn't use db_lookup....? uhh.</p>
<p>i guess i can't avoid it. i'll have to step through this with gdb.</p>
</blockquote>
<p>it does use db_lookup (see src/libged/list.c) but is also path-aware if there's a slash -- there may be some case where object/object resolves wierd</p>



<a name="129676428"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129676428" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129676428">(Jul 14 2018 at 21:16)</a>:</h4>
<p>oh.... i think i have it working....</p>



<a name="129676431"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129676431" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129676431">(Jul 14 2018 at 21:16)</a>:</h4>
<p>well, <code>cat Default/Default</code> no longer works</p>



<a name="129676434"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129676434" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129676434">(Jul 14 2018 at 21:16)</a>:</h4>
<p>(cat turned out simpler than ls so i'm testing it with that)</p>



<a name="129676440"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129676440" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129676440">(Jul 14 2018 at 21:17)</a>:</h4>
<p>it was an off-by-one error, naturally</p>



<a name="129676475"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129676475" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129676475">(Jul 14 2018 at 21:18)</a>:</h4>
<p><code>cat Default/Solid1.s</code> also doesn't work</p>



<a name="129676485"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129676485" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129676485">(Jul 14 2018 at 21:18)</a>:</h4>
<p>but it doesn't display an error either... it probably should</p>



<a name="129676487"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129676487" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129676487">(Jul 14 2018 at 21:18)</a>:</h4>
<p><code>cat Default/Solid1</code> does work</p>



<a name="129676842"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129676842" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129676842">(Jul 14 2018 at 21:32)</a>:</h4>
<p>also, absolute path syntax works now, so <code>search</code> should work too</p>



<a name="129745489"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129745489" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129745489">(Jul 16 2018 at 12:02)</a>:</h4>
<p>this indentation style is not a good fit for acme :(</p>
<p>i think i'll write some scripts to convert between the two, so I can work purely with tabs but then I can convert things back. i've tried the official formatter script but it works on files and I want to work with selections as well and that's easier done with a few <code>sed</code> invocations</p>



<a name="129746003"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129746003" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cezar <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129746003">(Jul 16 2018 at 12:14)</a>:</h4>
<p>i think there already is something like that. check out <code>sh/ws.sh</code></p>



<a name="129746544"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129746544" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129746544">(Jul 16 2018 at 12:27)</a>:</h4>
<p>it looks like it works on files and not stdin... ah well, let's try this</p>



<a name="129750793"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129750793" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129750793">(Jul 16 2018 at 13:51)</a>:</h4>
<p>found something simpler:</p>
<div class="codehilite"><pre><span></span># convert from the weird indentation to something simpler
|sed &#39;s/    /        /g
s/    / /g&#39;

# revert the previous conversion
|sed &#39;s/        /        /g
s/  /    /g
s/        / /g&#39;
</pre></div>



<a name="129750810"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129750810" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129750810">(Jul 16 2018 at 13:51)</a>:</h4>
<p>it seems to work and i didn't have to learn perl to know what it's doing :3</p>



<a name="129750962"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129750962" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129750962">(Jul 16 2018 at 13:55)</a>:</h4>
<p>this is also nicer because it's easy to apply to selections in Acme so it's easier to track what I'm changing</p>



<a name="129751837"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129751837" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129751837">(Jul 16 2018 at 14:11)</a>:</h4>
<blockquote>
<p>(cat turned out simpler than ls so i'm testing it with that)</p>
</blockquote>
<p>yes, 'cat' is basically a nearly direct call to the ft_describe() callback</p>



<a name="129751860"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129751860" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129751860">(Jul 16 2018 at 14:11)</a>:</h4>
<p>it also calls db_lookup() itself, but without modifying the arguments</p>



<a name="129752679"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129752679" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129752679">(Jul 16 2018 at 14:24)</a>:</h4>
<p>we have plans to convert the entire codebase indentation over.  that was waiting on repo migration, but it might make more sense to do it first now that migration is stalled...</p>



<a name="129786927"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129786927" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129786927">(Jul 17 2018 at 01:22)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span>  So on the patches, please separate them out by topic (you've got the older patch with color, edcolor, prcolor changes which I don't (think?) are related to search -exec)</p>



<a name="129787011"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129787011" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129787011">(Jul 17 2018 at 01:24)</a>:</h4>
<p>I'm thinking there are three here - the color stuff, the initial search -exec patch, and the follow-up that does the db_lookup changes</p>



<a name="129787051"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129787051" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129787051">(Jul 17 2018 at 01:25)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> what's the "something weird" when you include the type from librt in ged/defines.h?</p>



<a name="129805716"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129805716" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129805716">(Jul 17 2018 at 10:32)</a>:</h4>
<p>I think I have separated the prcolor stuff out?? The something weird was some compilation error, but I can't remember what exactly.</p>



<a name="129805736"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129805736" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129805736">(Jul 17 2018 at 10:33)</a>:</h4>
<p>But yea, there are changes in my branch that aren't directly related and that's probably not good because it's hard to clean up the diff from the master branch.</p>



<a name="129816934"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129816934" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129816934">(Jul 17 2018 at 14:50)</a>:</h4>
<p>problem is idk how to cleanly separate those changes and some of them are nice to have..... maybe i could make each change a new feature branch and make one private branch that has all those changes????? idk</p>



<a name="129829240"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129829240" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129829240">(Jul 17 2018 at 19:05)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> </p>
<div class="codehilite"><pre><span></span>In file included from /home/rain/Sync/gsoc/brlcad-code/include/ged/defines.h:37,
                 from /home/rain/Sync/gsoc/brlcad-code/include/analyze.h:34,
                 from /home/rain/Sync/gsoc/brlcad-code/src/libanalyze/api.c:28:
/home/rain/Sync/gsoc/brlcad-code/include/rt/search.h:141:39: error: ‘struct db_i’ declared inside parameter list will not be visible outside of this definition or declaration [-Werror]
                                struct db_i *dbip,
                                       ^~~~
/home/rain/Sync/gsoc/brlcad-code/include/rt/search.h:140:39: error: ‘struct directory’ declared inside parameter list will not be visible outside of this definition or declaration [-Werror]
                                struct directory **path_v,
                                       ^~~~~~~~~
/home/rain/Sync/gsoc/brlcad-code/include/rt/search.h:178:38: error: ‘struct directory’ declared inside parameter list will not be visible outside of this definition or declaration [-Werror]
                               struct directory ***dpv);
                                      ^~~~~~~~~
/home/rain/Sync/gsoc/brlcad-code/include/rt/search.h:175:44: error: ‘struct db_i’ declared inside parameter list will not be visible outside of this definition or declaration [-Werror]
 RT_EXPORT extern size_t db_ls(const struct db_i *dbip,
                                            ^~~~
/home/rain/Sync/gsoc/brlcad-code/include/rt/search.h:203:91: error: ‘struct db_i’ declared inside parameter list will not be visible outside of this definition or declaration [-Werror]
 DEPRECATED RT_EXPORT extern int db_full_path_list_add(const char *path, int local, struct db_i *dbip, struct db_full_path_list *path_list);
                                                                                           ^~~~
/home/rain/Sync/gsoc/brlcad-code/include/rt/search.h:205:74: error: ‘struct db_i’ declared inside parameter list will not be visible outside of this definition or declaration [-Werror]
 DEPRECATED RT_EXPORT extern void *db_search_formplan(char **argv, struct db_i *UNUSED(dbip), struct db_search_context *);
                                                                          ^~~~
/home/rain/Sync/gsoc/brlcad-code/include/rt/search.h:209:20: error: ‘struct db_i’ declared inside parameter list will not be visible outside of this definition or declaration [-Werror]
             struct db_i *dbip);
                    ^~~~
/home/rain/Sync/gsoc/brlcad-code/include/rt/search.h:212:21: error: ‘struct db_i’ declared inside parameter list will not be visible outside of this definition or declaration [-Werror]
              struct db_i *dbip);
                     ^~~~
/home/rain/Sync/gsoc/brlcad-code/include/rt/search.h:215:49: error: ‘struct db_i’ declared inside parameter list will not be visible outside of this definition or declaration [-Werror]
                                          struct db_i *dbip,
                                                 ^~~~
cc1: all warnings being treated as errors
make[3]: *** [src/libanalyze/CMakeFiles/libanalyze-obj.dir/build.make:63: src/libanalyze/CMakeFiles/libanalyze-obj.dir/api.c.o] Error 1
make: exit 2
make[2]: *** [CMakeFiles/Makefile2:18004: src/libanalyze/CMakeFiles/libanalyze-obj.dir/all] Error 2
make[1]: *** [CMakeFiles/Makefile2:18278: src/libged/CMakeFiles/libged.dir/rule] Error 2
make: *** [Makefile:4422: libged] Error 2
</pre></div>



<a name="129829245"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129829245" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129829245">(Jul 17 2018 at 19:05)</a>:</h4>
<p>this is what happens if i include <code>rt/search.h</code></p>



<a name="129829304"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129829304" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129829304">(Jul 17 2018 at 19:06)</a>:</h4>
<div class="codehilite"><pre><span></span>#include &quot;common.h&quot;
#include &quot;bio.h&quot;
#include &quot;bu/hash.h&quot;
#include &quot;bu/list.h&quot;
#include &quot;bu/vls.h&quot;
#include &quot;dm/bview.h&quot;
#include &quot;rt/search.h&quot;
</pre></div>


<p>this is the include order</p>



<a name="129865419"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129865419" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129865419">(Jul 18 2018 at 11:15)</a>:</h4>
<p>OK, so there are two ways to handle that.  For simplicity, I would suggest also including the header that defines db_i (rt/ db_instance.h) in your C file along with rt/search.h</p>



<a name="129879519"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129879519" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129879519">(Jul 18 2018 at 15:49)</a>:</h4>
<p>i included it in rt/search.h itself, since that's the one that seems to depend on it</p>



<a name="129907016"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129907016" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129907016">(Jul 19 2018 at 02:02)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span>  That was my initial thought, and if that works without causing additional problems it's the right thing to do.  There are sufficient interdependence between the rt datatypes I wasn't sure if that would "just work", but if it does awesome.</p>



<a name="129953711"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129953711" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129953711">(Jul 19 2018 at 20:13)</a>:</h4>
<p>well... i rebased my branch (well, a copy of it)</p>



<a name="129953733"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129953733" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129953733">(Jul 19 2018 at 20:13)</a>:</h4>
<p>i squashed a lot of thing into one and left out some commits and git diff tells me it's the same as the other branch</p>



<a name="129953782"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129953782" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129953782">(Jul 19 2018 at 20:14)</a>:</h4>
<p>so, gonna send the new and improved patches</p>



<a name="129953788"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129953788" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129953788">(Jul 19 2018 at 20:14)</a>:</h4>
<p>(editing the patches by hand was just. so. slow.)</p>



<a name="129953807"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129953807" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129953807">(Jul 19 2018 at 20:15)</a>:</h4>
<p>(so i really hope this works)</p>



<a name="129961818"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129961818" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129961818">(Jul 19 2018 at 22:35)</a>:</h4>
<p>uh.... what. i can't see the squashed commits... it's the same commits as on the original branch.... what....</p>



<a name="129961880"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129961880" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129961880">(Jul 19 2018 at 22:36)</a>:</h4>
<p>and it has all the unrelated commits too</p>



<a name="129961901"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129961901" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129961901">(Jul 19 2018 at 22:37)</a>:</h4>
<p>but.... i thought the rebase ran successfully??</p>



<a name="129961912"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129961912" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129961912">(Jul 19 2018 at 22:37)</a>:</h4>
<p>well. this is irritating.</p>



<a name="129961941"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129961941" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129961941">(Jul 19 2018 at 22:37)</a>:</h4>
<p>hm.<br>
...<br>
is the big patch really that bad? ehehehehehe.....</p>



<a name="129962006"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129962006" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129962006">(Jul 19 2018 at 22:38)</a>:</h4>
<p>i can remove the unrelated fixes from it but i don't think i can separate it properly</p>



<a name="129962024"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/129962024" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#129962024">(Jul 19 2018 at 22:39)</a>:</h4>
<p>hmmm</p>



<a name="130065861"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130065861" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130065861">(Jul 21 2018 at 18:52)</a>:</h4>
<p>so, i did some git magic and came up with this:</p>
<div class="codehilite"><pre><span></span>+ b9bae437bb4cdf5fb4cf054ae761a2139f5477c8 added exec userdata pointer to struct db_plan_t
+ 01a04b0a52c9ac93f275a01961c41bdb13dd8a6c remove shorthand definitions from librt search
+ 499291ac5965258379e0cd3988d23f4fa73dcb60 basics of -exec flag for librt search
+ f277ef7afc64bdc28c24c35c01d4356854d18363 clean up memory on -exec parse error in librt
+ 9ff5cc25a6f618c957695553c79d20aa7593a9b5 librt: store result of possibly failed plan creation
+ e99b62b433c127d024ef5cddcdebb593a0aa6c89 print newline after bu_log in librt&#39;s c_exec
+ 7906e5864600773889ff771c63ca47dba2d92f8b oops. BRLCAD_OK is not 0, fixes previous commit
+ 14c64d7005b8e9fc9e3fd2669e618d54b5dd9632 remove debug logging from librt c_exec
+ 907bb124c83c9c081f42649efb6e778cc3c4f3a7 add db_search -exec related definitions
+ 40d385ad9ef257cbd5996e8719b58760d3afe492 follow naming convention in search.h
+ abfe9d6694080a2fa8a96a70bd07f21760d15889 librt/search.h: use a single argc instead of storing every argv strings&#39;s length
+ 767cd544c3d8547f4813ade9438f861cb6ae2078 small consistency fixes in c_exec
+ e5a969cdd67fd1047c6be8391b3b290ae2067e69 removed e_orig from c_exec and added a list of holes instead
+ 8856329eced85fc8b05c599da8b90fc6b6c7b980 first f_exec implementation + cleaned up c_exec a bit more
+ 2f906da457d984a567ad1e3fffdbe350bcbeb7f2 db_search -exec evaluator implemented
+ 188dd2e65fd71a97a1b154ab3129f58914b8f06d db_search: special case freeing db_plan_t if it&#39;s an -exec plan
+ 5ab4a23b53c2fba63102c67472adefa70c834af1 remove unnecessary _e_orig field from db_plan_t
+ ca05439929846dd40df2dcd739146b2d9a83b7a1 fixed some typos in db_search_free_plan
+ 9aeda60e227fc3ff1546d9e23582861058fbe7b4 make the db_search callback a const
+ e9889a108a34b472d3b7927021dacd3d525f1fdd hooked up the search related parameters in librts/search.{c,h}
+ 5af4f8ddc17da6d9ca5b6f2148a6dd397b537b31 ironed out some conflicting definitions in librt search
+ 0a7c1f6c18b7dfe57f7eeeefc4bf29be5c6bb8c0 added exec context definitions to rt/search.h
+ c19eb86b830656051d59438d811c9db56def48e9 actually, we already have NULL. removing null search context
+ 609ee66dbe3323b2e590de74b97b4fddb3d85907 use search context pointer everywhere instead of explicit params
+ 33e86bca1442ed789889333d4b942ef8bcd88a94 added NULL contexts for calls to db_search calls in libged/comb.c
+ 3c054b158de853919076abff96a83e3bb531e85c more NULL contexts for db_search calls in libged
+ 5bbc048808224fe9a4a16de3e29aaff7c3c18392 libged builds and should now support db_search contexts
+ ffe0b47290b62c89853db71313ece79d6e8adc47 added callback to MGED that evaluates Tcl with search -exec
+ fedec08c6265a0813e6e4e93224a76dce4330177 set up the callback
+ 04f8450e1848317ed9b6be753f3f97cb1934fa7d fixed existing calls to db_search
+ bba04a19849ad7c0d3a674c7a5a6a858755e0a57 improved docs for `search -exec`
+ 722b636913a42ed1d588974e8061f41e4a9f89e7 fixed doxygen
+ 66f4ce1b3bd449335f8b6159ca88da97a916e9c6 free search context after use
+ d30fdd961456142e952aa233494c516f8ca4b2be properly convert Tcl result to a boolean in MGED search callback
+ 718337152bcd6bdc8eb1b67efb2c8d341d804856 cleaned up some whitespace, probably
+ f79a9cc60d79993bf92e3a29099a3b6ff3063dc1 added db_search_context_destroy
+ 66bc37db6e1f350a5a4e2a9659a4af2d51e79d3b empty exec is a no-op that returns true
+ 0605f14e89c6b37f98822958781c63111a1a76c5 use bu_free in librt/search.c
+ 4b4e2fa52fba353d0350b647425537c260d867f4 make sure to use bu_free everywhere
+ fa2785ac87bc532a4f1da0f2f1c8bf0481dab21c fixed a bu_free call
+ 3081323a0ecf4aee443dd45c49ac07b33505e692 make the bu_free call&#39;s comment match the bu_realloc call (i thought i already committed this???)
+ 3859676ece1231779df7ac6bb59fe312ead44779 made some Tcl search examples work with -exec
+ 572f3591bd9c0f5d9f2d7ce853ade247e232a600 added a super simple and WRONG! path resolver
+ a597022aa8313cbb4c1c863c1dedd8141e4359da db_lookup works on paths too and there are name and path variants also
+ 7b0dd3cc057bff4029c850a256864396a879dedc fixed small grammatical error
+ e7233d774cdef630dd615f4d2c2b09cb66ecffaf removed lying comment
+ 442c3d883531868aa2f2ff5bd3e04e1043b0b453 i really miss rust&#39;s type system.
+ 7a6b2221d34457a190d4909b3af044653b7c6acc fixed bugs in the new db_lookup_path functionality
+ c33949237eaedf0a0125b539b7e88160ebf35394 removed trailing whitespace from db_lookup
+ 947fcb6d2328488a0d0752b1672604bf8bc787cc better and more error messages in db_lookup_path
+ 0fa85d60c05c4bef0d22f98a0bb3ab4f7b4d57ac free up the fullpath in db_lookup_path
+ 59c6b7aaa999d37894ff47e3ecd23fa01f96035e removed trailing ws from src/librt/search.c
+ caf96e4fa3bfd89629f55dc2ee1368b3a0e5c37a adhere to whitespace standards in src/librt/search.c
+ 90897eaf938b59fc55841012f954a502ffa81ac5 trim trailing ws from include/rt/search.h
+ 7719410a045e0b93b65ffa900823d9aea5dce67c trim trailing ws from src/libged/shape_recognition.cpp
+ 92ee7dcc7402276e36a7abad1be74fb9cd59ccab trim trailing ws from src/mged/cmd.c
+ 83865fc8df2f41dbe25dd659ca006c80e9964391 trim trailing ws from src/libged/search.c
+ 026346c7c31a5283a91a3c88ec056b9c6e8580d0 add missing db_instance dependency to include/rt/search.h
+ 20566236f31470e48e873cfd2e46306aac829898 removed leftover comment
</pre></div>



<a name="130065865"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130065865" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130065865">(Jul 21 2018 at 18:53)</a>:</h4>
<p>these are all the commits that are actually related to the task</p>



<a name="130065871"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130065871" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130065871">(Jul 21 2018 at 18:53)</a>:</h4>
<p>my branch had some miscellaneous bugfixes and this filtered them out</p>



<a name="130065921"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130065921" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130065921">(Jul 21 2018 at 18:55)</a>:</h4>
<p>now, some of the commit names are wrong because i accidentally added some files or something and noticed it too late and i'd have to do another rebase to fix that</p>



<a name="130065923"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130065923" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130065923">(Jul 21 2018 at 18:55)</a>:</h4>
<p>but since only i use the repo, i'll probably do it</p>



<a name="130065973"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130065973" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130065973">(Jul 21 2018 at 18:57)</a>:</h4>
<p>i think i can actually skip squashing and other rebase related uglinesses and just git diff to compare commits, that way i can generate some more meaningful diffs that i can submit</p>



<a name="130071468"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130071468" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130071468">(Jul 21 2018 at 21:47)</a>:</h4>
<p>Whatever you think best - the key point is to get a set of patches in shape for committing</p>



<a name="130083132"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130083132" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130083132">(Jul 22 2018 at 05:08)</a>:</h4>
<blockquote>
<p>i included it in rt/search.h itself, since that's the one that seems to depend on it</p>
</blockquote>
<p>that is the right solution -- headers should be self-contained and make sure all the types they use are properly declared by including the headers that declare them.  the only time there should ever be a problem is in the case of a bonefide cyclic dependency, which should not exist.  we do not have any cycles in the current headers that I know if, so the only reason it should ever not work would likely be to a recent screw-up by someone.</p>



<a name="130083272"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130083272" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130083272">(Jul 22 2018 at 05:13)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> note that this way of working over a git bridge is very sub-optimal and is now putting your entire project at risk because it's not committed to the main repository.  please prioritize getting your patches separated and submitted cleanly.  we'd rather you commit directly to the repository, not be working off on your own like this indefinitely.  commit access requires at least a couple patches with no errors, conforms with style, makes some improvement (however minor), and that is mostly to demonstrate your competency in communicating change via patches that do not come with a burden.</p>



<a name="130083420"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130083420" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130083420">(Jul 22 2018 at 05:18)</a>:</h4>
<p>you've clearly been <em>very</em> productive, but you got to work with <span class="user-mention" data-user-id="112516">@starseeker</span> to get changes committed to the main svn repo.  as I said on the prcolor patch months ago:  "You're welcome to set up whatever you like, but submitting a 'complete' (tested and working) patch file is a fundamental developer skill that is independent of any revision control system or workflow. I think there is simply a mismatch in what you're trying to do and what is useful to share."</p>



<a name="130083468"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130083468" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130083468">(Jul 22 2018 at 05:20)</a>:</h4>
<blockquote>
<p>well, <code>cat Default/Default</code> no longer works</p>
</blockquote>
<p>This is an example of something that would make for a perfect simple succinct patch that you should submit.  Just the change that fixed it.</p>



<a name="130185868"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130185868" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130185868">(Jul 24 2018 at 02:31)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> any luck?</p>



<a name="130203821"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130203821" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130203821">(Jul 24 2018 at 10:48)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> not really, i'm still trying to figure out how to group commits into patches :/</p>



<a name="130210060"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130210060" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130210060">(Jul 24 2018 at 13:15)</a>:</h4>
<blockquote>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> not really, i'm still trying to figure out how to group commits into patches :/</p>
</blockquote>
<p>still??  you can always pull a single commit and submit that or cherry pick a set of commits to a branch and then diff that ... or check out an svn repo and apply your commits one at a time (git diff SHA &gt; git.diff1 ; git diff SHA &gt; git.diff2 ; patch -p1 &lt; git.diff1 ; patch -p1 &lt; git.diff2 ; svn diff &gt; mychanges.diff) .... or even just retype a succinct change on a fresh checkout.</p>



<a name="130210147"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130210147" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130210147">(Jul 24 2018 at 13:16)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> at a minimum, you need to be talking through what you're doing and trying here so everyone knows what's going on ...</p>



<a name="130210168"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130210168" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130210168">(Jul 24 2018 at 13:16)</a>:</h4>
<p>dead silence, struggling through it on your own without talking  is the worst thing you can do</p>



<a name="130244216"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130244216" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130244216">(Jul 24 2018 at 23:17)</a>:</h4>
<p>i've been looking for ways to group them more or less logically but i think i should just stop overthinking it and go with whatever comes to mind first</p>



<a name="130244260"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130244260" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130244260">(Jul 24 2018 at 23:18)</a>:</h4>
<p>rebasing seemed like a good way to make the commits more coherent but i ran into some errors and i have no idea how to deal with them</p>



<a name="130244270"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130244270" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130244270">(Jul 24 2018 at 23:19)</a>:</h4>
<p>i've been trying to automate this more or less or at least come up with ways to make it faster, but it looks like i'll just have to do everything manually</p>



<a name="130244326"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130244326" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130244326">(Jul 24 2018 at 23:20)</a>:</h4>
<p>i made a copy of the master branch (which is the same as the svn repo) and i'm making patches</p>



<a name="130244339"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130244339" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130244339">(Jul 24 2018 at 23:20)</a>:</h4>
<p>also, god bless CoW file systems, i didn't have to sacrifice a bunch of extra space for cloning the repo</p>



<a name="130244924"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130244924" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130244924">(Jul 24 2018 at 23:36)</a>:</h4>
<p>alternatively, i thought about just separating the combined patch by file, but that still makes for quite a large patch in most cases</p>



<a name="130244929"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130244929" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130244929">(Jul 24 2018 at 23:36)</a>:</h4>
<p>well, not just though about, i tried that a lot</p>



<a name="130244941"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130244941" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130244941">(Jul 24 2018 at 23:37)</a>:</h4>
<p>but it didn't feel optimal and i hoped rebasing would be easier</p>



<a name="130245237"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130245237" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130245237">(Jul 24 2018 at 23:45)</a>:</h4>
<p>hmmmmm.... i thiiiiiiiiiiiink i just rebased it successfully?</p>



<a name="130245316"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130245316" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130245316">(Jul 24 2018 at 23:47)</a>:</h4>
<p>this just removed unrelated and reverted commits</p>



<a name="130245324"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130245324" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130245324">(Jul 24 2018 at 23:48)</a>:</h4>
<p>i think i might be able to use rebase after all.....</p>



<a name="130245366"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130245366" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130245366">(Jul 24 2018 at 23:48)</a>:</h4>
<p>better make a new branch though... just to be safe...</p>



<a name="130245371"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130245371" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130245371">(Jul 24 2018 at 23:48)</a>:</h4>
<p>....i should be writing these to my log instead of rambling on the chat, shouldn't i</p>



<a name="130246073"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130246073" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130246073">(Jul 25 2018 at 00:08)</a>:</h4>
<p>hmm, it didn't work out. let's cherry pick then...</p>



<a name="130253645"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130253645" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130253645">(Jul 25 2018 at 04:08)</a>:</h4>
<blockquote>
<p>....i should be writing these to my log instead of rambling on the chat, shouldn't i</p>
</blockquote>
<p>rambling is perfectly fine, appreciated even ... better than only writing to your log   :)</p>



<a name="130379487"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130379487" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130379487">(Jul 27 2018 at 00:24)</a>:</h4>
<p>so, i'm going forward with the rebasing after all and splitting commits as needed, this should make them more manageable</p>



<a name="130379502"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130379502" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130379502">(Jul 27 2018 at 00:25)</a>:</h4>
<p>after that, i can hopefully pick the changes out of order and present some nice patches</p>



<a name="130379559"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130379559" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130379559">(Jul 27 2018 at 00:26)</a>:</h4>
<p>but the more realistic version is that there will be more patches that i'd like, but at least they will not include weird things</p>



<a name="130379785"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130379785" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130379785">(Jul 27 2018 at 00:33)</a>:</h4>
<p>aaannnnd that's the rebase plan thingy done, i probably shouldn't run the rebase itself at 2:32 because that's just gonna lead to more problems, so i'll make a backup of the git-rebase-todo file and go dream of nicer commit histories</p>



<a name="130386089"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130386089" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130386089">(Jul 27 2018 at 03:33)</a>:</h4>
<blockquote>
<p>after that, i can hopefully pick the changes out of order and present some nice patches</p>
</blockquote>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> to be honest, this sounds entirely unacceptable.  It's been an entire week and you still have no patches.  You could have retyped everything on an svn checkout in a day.  You've used a full week, 10% of GSoC coding period timeline, learning git and commit/patch management.  Please stop.</p>



<a name="130386132"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130386132" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130386132">(Jul 27 2018 at 03:34)</a>:</h4>
<p>at some point, you just have to throw in the towel doing things the automatic way, and do things manually ... I think we're way way way past that point</p>



<a name="130386504"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130386504" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130386504">(Jul 27 2018 at 03:45)</a>:</h4>
<p>I suggest that unless you have all your changes ready to go today, that you stop with git and simply make one feature change on an svn checkout, make an svn patch (svn diff &gt; change1.patch), submit that, and then get another checkout for change#2, make the changes, make the patch, submit, etc.</p>



<a name="130386549"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130386549" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130386549">(Jul 27 2018 at 03:46)</a>:</h4>
<p>you can extract a patchfile for every commit you've made with: git format-patch my_branch -o my_patches</p>



<a name="130386706"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130386706" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130386706">(Jul 27 2018 at 03:51)</a>:</h4>
<p>you can get an svn checkout with: svn co svn+ssh://SFUSERNAME@svn.code.sf.net/p/brlcad/code/brlcad/trunk brlcad.trunk</p>



<a name="130386709"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130386709" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130386709">(Jul 27 2018 at 03:51)</a>:</h4>
<p>if you don't have one already</p>



<a name="130429830"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130429830" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130429830">(Jul 27 2018 at 19:06)</a>:</h4>
<p>soooo, I rebased it after all (sorry &gt;_&lt;) and now I have the patches</p>



<a name="130429871"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130429871" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130429871">(Jul 27 2018 at 19:07)</a>:</h4>
<p>buuut there are 45 so I probably should send them each separately on SF</p>



<a name="130429890"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130429890" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130429890">(Jul 27 2018 at 19:08)</a>:</h4>
<p>(there were more so, i think it's good i did those squashes)</p>



<a name="130430368"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130430368" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130430368">(Jul 27 2018 at 19:14)</a>:</h4>
<p>guess i'll upload it here first</p>
<p><a href="/user_uploads/1549/fGFji-qiZdrJcgy71OW65CiD/patches.tar.gz" target="_blank" title="patches.tar.gz">patches.tar.gz</a></p>



<a name="130444641"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130444641" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130444641">(Jul 28 2018 at 01:01)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> This isn't quite what we were looking for - rather than the various commits in git, we were looking for "feature" patches that provided compact, isolated improvements in capabilities.</p>



<a name="130444688"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130444688" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130444688">(Jul 28 2018 at 01:03)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> I'm going to take this patch set and get these changes committed, so we can move forward - watch the commits.  I'll post here once I've completed merging them.</p>



<a name="130448378"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130448378" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130448378">(Jul 28 2018 at 03:14)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span>   OK - take a look at SVN commits r71280 thru r71286.</p>



<a name="130448484"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130448484" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130448484">(Jul 28 2018 at 03:18)</a>:</h4>
<p>I saw a couple of things running that first example in the man page (or rather, the tweaked version from r71286 that produces a smaller output list with the m35.g example):</p>
<p>1. The exec version seems to be printing carriage returns, which it probably shouldn't if it's not printing the output explicitly in addition to the -exec (not sure what find does, but I would have expected it to either exec and not print or exec and print the search result list, not do the blank lines...)</p>
<p>2. When doing the full path version of the search -exec (e.g. supplying "/all.g" rather than "all.g") the draw command doesn't seem to be operating on the full paths - the "who" command, when run after the search -exec with "/all.g" should indicate it drew the full paths (this can matter if there are matricies along the full path.)</p>



<a name="130448801"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130448801" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130448801">(Jul 28 2018 at 03:31)</a>:</h4>
<p>So, to be a little more explicit/specific:</p>
<p>open up share/db/m35.g</p>
<p>run the following search (note the slash before all):</p>
<p>mged&gt; search /all.g -type region -and ( -below -bool - -or -below -bool + ) </p>
<p>You should see:</p>
<p>/all.g/component/bed/r908/r914/r906/r916<br>
/all.g/component/bed/r908/r914/r906<br>
/all.g/component/bed/r914/r906/r916<br>
/all.g/component/frame/r532/r506/r567</p>
<p>If you then clear your drawing list and do the draw search -exec:</p>
<p>mged&gt; Z<br>
mged&gt; search /all.g -type region -and ( -below -bool - -or -below -bool + ) -exec draw "{}" ";"</p>
<p>I would expect to see either nothing or the same output as above (probably the former, unless I explicitly -print as well as -exec) but instead I see:</p>
<p>expected boolean value but got ""</p>
<p>The good news is does draw the objects, but if I run the "who" command - which lists what is being drawn:</p>
<p>mged&gt; who<br>
r567 r906 r916 </p>
<p>That list show match the full path list above, since we did a full path search - if you explicitly draw the full paths and then do a who, you'll see draw can list them properly:</p>
<p>mged&gt; Z<br>
mged&gt; draw /all.g/component/bed/r908/r914/r906/r916 /all.g/component/bed/r908/r914/r906 /all.g/component/bed/r914/r906/r916 /all.g/component/frame/r532/r506/r567<br>
mged&gt; who<br>
/all.g/component/bed/r908/r914/r906/r916 /all.g/component/bed/r908/r914/r906 /all.g/component/bed/r914/r906/r916 /all.g/component/frame/r532/r506/r567 </p>
<p>So it looks like somewhere in the exec pipeline we need to propagate awareness of which type of search we did (full path vs unique name) and adjust what is fed into -exec accordingly</p>



<a name="130448805"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130448805" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130448805">(Jul 28 2018 at 03:32)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span>  very cool to see this working!</p>



<a name="130448952"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130448952" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130448952">(Jul 28 2018 at 03:36)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span>  So from the current state, I suggest you try to make a focused patch that has -exec work on either the unique object list or the full path list depending on the search type.  For -exec on full paths you'll probably want to use db_path_to_string to take the full path list and generate strings suitable for argv command execution.</p>
<p>Also, as a separate patch, I would see if you can eliminate the 'expected boolean value but got ""' error message</p>



<a name="130504003"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130504003" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130504003">(Jul 29 2018 at 02:37)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> in later versions of my branch i already use db_path_to_string, so that should be easy, but i'm not sure if the output actually should match the input at all times</p>



<a name="130504050"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130504050" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130504050">(Jul 29 2018 at 02:38)</a>:</h4>
<p>uhm that's not the best way to put it...</p>



<a name="130504062"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130504062" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130504062">(Jul 29 2018 at 02:38)</a>:</h4>
<p>so. BSD find(1) works on files, right?</p>



<a name="130504092"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130504092" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130504092">(Jul 29 2018 at 02:39)</a>:</h4>
<p>ignoring bind mount shenanigans, there is only one path to a file and so that path uniquely identifies the file</p>



<a name="130504096"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130504096" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130504096">(Jul 29 2018 at 02:39)</a>:</h4>
<p>but BRL-CAD is not like that, apparently.</p>



<a name="130504158"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130504158" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130504158">(Jul 29 2018 at 02:41)</a>:</h4>
<p>an object is uniquely identified by its name and names are actually in a flat namespace. objects don't <strong>contain</strong> other objects, not really, they kind of just use them</p>



<a name="130504209"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130504209" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130504209">(Jul 29 2018 at 02:42)</a>:</h4>
<p>at least that's my understanding so far</p>



<a name="130504239"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130504239" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130504239">(Jul 29 2018 at 02:43)</a>:</h4>
<p>oh...</p>



<a name="130504240"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130504240" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130504240">(Jul 29 2018 at 02:43)</a>:</h4>
<p>wait, nevermind.</p>



<a name="130504290"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130504290" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130504290">(Jul 29 2018 at 02:44)</a>:</h4>
<p>the problem here is that paths aren't identifiers of an object</p>



<a name="130504308"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130504308" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130504308">(Jul 29 2018 at 02:45)</a>:</h4>
<p>they identify a specific "use" of the object.... hm.</p>



<a name="130504312"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130504312" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130504312">(Jul 29 2018 at 02:45)</a>:</h4>
<p>anyways, re: the noisy output</p>



<a name="130504318"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130504318" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130504318">(Jul 29 2018 at 02:45)</a>:</h4>
<p>find(1) works with commands. commands have exit codes. Tcl commands don't have exit codes.</p>



<a name="130504320"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130504320" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130504320">(Jul 29 2018 at 02:45)</a>:</h4>
<p>Tcl doesn't even have bools.</p>



<a name="130504443"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130504443" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130504443">(Jul 29 2018 at 02:48)</a>:</h4>
<p>so, I turned to the only thing it has: text output.<br>
-exec is supposed to be a filter, if Tcl had types, -exec would take a function that returns bools. but! printing is also the side-effect of some commands! now, how should -exec know if you are only running something for its side-effects?</p>



<a name="130504452"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130504452" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130504452">(Jul 29 2018 at 02:48)</a>:</h4>
<p>the easy answer for me was that it simply shouldn't, the user is expected to work their Tcl magic to give <code>search -exec</code> the output it expects</p>



<a name="130504550"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130504550" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130504550">(Jul 29 2018 at 02:51)</a>:</h4>
<p>so, I think the nicer way to solve the noisy output problem would be to just let the user indicate that "hey, i'm running this purely for the side-effects, you can shut up about the format" and give them an equivalent to &amp;&gt;/dev/null</p>



<a name="130505373"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130505373" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130505373">(Jul 29 2018 at 03:13)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> So maybe the more straightforward problem at first is to get exec working on the full path results, when search is in full path mode</p>



<a name="130505496"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130505496" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130505496">(Jul 29 2018 at 03:16)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> could we at least have exec not print empty lines if the Tcl command doesn't produce any non-empty textual output?  Or is that completely out of the control of exec?</p>



<a name="130523226"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130523226" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130523226">(Jul 29 2018 at 12:44)</a>:</h4>
<p>that's controlled by mged's callback, so that's perfectly doable</p>



<a name="130527485"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130527485" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130527485">(Jul 29 2018 at 15:04)</a>:</h4>
<p>hmmm...... from a Tcl scripting perspective, is it bad if we swallow empty lines? i think that could be misleading for scripts...</p>



<a name="130527537"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130527537" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130527537">(Jul 29 2018 at 15:06)</a>:</h4>
<p>the current output isn't necessarily pretty, but it doesn't cause any surprises. I think that's better than being pretty??</p>



<a name="130527546"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130527546" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130527546">(Jul 29 2018 at 15:07)</a>:</h4>
<p>idk, i've written some code to filter newlines out but i'm not sure how this affects scripting since I'm not familiar enough with Tcl idioms</p>



<a name="130546211"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130546211" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130546211">(Jul 29 2018 at 23:58)</a>:</h4>
<p>We can try some tests, but I'd say first let's get exec operating on full path results when the search is a full path search</p>



<a name="130606223"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130606223" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130606223">(Jul 30 2018 at 21:43)</a>:</h4>
<p>ok, but I think it'd be better if it always operated on full paths because that's more uniform</p>



<a name="130606813"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130606813" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130606813">(Jul 30 2018 at 21:55)</a>:</h4>
<p>hmm.... inputs can be mixed, can't they?</p>



<a name="130606822"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130606822" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130606822">(Jul 30 2018 at 21:55)</a>:</h4>
<p>....my spider sense is telling me this will get messy</p>



<a name="130606823"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130606823" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130606823">(Jul 30 2018 at 21:55)</a>:</h4>
<p>ah well</p>



<a name="130607293"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130607293" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130607293">(Jul 30 2018 at 22:04)</a>:</h4>
<p>this is a small fix i made yesterday: <a href="https://sourceforge.net/p/brlcad/patches/502/" target="_blank" title="https://sourceforge.net/p/brlcad/patches/502/">https://sourceforge.net/p/brlcad/patches/502/</a></p>



<a name="130614992"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130614992" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130614992">(Jul 31 2018 at 01:40)</a>:</h4>
<blockquote>
<p>find(1) works with commands. commands have exit codes. Tcl commands don't have exit codes.</p>
</blockquote>
<p>Tcl commands have return codes -- they default to "TCL_OK" (aka "1") if a proc doesn't specify it or specifies "return"</p>



<a name="130615288"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130615288" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130615288">(Jul 31 2018 at 01:49)</a>:</h4>
<blockquote>
<p>hmmm...... from a Tcl scripting perspective, is it bad if we swallow empty lines? i think that could be misleading for scripts...</p>
</blockquote>
<p>I would question who/what is generating empty lines in the first place, what utility that has and whether it could change.  Gut reaction is that 'search' (and by extension search -exec) shouldn't be adding/removing/filtering lines. It should only print what it's been told to print (e.g., -print) or the output from commands it ran.</p>



<a name="130619029"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130619029" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130619029">(Jul 31 2018 at 03:33)</a>:</h4>
<blockquote>
<p>Tcl commands have return codes -- they default to "TCL_OK" (aka "1") if a proc doesn't specify it or specifies "return"</p>
</blockquote>
<p>I got the impression that that was just for Tcl's internal error reporting, since none of my searches on how to do bools in Tcl said "well just use the return code like in bash", instead they all talked about string tests. So does that mean I can just use Tcl_Eval's return and skip the boolean conversion?</p>



<a name="130619094"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130619094" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130619094">(Jul 31 2018 at 03:34)</a>:</h4>
<p>also I imagine it being used more like a filter function? since this is embedded scripting I can't help but apply my Lua mindset to it.</p>



<a name="130619103"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130619103" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130619103">(Jul 31 2018 at 03:35)</a>:</h4>
<p>so, one-liners with anonymous functions and stuff</p>



<a name="130619122"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130619122" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130619122">(Jul 31 2018 at 03:36)</a>:</h4>
<p>and it didn't seem like it had a way of returning a bool from an expression</p>



<a name="130619226"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130619226" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130619226">(Jul 31 2018 at 03:39)</a>:</h4>
<blockquote>
<p>ok, but I think it'd be better if it always operated on full paths because that's more uniform</p>
</blockquote>
<p>an unpathed "object" is (typically) synonymous with "/object" ... just that many commands take only one or the other depending on the command's purpose</p>



<a name="130619358"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130619358" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130619358">(Jul 31 2018 at 03:42)</a>:</h4>
<p>hmm, is there any command that behaves differently when given a path? i can't remember any off the bat...</p>



<a name="130619869"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130619869" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130619869">(Jul 31 2018 at 03:56)</a>:</h4>
<blockquote>
<p>I got the impression that that was just for Tcl's internal error reporting, since none of my searches on how to do bools in Tcl said "well just use the return code like in bash", instead they all talked about string tests. So does that mean I can just use Tcl_Eval's return and skip the boolean conversion?</p>
</blockquote>
<p>Return codes are somewhat an orthogonal topic to bools.  In Tcl, "everything is a string" -- <a href="https://wiki.tcl.tk/3018" target="_blank" title="https://wiki.tcl.tk/3018">https://wiki.tcl.tk/3018</a></p>



<a name="130619961"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130619961" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130619961">(Jul 31 2018 at 03:59)</a>:</h4>
<p>Let's not get too distracted from the practical reality -- you're really referring to Tcl's C API (which is conceptually quite different from Tcl's Tcl API).  For that, "man Tcl_Eval" and you'll see that you can indeed rely on a getting a whole host of potential return codes, each with a particular meaning.</p>



<a name="130620054"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130620054" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130620054">(Jul 31 2018 at 04:01)</a>:</h4>
<blockquote>
<p>and it didn't seem like it had a way of returning a bool from an expression</p>
</blockquote>
<p>again, it matters if we're talking about Tcl or C here -- but you can return a value from either  (on the Tcl side, see "man n return" and "man n catch")</p>



<a name="130620527"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130620527" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130620527">(Jul 31 2018 at 04:14)</a>:</h4>
<p>it seems like return codes in Tcl are the poor-man's-exceptions....</p>



<a name="130620582"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130620582" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130620582">(Jul 31 2018 at 04:16)</a>:</h4>
<p>oh I remember why i thought bool strings were the offical way, because boolean expressions "return" a 0 or 1 string</p>



<a name="130620583"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130620583" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130620583">(Jul 31 2018 at 04:16)</a>:</h4>
<p>like <code>expr 1 &gt; 0</code></p>



<a name="130620638"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130620638" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130620638">(Jul 31 2018 at 04:18)</a>:</h4>
<p>despite the supposed simplicity it is a surprisingly weird language</p>



<a name="130620644"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130620644" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130620644">(Jul 31 2018 at 04:19)</a>:</h4>
<p><code>if {1 &gt; 0} {echo a}</code> works but of course <code>1 &gt; 0</code> doesn't mean anything on its own....</p>



<a name="130620746"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130620746" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130620746">(Jul 31 2018 at 04:22)</a>:</h4>
<p>so, Tcl has integer returns but it doesn't use them like shells and there is no <code>$?</code> or <code>$status</code>, just <code>catch</code>....</p>



<a name="130686608"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130686608" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130686608">(Aug 01 2018 at 02:49)</a>:</h4>
<p>ah Tcl. fun thing I found out: <code>search -exec echo '{}' ";"</code> (yes, possibly wrong quoting) in <code>m35.g</code> basically freezes MGED<br>
i mean, it proooobably finishes after a while, but unlike <code>find(1)</code> which streams output nicely, Tcl has to collect everything in the result string (or object, but whatever), so it can't stream output.</p>



<a name="130686753"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130686753" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130686753">(Aug 01 2018 at 02:51)</a>:</h4>
<p>not an earth-shattering revelation, yeah, but a nice example of why constructs like UNIX pipes are useful</p>



<a name="130690490"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130690490" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130690490">(Aug 01 2018 at 04:03)</a>:</h4>
<blockquote>
<p>it seems like return codes in Tcl are the poor-man's-exceptions....</p>
</blockquote>
<p>Not really, just a completely different approach with tradeoff considerations.  If all languages behaved the same, there wouldn't be much point to having different ones. :)</p>
<p>In the case of Tcl, their method fully separates the notion of return codes from output at a scripting level.  That's particularly novel in comparison with posix/bash/ksh scripting where the two concepts are fully intermingled and you have to deal with it in convoluted logic or with presumptive convention.  Even compared with a compiled language, Tcl's 'catch' command goes beyond catching a return code in that it can catch any error from a hierarchy of subcommands.  Even C++-style exceptions can't really do that, or at least it would require some convention like using try-catch in leu of return codes -- which is typically quite a bad idea, discouraged.</p>



<a name="130690701"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130690701" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130690701">(Aug 01 2018 at 04:08)</a>:</h4>
<blockquote>
<p><code>if {1 &gt; 0} {echo a}</code> works but of course <code>1 &gt; 0</code> doesn't mean anything on its own....</p>
</blockquote>
<p>the rabbit hole goes MUCH deeper.  in Tcl, <em>everything</em> is a command or a string.  there is actually no if/then/else language construct like you're used to seeing.  that 'if' statement there is actually running an 'if' _command_ that takes two strings... two arbitrarily complex strings</p>



<a name="130692509"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130692509" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130692509">(Aug 01 2018 at 04:49)</a>:</h4>
<blockquote>
<p>not an earth-shattering revelation, yeah, but a nice example of why constructs like UNIX pipes are useful</p>
</blockquote>
<p>patches welcome!  you could certainly make it stream the output back over a pipe :)</p>



<a name="130706542"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130706542" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130706542">(Aug 01 2018 at 11:09)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span>  Can't you just feed the output from both types of returns to the commands?</p>



<a name="130706632"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130706632" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130706632">(Aug 01 2018 at 11:11)</a>:</h4>
<p>My original thought was that you would take the two different types of results, get the string forms (either dp-&gt;d_namep for objects or db_path_to_string for full paths) and pass that on to the exec cmd.  Does that not work?</p>



<a name="130715997"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130715997" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130715997">(Aug 01 2018 at 14:04)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> yeah, i've written something like that, it just has to communicate which one to use</p>



<a name="130716046"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130716046" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130716046">(Aug 01 2018 at 14:05)</a>:</h4>
<p>but i've run into some weirdness with the Tcl result thing (it always returns an empty string for some reason?) and i'm gonna debug that first</p>



<a name="130716396"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130716396" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130716396">(Aug 01 2018 at 14:10)</a>:</h4>
<p><span class="user-mention" data-user-id="102902">@Sean</span> yeah, i get <code>if</code> being a command, but it feels a bit.... too special cased that it accepts expressions. it's certainly simpler than <code>sh</code> but i'm not sure it is simpler/better than <code>rc</code><br>
but then again, rc is not an embedded language, so they are quite different beasts</p>



<a name="130716686"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130716686" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130716686">(Aug 01 2018 at 14:14)</a>:</h4>
<p>it's an odd language for me because it looks like rc but doesn't have its main strengths (pipes) but was built to fit a niche similar to Lua but it doesn't have the strengths of that either</p>



<a name="130716842"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130716842" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130716842">(Aug 01 2018 at 14:16)</a>:</h4>
<p>(so no metatables, no iterators, not fast like Lua, doesn't have closures, probably no TCO, etc.)</p>



<a name="130718412"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130718412" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130718412">(Aug 01 2018 at 14:38)</a>:</h4>
<blockquote>
<p>(it always returns an empty string for some reason?)</p>
</blockquote>
<p>ah. i was a fool and was getting the result before the eval. <span class="emoji emoji-1f926" title="face palm">:face_palm:</span></p>



<a name="130721925"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130721925" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130721925">(Aug 01 2018 at 15:33)</a>:</h4>
<p><a href="https://core.tcl.tk/tcllib/doc/trunk/embedded/www/tcllib/files/modules/lambda/lambda.html" target="_blank" title="https://core.tcl.tk/tcllib/doc/trunk/embedded/www/tcllib/files/modules/lambda/lambda.html">https://core.tcl.tk/tcllib/doc/trunk/embedded/www/tcllib/files/modules/lambda/lambda.html</a> could this be used in MGED?</p>



<a name="130743216"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130743216" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130743216">(Aug 01 2018 at 21:37)</a>:</h4>
<p>tbh what i'm more concerned about is that only the last error is printed because the result string is overwritten after every Tcl_Eval</p>



<a name="130759999"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130759999" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130759999">(Aug 02 2018 at 05:38)</a>:</h4>
<blockquote>
<p><span class="user-mention" data-user-id="102902">@Sean</span> yeah, i get <code>if</code> being a command, but it feels a bit.... too special cased that it accepts expressions. it's certainly simpler than <code>sh</code> but i'm not sure it is simpler/better than <code>rc</code></p>
</blockquote>
<p>I don't actually agree that it's simpler than shell other than from a language theory perspective (the conceptual model).  the language expressiveness is far more complicated than shell, the capability is far more expressive too</p>



<a name="130760015"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130760015" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130760015">(Aug 02 2018 at 05:39)</a>:</h4>
<p>definitely an odd language, but no more so than perl or shell in my mind, just different tradeoffs/benefits/warts</p>



<a name="130760309"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130760309" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130760309">(Aug 02 2018 at 05:49)</a>:</h4>
<p>I'd argue Tcl is far more capable and expressive as a embedded command interpreter with natural syntax (e.g., "do this" not "do(&amp;this)" or "this.do()" or what have you)</p>



<a name="130760368"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130760368" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130760368">(Aug 02 2018 at 05:50)</a>:</h4>
<p>(over the likes of lua and shell at least)</p>



<a name="130760492"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130760492" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130760492">(Aug 02 2018 at 05:54)</a>:</h4>
<p>I digress .. :)   the result string getting smashed by subsequent calls happens in libged too, but how is that an issue for -exec?  you're invoking each one so couldn't it capture the result?  it's supposed to be returned as a true/false predicate for subsequent search command plan statements</p>



<a name="130760512"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130760512" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130760512">(Aug 02 2018 at 05:55)</a>:</h4>
<p>example:</p>



<a name="130760513"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130760513" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130760513">(Aug 02 2018 at 05:55)</a>:</h4>
<p>agua:~ morrison$ find test.cpp -exec true \; -exec echo true \; -exec false \; -exec echo false \;<br>
true</p>



<a name="130760560"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130760560" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130760560">(Aug 02 2018 at 05:56)</a>:</h4>
<p>it ran all three exec's except the last one because of the 'false' command's return code</p>



<a name="130814241"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130814241" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130814241">(Aug 03 2018 at 02:51)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> how are things going?</p>



<a name="130815708"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130815708" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130815708">(Aug 03 2018 at 03:31)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span>  i made a small fix so far and have been trying to figure out how to get results out of <code>-exec</code> nicely and how to pass callbacks nicely, but it's. eh. it's like... i get that the output is ugly but i don't know how to make it better???</p>



<a name="130815710"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130815710" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130815710">(Aug 03 2018 at 03:31)</a>:</h4>
<p>i wanted to write more stuff for that fix but i couldn't figure out how to improve it</p>



<a name="130815711"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130815711" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130815711">(Aug 03 2018 at 03:31)</a>:</h4>
<p>so i'll just send it over as it is</p>



<a name="130815759"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130815759" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130815759">(Aug 03 2018 at 03:32)</a>:</h4>
<p>i gotta do some bureaucracy stuff for next semester so i'll be running around the city today</p>



<a name="130815825"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130815825" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130815825">(Aug 03 2018 at 03:35)</a>:</h4>
<p>the paths vs names thing is still...... well idk if it's a good idea to do so much conversion based on the input</p>



<a name="130815828"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130815828" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130815828">(Aug 03 2018 at 03:35)</a>:</h4>
<p>if the user wants to, they can easily transform a path into a name</p>



<a name="130815876"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130815876" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130815876">(Aug 03 2018 at 03:37)</a>:</h4>
<p>soooo, either they should always get full paths or they should get to choose between two -exec flags or there should be two kinds of "holes"</p>



<a name="130815877"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130815877" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130815877">(Aug 03 2018 at 03:37)</a>:</h4>
<p>these are also easier to implement than trying to pass down info about what the input was into c_exec</p>



<a name="130815923"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130815923" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130815923">(Aug 03 2018 at 03:38)</a>:</h4>
<p>also, idk about how Tcl is usually used but could MGED have tools for higher-order functions and lambdas?</p>



<a name="130815930"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130815930" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130815930">(Aug 03 2018 at 03:38)</a>:</h4>
<p>Tcl seems to have packages for that stuff but a quick test showed that the lambda package isn't in MGED</p>



<a name="130816284"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130816284" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130816284">(Aug 03 2018 at 03:51)</a>:</h4>
<blockquote>
<p>if the user wants to, they can easily transform a path into a name</p>
</blockquote>
<p>they could, but this totally violates expectations and desired behavior.  if I specify "search . -exec echo {}" vs "search / -exec echo {}", they imply a different result.</p>



<a name="130816522"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130816522" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130816522">(Aug 03 2018 at 03:58)</a>:</h4>
<blockquote>
<p>these are also easier to implement than trying to pass down info about what the input was into c_exec</p>
</blockquote>
<p>maybe easier to implement but more complicated for users and error prone  == not good</p>



<a name="130835583"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130835583" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130835583">(Aug 03 2018 at 12:18)</a>:</h4>
<p>hmmm. well, what if I add the alternative hole syntax that forces filling with either the name or the full path but also modify the normal hole handling to use the input to decide how to fill it in?</p>



<a name="130835612"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130835612" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130835612">(Aug 03 2018 at 12:19)</a>:</h4>
<p>the alternative hole syntax thingy is mostly done anyways</p>



<a name="130851277"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130851277" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130851277">(Aug 03 2018 at 17:15)</a>:</h4>
<p>I don't understand what you mean by alternative hole</p>



<a name="130851323"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130851323" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130851323">(Aug 03 2018 at 17:16)</a>:</h4>
<p>if you're pushing the work onto the user (i.e., making it more complicated and error-prone to use), then that is a complete non-starter</p>



<a name="130851329"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130851329" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130851329">(Aug 03 2018 at 17:16)</a>:</h4>
<p>you mean some syntax other than {} ?</p>



<a name="130851649"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130851649" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130851649">(Aug 03 2018 at 17:23)</a>:</h4>
<p>that would still be unfriendly, error-prone, unusual.  can you recap what the problem is?  getting basic substitution working doesn't seem like it should be that complicated to me -- the user already specified whether they want absolute or relative paths or a flat unique 'basename' listing</p>



<a name="130851709"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130851709" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130851709">(Aug 03 2018 at 17:24)</a>:</h4>
<p>you just need to get that information to the code doing the exec or substitution</p>



<a name="130929268"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130929268" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130929268">(Aug 05 2018 at 12:13)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> I've applied your 502 and 503 patches.  Aside from the minor whitespace bit, they applied cleanly</p>



<a name="130929446"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/130929446" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#130929446">(Aug 05 2018 at 12:18)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span>  I would really recommend trying the following, if you haven't done so already:</p>
<p>In f_exec, instead of directly pulling the dp pointer from db_node-&gt;path,  check dp_node-&gt;path-&gt;fp_len</p>
<p>If fp_len &gt; 1, use db_path_to_string to make a path to feed to the subsequent logic.  else, use the object d_namep.</p>
<p>Also, what's the bu_fnmatch on search.c:1263 trying to achieve?  We don't seem to be doing anything with that result, and it's not immediately clear to me what you're trying to match the name against?</p>



<a name="131009988"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131009988" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131009988">(Aug 06 2018 at 23:35)</a>:</h4>
<blockquote>
<p>Also, what's the bu_fnmatch on search.c:1263 trying to achieve? We don't seem to be doing anything with that result, and it's not immediately clear to me what you're trying to match the name against?</p>
</blockquote>
<p>tbqh i had no idea at the time how to use the db_node as a short name so i just copy-pasted code from some simpler filter. later i rolled that change back and went back to using full path strings everywhere, but either i rolled that back too or Sean only applied some of the patches and they still included that incomplete code</p>



<a name="131010042"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131010042" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131010042">(Aug 06 2018 at 23:36)</a>:</h4>
<p>tldr: i had no idea at the time what the thing i copied did so i left everything intact until i could see that it works at which point i would have eliminated unnecessary parts</p>



<a name="131010906"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131010906" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131010906">(Aug 07 2018 at 00:00)</a>:</h4>
<p><a href="https://sourceforge.net/p/brlcad/patches/504/" target="_blank" title="https://sourceforge.net/p/brlcad/patches/504/">https://sourceforge.net/p/brlcad/patches/504/</a></p>



<a name="131015666"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131015666" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131015666">(Aug 07 2018 at 02:16)</a>:</h4>
<p>Any thoughts on the fullpath handling?  We're getting down to the wire...</p>



<a name="131083859"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131083859" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131083859">(Aug 08 2018 at 03:00)</a>:</h4>
<p>I'm not following why we can't just substitute full paths into the {} hole</p>



<a name="131084198"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131084198" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131084198">(Aug 08 2018 at 03:08)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> it may be that some of the commands can't handle full paths properly, but that is the command's problem not that of search -exec</p>



<a name="131101509"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131101509" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131101509">(Aug 08 2018 at 11:17)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> Please try the approach I outlined above and see what happens - even if it has problems, that patch should be a step in the right direction.</p>



<a name="131101627"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131101627" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131101627">(Aug 08 2018 at 11:20)</a>:</h4>
<p>(Reminder)<br>
In f_exec, instead of directly pulling the dp pointer from db_node-&gt;path, check dp_node-&gt;path-&gt;fp_len<br>
If fp_len &gt; 1, use db_path_to_string to make a path to feed to the subsequent logic. else, use the object d_namep.</p>



<a name="131130439"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131130439" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131130439">(Aug 08 2018 at 20:17)</a>:</h4>
<p><a href="https://sourceforge.net/p/brlcad/patches/507/" target="_blank" title="https://sourceforge.net/p/brlcad/patches/507/">https://sourceforge.net/p/brlcad/patches/507/</a> i guess i forgot to send this patch</p>



<a name="131130451"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131130451" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131130451">(Aug 08 2018 at 20:18)</a>:</h4>
<p>there are a few other ones on SF</p>



<a name="131144663"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131144663" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131144663">(Aug 09 2018 at 02:09)</a>:</h4>
<p>Got most of them applied - trying to test #507, but hitting some other problem that doesn't seem to be related to that patch</p>



<a name="131145032"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131145032" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131145032">(Aug 09 2018 at 02:19)</a>:</h4>
<p>Alright, backed up a few commits and the patch works, so applying.</p>



<a name="131145840"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131145840" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131145840">(Aug 09 2018 at 02:42)</a>:</h4>
<p>Ah, I missed this in r71461.  You actually don't want to free the strings, since this level of memory management is not the level controlling the string pointers.  Looks like we also want to make sure the splan entries are allocated before freeing.  Fixed in r71464</p>



<a name="131145857"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131145857" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131145857">(Aug 09 2018 at 02:42)</a>:</h4>
<p>As of that commit, search / -type shape -exec draw "{}" ";" works!</p>



<a name="131157973"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131157973" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131157973">(Aug 09 2018 at 08:24)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> per your log, Tcl can do lambdas but I don't think you have enough Tcl experience or time to learn the nuances of using them.  Moreover, I <em>really</em> can't envision what you possibly need them for that wouldn't be better or more simply implemented a different way.  rather, the Tcl side should frankly be as lean as possible.  this gets back to one of the earliest discussions I recall <span class="user-mention" data-user-id="112516">@starseeker</span> and I having with you when the project got started, about whether to provide a hook back to Tcl or bind into libged.  we still may need to go the latter route just from a consistency perspective (e.g., consider python scripts running search -exec in an embedded ged context), but there is undeniable appeal in being able to call arbitrary Tcl procs during exec.  Regardless, lambdas are syntactic sugar -- if you have something begging for it, I'd like to see the specific case after evals are due.  Before then, seems like a complete distraction/crutch/hammer/excuse.</p>



<a name="131190161"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131190161" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131190161">(Aug 09 2018 at 18:40)</a>:</h4>
<p>Major kudos on the latest patch, <span class="user-mention" data-user-id="111633">@Peter Pronai</span>!  Core functionality is looking nearly ready.  How are docs looking? What’s next?</p>



<a name="131190342"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131190342" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131190342">(Aug 09 2018 at 18:43)</a>:</h4>
<p>I was doing bugfixes but ye, good reminder, I should update the docs regarding the specific format of paths.</p>



<a name="131190424"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131190424" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131190424">(Aug 09 2018 at 18:44)</a>:</h4>
<p>I wanted to use lambdas because that's kinda what I'm used to, eval with string substitution is way uglier than passing in an anonymous function</p>



<a name="131190500"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131190500" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131190500">(Aug 09 2018 at 18:46)</a>:</h4>
<p>eg. one of the examples I rewrote to use -exec instead of storing everything in an array does work but tbqh i was not sure how or why</p>



<a name="131190526"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131190526" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131190526">(Aug 09 2018 at 18:46)</a>:</h4>
<p>basically, lambdas are nice for one-liners where you wanna do all sorts of fun things with the parameters</p>



<a name="131212270"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131212270" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131212270">(Aug 10 2018 at 03:09)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span>  I think r71475 might address the confusion we both had about returning the results - I had the mistaken impression the array of fullpath results was trimmed down to a single db (which is not the case, and meant that once I tried a more hierarchy rich model I saw the problem.)  Fortunately, we do have the necessary information available in db_node-&gt;flags.</p>



<a name="131212313"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131212313" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131212313">(Aug 10 2018 at 03:10)</a>:</h4>
<p>So it's the same solution, just keying off of the flag rather than the path length</p>



<a name="131212415"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131212415" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131212415">(Aug 10 2018 at 03:12)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span>  isn't it different for single element paths?</p>



<a name="131212419"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131212419" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131212419">(Aug 10 2018 at 03:12)</a>:</h4>
<p>I was getting some odd failures to print output - can you give me your opinion on commit r71476?</p>



<a name="131212499"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131212499" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131212499">(Aug 10 2018 at 03:14)</a>:</h4>
<p>its the same logic you had in your #507 patch, but rather than checking the db_full_path length (which at this stage of the pipeline still has the full paths of all results, which was a conceptual mistake I made earlier) we can key off of the db_node-&gt;flags DB_SEARCH_RETURN_UNIQ_DP setting.</p>



<a name="131212506"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131212506" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131212506">(Aug 10 2018 at 03:14)</a>:</h4>
<p>hmm</p>



<a name="131212524"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131212524" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131212524">(Aug 10 2018 at 03:15)</a>:</h4>
<p>r71476 looks cleaner actually.... but afaik the result in Tcl is used for error handling not boolean returns?</p>



<a name="131212529"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131212529" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131212529">(Aug 10 2018 at 03:15)</a>:</h4>
<p>but yeah it's probably better to always print the result...</p>



<a name="131212584"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131212584" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131212584">(Aug 10 2018 at 03:16)</a>:</h4>
<p>I was getting problems with the search / -exec echo "{}" ";" output, and ended up tweaking how the returns are handled.  What I'm not sure of is if I broke something else in doing so - I get the behavior I expect, but I'd like you to test it out and see if it's not doing what you expect.</p>



<a name="131212668"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131212668" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131212668">(Aug 10 2018 at 03:18)</a>:</h4>
<div class="codehilite"><pre><span></span>$ echo &#39;search / -exec echo &quot;{}&quot; &quot;;&quot; &#39; | ./bin/mged ../../db/NIST_MBE_PMI_7-10.g
/NIST_MBE_PMI_7-10.3dm
/NIST_MBE_PMI_7-10.3dm/Default
/NIST_MBE_PMI_7-10.3dm/Default/Solid1_4
/NIST_MBE_PMI_7-10.3dm/Default/Solid1_4/Solid1_4.s
/NIST_MBE_PMI_7-10.3dm/Default/Solid1_3
/NIST_MBE_PMI_7-10.3dm/Default/Solid1_3/Solid1_3.s
/NIST_MBE_PMI_7-10.3dm/Default/Solid1_2
/NIST_MBE_PMI_7-10.3dm/Default/Solid1_2/Solid1_2.s
/NIST_MBE_PMI_7-10.3dm/Default/Solid1
/NIST_MBE_PMI_7-10.3dm/Default/Solid1/Solid1.s
</pre></div>


<p>that looks like the correct output</p>



<a name="131212788"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131212788" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131212788">(Aug 10 2018 at 03:21)</a>:</h4>
<p>so my next question is how things behave with multiple -exec statements</p>



<a name="131212854"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131212854" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131212854">(Aug 10 2018 at 03:23)</a>:</h4>
<p>for example, what's the behavior if you have one exec that does a mv {} {}.1 and then trys to exec a draw {} - will it do left-to-right ordering on execution?  e.g. will the draws fail because {} is now at {}.1 thanks to the mv?</p>



<a name="131212874"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131212874" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131212874">(Aug 10 2018 at 03:23)</a>:</h4>
<p>I'd suggest determining what the behavior is and documenting it in the search man page so users know what to expect.</p>



<a name="131212888"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131212888" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131212888">(Aug 10 2018 at 03:23)</a>:</h4>
<div class="codehilite"><pre><span></span>$ echo &#39;search / -exec echo &quot;{}&quot; &quot;;&quot; -exec echo foo &quot;{}&quot; bar &quot;;&quot;&#39; | ./bin/mged ../../db/NIST_MBE_PMI_7-10.g/NIST_MBE_PMI_7-10.3dm
/NIST_MBE_PMI_7-10.3dm/Default
/NIST_MBE_PMI_7-10.3dm/Default/Solid1_4
/NIST_MBE_PMI_7-10.3dm/Default/Solid1_4/Solid1_4.s
/NIST_MBE_PMI_7-10.3dm/Default/Solid1_3
/NIST_MBE_PMI_7-10.3dm/Default/Solid1_3/Solid1_3.s
/NIST_MBE_PMI_7-10.3dm/Default/Solid1_2
/NIST_MBE_PMI_7-10.3dm/Default/Solid1_2/Solid1_2.s
/NIST_MBE_PMI_7-10.3dm/Default/Solid1
/NIST_MBE_PMI_7-10.3dm/Default/Solid1/Solid1.s
</pre></div>


<p>....huh...</p>



<a name="131212955"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131212955" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131212955">(Aug 10 2018 at 03:24)</a>:</h4>
<p>hmm</p>



<a name="131212964"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131212964" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131212964">(Aug 10 2018 at 03:25)</a>:</h4>
<p>soooo the question is "is this a lazy evaling and"</p>



<a name="131212977"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131212977" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131212977">(Aug 10 2018 at 03:25)</a>:</h4>
<p>do multiple echos print out the output twice?</p>



<a name="131213034"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131213034" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131213034">(Aug 10 2018 at 03:26)</a>:</h4>
<p>if not, figuring out why is the next step</p>



<a name="131213071"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131213071" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131213071">(Aug 10 2018 at 03:27)</a>:</h4>
<div class="codehilite"><pre><span></span>mged&gt; proc foo {x} {

? echo foo $x

? echo bar $x

? }

mged&gt; foo a
bar a

mged&gt;
</pre></div>


<p>......................Tcl is confusing</p>



<a name="131213113"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131213113" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131213113">(Aug 10 2018 at 03:28)</a>:</h4>
<p>oh wait nvm</p>



<a name="131213120"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131213120" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131213120">(Aug 10 2018 at 03:28)</a>:</h4>
<p>wait. yes mind</p>



<a name="131213178"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131213178" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131213178">(Aug 10 2018 at 03:29)</a>:</h4>
<p>i thought i misread it but no, the <code>foo a</code> is the function call i entered</p>



<a name="131213179"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131213179" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131213179">(Aug 10 2018 at 03:29)</a>:</h4>
<p>and that's not even a search -exec thing, that's hello world 2.0</p>



<a name="131213180"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131213180" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131213180">(Aug 10 2018 at 03:29)</a>:</h4>
<p>why isn't it printing <code>foo a</code></p>



<a name="131213197"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131213197" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131213197">(Aug 10 2018 at 03:29)</a>:</h4>
<p>search / -exec echo "{}" ";" -exec  echo "{}" ";" </p>
<p>What does that do?  For that matter, what does find do with that on the OS command line?</p>



<a name="131213248"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131213248" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131213248">(Aug 10 2018 at 03:30)</a>:</h4>
<div class="codehilite"><pre><span></span>mged&gt; search / -exec echo &quot;{}&quot; &quot;;&quot; -exec echo &quot;{}&quot; &quot;;&quot;
/NIST_MBE_PMI_7-10.3dm
/NIST_MBE_PMI_7-10.3dm/Default
/NIST_MBE_PMI_7-10.3dm/Default/Solid1_4
/NIST_MBE_PMI_7-10.3dm/Default/Solid1_4/Solid1_4.s
/NIST_MBE_PMI_7-10.3dm/Default/Solid1_3
/NIST_MBE_PMI_7-10.3dm/Default/Solid1_3/Solid1_3.s
/NIST_MBE_PMI_7-10.3dm/Default/Solid1_2
/NIST_MBE_PMI_7-10.3dm/Default/Solid1_2/Solid1_2.s
/NIST_MBE_PMI_7-10.3dm/Default/Solid1
/NIST_MBE_PMI_7-10.3dm/Default/Solid1/Solid1.s
</pre></div>



<a name="131213267"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131213267" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131213267">(Aug 10 2018 at 03:31)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> So, should it be reporting the results twice?  That would have been my first guess, but I'd also suggest checking what find does in a similar case.</p>



<a name="131213280"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131213280" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131213280">(Aug 10 2018 at 03:31)</a>:</h4>
<p>find output of /tmp</p>
<div class="codehilite"><pre><span></span>.
.
./mozilla_rain0
./mozilla_rain0
./tmp.RZEtmTN5Tu
./tmp.RZEtmTN5Tu
./tmp.RZEtmTN5Tu/acme
./tmp.RZEtmTN5Tu/acme
./tmp.RZEtmTN5Tu/plumb
./tmp.RZEtmTN5Tu/plumb
./tmp.EzCqEyABTc
./tmp.EzCqEyABTc
./tmp.EzCqEyABTc/acme
./tmp.EzCqEyABTc/acme
./tmp.EzCqEyABTc/plumb
./tmp.EzCqEyABTc/plumb
./Temp-57bdf871-5e70-47a5-8180-755dda4eb98b
./Temp-57bdf871-5e70-47a5-8180-755dda4eb98b
./qipc_sharedmemory_qtox45bdc9c0c458c8a25fc32de3a5f6d795f60b53f9
./qipc_sharedmemory_qtox45bdc9c0c458c8a25fc32de3a5f6d795f60b53f9
./qipc_systemsem_qtox45bdc9c0c458c8a25fc32de3a5f6d795f60b53f9
./qipc_systemsem_qtox45bdc9c0c458c8a25fc32de3a5f6d795f60b53f9
./.esd-1000
./.esd-1000
./.esd-1000/socket
./.esd-1000/socket
./keepassxc-rain.socket
./keepassxc-rain.socket
./keepassxc-rain.lock
./keepassxc-rain.lock
./ns.rain.:0
./ns.rain.:0
./ns.rain.:0/plumb
./ns.rain.:0/plumb
./.X0-lock
./.X0-lock
./systemd-private-755da5f6ec004e17a9c73eeadc3d9ee7-chronyd.service-grVvTU
./systemd-private-755da5f6ec004e17a9c73eeadc3d9ee7-chronyd.service-grVvTU
./.Test-unix
./.Test-unix
./.font-unix
./.font-unix
./.XIM-unix
./.XIM-unix
./.ICE-unix
./.ICE-unix
./.X11-unix
./.X11-unix
./.X11-unix/X0
./.X11-unix/X0
</pre></div>



<a name="131213285"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131213285" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131213285">(Aug 10 2018 at 03:31)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> I've got to sign off for the evening - go ahead and dig into that and see what you can find (remember to discuss what you are finding on your log)</p>



<a name="131213332"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131213332" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131213332">(Aug 10 2018 at 03:32)</a>:</h4>
<p>i should sleep too, but i'll be back in a few hours</p>



<a name="131213405"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131213405" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131213405">(Aug 10 2018 at 03:34)</a>:</h4>
<p>well, g'nity</p>



<a name="131217242"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131217242" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131217242">(Aug 10 2018 at 05:24)</a>:</h4>
<blockquote>
<p>eg. one of the examples I rewrote to use -exec instead of storing everything in an array does work but tbqh i was not sure how or why</p>
</blockquote>
<p>which example was that?</p>



<a name="131217757"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131217757" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131217757">(Aug 10 2018 at 05:39)</a>:</h4>
<blockquote>
<p>basically, lambdas are nice for one-liners where you wanna do all sorts of fun things with the parameters</p>
</blockquote>
<p>very familiar with lambdas. :)   <em>very</em> old programming construct; quite common with functional programming languages like ML and Lisp, and more recently getting surged attention in many languages with C/C++11 getting them.</p>



<a name="131217808"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131217808" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131217808">(Aug 10 2018 at 05:40)</a>:</h4>
<p>Imho, there's very few instances outside of functional languages where they do more than save you (literally) 2-4 lines of code.  Not that I don't appreciate the brevity, but there are many languages where that's not the a good fit with the processing model.  It's like how it's awkward to write procedural code in Java or functional code in C++ .. you can do it but it's usually just bad practice and unmaintainable to anyone other than the original author.</p>



<a name="131218006"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131218006" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131218006">(Aug 10 2018 at 05:46)</a>:</h4>
<p>tcl actually embraces lambda's very strongly (heck it's -everything-is-a-command- perspective means even basic language constructs like "if [] {}" is essentially a higher-order function being given two anonymous functions with automatic scope import/export), but it's atypical in user code.  there are simply easier and more readable alternatives given the procedural command environment.</p>



<a name="131218146"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131218146" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131218146">(Aug 10 2018 at 05:50)</a>:</h4>
<blockquote>
<p>$ echo 'search / -exec echo "{}" ";" ' | ./bin/mged ../../db/NIST_MBE_PMI_7-10.g</p>
</blockquote>
<p>FYI, this should be equiv:  $ ./bin/mged -c ../../db/NIST_MBE_PMI_7-10.g search / -exec echo "{}" ";"</p>



<a name="131219096"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131219096" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131219096">(Aug 10 2018 at 06:16)</a>:</h4>
<blockquote>
<p>......................Tcl is confusing</p>
</blockquote>
<p>That is mged's fault, not Tcls.  Remember that your running a highly modified embedded interpreter there.  It's doing a lot of things automatically that Tcl doesn't usually do, and some of those things complicate...  for example, here's what you wrote in various forms all the way up to the right form:</p>
<div class="codehilite"><pre><span></span>agua:~ morrison$ tclsh
% proc foo {x} {
echo foo $x
echo bar $x
}
% foo a
invalid command name &quot;echo&quot;
% proc foo {x} {
puts foo $x
puts bar $x
}
% foo a
can not find channel named &quot;foo&quot;
% proc foo {x} {
puts &quot;foo $x&quot;
puts &quot;bar $x&quot;
}
% foo a
foo a
bar a
</pre></div>



<a name="131219169"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131219169" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131219169">(Aug 10 2018 at 06:19)</a>:</h4>
<p>In your example, 'echo' is an mged command, not a tcl command, and either it is wiping out the result or mged is running both, but resetting/overwriting as it iterates though the evaluation and gets results back from tcl.</p>



<a name="131219740"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131219740" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131219740">(Aug 10 2018 at 06:37)</a>:</h4>
<blockquote>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> So, should it be reporting the results twice?  That would have been my first guess, but I'd also suggest checking what find does in a similar case.</p>
</blockquote>
<p>it should, but mged may be getting in the way ... either mged, search, or the command (echo here) is probably wiping out the result  string after each exec.  as it also happens for me with puts, that implies it's either mged or search wiping out the result.  another test with </p>
<div class="codehilite"><pre><span></span>echo &quot;search . -exec puts \&quot;{}\&quot; \&quot;;\&quot; -exec puts \&quot;{}\&quot; \&quot;;\&quot; ; puts hello&quot; | bin/mged test.g
</pre></div>


<p>implies that search is wiping out the result as it prints the hello along with the puts'</p>



<a name="131229958"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131229958" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131229958">(Aug 10 2018 at 10:42)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> Definitely you want to try and figure out what's happening in the search code then - we definitely want the multi-echo case to  work.</p>



<a name="131230568"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131230568" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131230568">(Aug 10 2018 at 10:58)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span>  one data point I can offer - a quick check in gdb working with the share/db/moss.g example and the following search input:</p>
<p>search / -type tor -exec echo "{}" ";" -exec echo "{}" ";"</p>
<p>indicates that c_exec does seem to be getting called twice, but f_exec is only being called once - e.g. it's allocating two searchplan objects that are N_EXEC types, but only getting to one of them for execution.</p>



<a name="131230647"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131230647" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131230647">(Aug 10 2018 at 11:01)</a>:</h4>
<p>I wonder if one problem we might be having here is if the search plan execution is interpreting the f_exec output as a "non-match" filter and halting filter processing once the first -exec "filter" is complete.</p>



<a name="131230689"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131230689" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131230689">(Aug 10 2018 at 11:02)</a>:</h4>
<p>If that's the case, one option would be to make sure the f_exec "filter" always returns a match.</p>



<a name="131230706"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131230706" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131230706">(Aug 10 2018 at 11:03)</a>:</h4>
<p>It also raises a question of what to do with mixed -exec calls and filters</p>



<a name="131230783"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131230783" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131230783">(Aug 10 2018 at 11:05)</a>:</h4>
<p>Using the same moss.g example:</p>
<p>mged&gt; search / -type arb8 -name box.s -exec echo "{}" ";"<br>
/all.g/box.r/box.s</p>
<p>mged&gt; search / -type arb8 -exec echo "{}" ";" -name box.s<br>
/all.g/box.r/box.s<br>
/all.g/platform.r/platform.s</p>



<a name="131230808"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131230808" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131230808">(Aug 10 2018 at 11:06)</a>:</h4>
<p>Should those return the same result?  What does find do in such a case?</p>



<a name="131230898"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131230898" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131230898">(Aug 10 2018 at 11:08)</a>:</h4>
<p>One possibility is to store the exec plans separately and only execute them after all the other filters have been processed, but that's not the way to go if the expected find behavior is to only apply the filters defined before each exec (i.e. if we tack another echo onto the last example above, would the first echo print both box.s and platform.s and the second print just box.s ?)</p>



<a name="131230903"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131230903" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131230903">(Aug 10 2018 at 11:08)</a>:</h4>
<p>Something to check in find's behavior</p>



<a name="131833977"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131833977" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131833977">(Aug 10 2018 at 16:38)</a>:</h4>
<blockquote>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span>  one data point I can offer - a quick check in gdb working with the share/db/moss.g example and the following search input:</p>
<p>search / -type tor -exec echo "{}" ";" -exec echo "{}" ";"</p>
<p>indicates that c_exec does seem to be getting called twice, but f_exec is only being called once - e.g. it's allocating two searchplan objects that are N_EXEC types, but only getting to one of them for execution.</p>
</blockquote>
<p>so it's lazy evaluating, nice <span class="emoji emoji-1f44d" title="+1">:+1:</span> (that's what i expected tbh)</p>



<a name="131833994"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131833994" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131833994">(Aug 10 2018 at 16:38)</a>:</h4>
<p>wait...</p>



<a name="131834112"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131834112" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131834112">(Aug 10 2018 at 16:40)</a>:</h4>
<blockquote>
<p>Should those return the same result?  What does find do in such a case?</p>
</blockquote>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> it prints the same thing, since "echo" always returns true (well, it should at least, there is probably some weird case like a broken pipe error where it could return false)</p>



<a name="131838848"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131838848" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131838848">(Aug 10 2018 at 18:17)</a>:</h4>
<p><span class="user-mention" data-user-id="102902">@Sean</span> why doesn't the echo command allow 0 arguments?</p>



<a name="131841655"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131841655" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131841655">(Aug 10 2018 at 19:18)</a>:</h4>
<p>uh.... i removed the result string initialization from the echo command but it still doesn't work???</p>



<a name="131841741"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131841741" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131841741">(Aug 10 2018 at 19:21)</a>:</h4>
<p>annd the wrapper function doesn't seem to be doing any resetting.....</p>



<a name="131841746"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131841746" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131841746">(Aug 10 2018 at 19:21)</a>:</h4>
<p>and i didn't forget to build this time</p>



<a name="131841751"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131841751" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131841751">(Aug 10 2018 at 19:21)</a>:</h4>
<p>hmmm.</p>



<a name="131930920"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131930920" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131930920">(Aug 11 2018 at 01:11)</a>:</h4>
<p>oh<br>
<span class="user-mention" data-user-id="112516">@starseeker</span> TCL_OK is not non-zero.... ie. it is zero</p>



<a name="131931730"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131931730" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131931730">(Aug 11 2018 at 01:35)</a>:</h4>
<p>I mean, do two echos print things twice, or does it print only once?</p>



<a name="131931788"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131931788" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131931788">(Aug 11 2018 at 01:37)</a>:</h4>
<p>Yeah - find will do both exec calls:</p>
<p>find . -name testfile.txt -exec echo {} \; -exec echo {} \;<br>
./testfile.txt<br>
./testfile.txt</p>



<a name="131931857"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131931857" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131931857">(Aug 11 2018 at 01:39)</a>:</h4>
<p>So I would then expect </p>
<p>search / -type tor -exec echo "{}" ";" -exec echo "{}" ";"</p>
<p>to print</p>
<p>/all.g/tor.r/tor<br>
/all.g/tor.r/tor</p>



<a name="131932213"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131932213" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131932213">(Aug 11 2018 at 01:49)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> Is patch #510 still needed with the current code?</p>



<a name="131932479"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131932479" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131932479">(Aug 11 2018 at 01:57)</a>:</h4>
<p>Ah, I see patch #512 has got it.</p>



<a name="131932704"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131932704" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131932704">(Aug 11 2018 at 02:04)</a>:</h4>
<p>So with that, we have search exec echo printing output, plus the "normal" search reporting.  That doesn't seem to match the find behavior:</p>
<blockquote>
<p>find . -name testfile.txt<br>
./testfile.txt<br>
find . -name testfile.txt -exec echo {} &gt; /dev/null \;</p>
<p>find . -name testfile.txt -exec echo {} \;<br>
./testfile.txt</p>
</blockquote>
<p>It looks like -exec may be regarded as a "printing filter" by find, which results in disabling the default output.</p>



<a name="131932879"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131932879" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131932879">(Aug 11 2018 at 02:09)</a>:</h4>
<p>nevermind, I see it - c_exec wasn't setting the db_search_isoutput flag.  Trivial fix, committed.</p>



<a name="131933297"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131933297" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131933297">(Aug 11 2018 at 02:19)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> make sure you're updating your development log...</p>



<a name="131933407"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131933407" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131933407">(Aug 11 2018 at 02:21)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> are you aware of any other problematic -exec behaviors?</p>



<a name="131933551"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131933551" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131933551">(Aug 11 2018 at 02:24)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> not really, echo still doesn't work but that's not search's fault</p>



<a name="131933555"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131933555" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131933555">(Aug 11 2018 at 02:24)</a>:</h4>
<p>but puts works</p>



<a name="131933564"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131933564" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131933564">(Aug 11 2018 at 02:25)</a>:</h4>
<p>really?  echo works for me, at least in GUI mode...</p>



<a name="131933571"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131933571" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131933571">(Aug 11 2018 at 02:25)</a>:</h4>
<p>....huh.</p>



<a name="131933724"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131933724" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131933724">(Aug 11 2018 at 02:30)</a>:</h4>
<p>The last quirk I'm seeing is a consequence of my use of bu_log in mged_db_search_callback - I can't capture the results of search -exec into a Tcl variable, the way I can with a normal search.</p>



<a name="131933887"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131933887" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131933887">(Aug 11 2018 at 02:37)</a>:</h4>
<p>What is echo doing when you try to run it?</p>



<a name="131934205"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934205" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934205">(Aug 11 2018 at 02:45)</a>:</h4>
<p>I think to avoid having to use bu_log, we'd need to instead somehow build up an accumulated buffer of the result strings and then  return them all at once at the end of the search command run.</p>



<a name="131934262"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934262" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934262">(Aug 11 2018 at 02:47)</a>:</h4>
<p>in MGED, bu_log is literally putting text lines in the output window, and not accumulating them to return as part of the Tcl command result.</p>



<a name="131934346"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934346" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934346">(Aug 11 2018 at 02:49)</a>:</h4>
<div class="codehilite"><pre><span></span>a
b
a
b
a
b
a
b
a
b
a
b
a
b
a
b
a
b
a
b
a
b
a
b
a
b
double free or corruption (fasttop)
8982: signal: sys: abort (core dumped)
echo: exit 1
</pre></div>


<p>hmmmmmmmmmmmmmmmmmmmmmmmmmm</p>



<a name="131934349"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934349" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934349">(Aug 11 2018 at 02:49)</a>:</h4>
<p>that's.... not good.</p>



<a name="131934391"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934391" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934391">(Aug 11 2018 at 02:50)</a>:</h4>
<p>O.o</p>



<a name="131934395"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934395" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934395">(Aug 11 2018 at 02:50)</a>:</h4>
<p>what are you searching?</p>



<a name="131934405"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934405" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934405">(Aug 11 2018 at 02:50)</a>:</h4>
<p>or running?</p>



<a name="131934485"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934485" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934485">(Aug 11 2018 at 02:52)</a>:</h4>
<p><code>0x00007f713adf5014 in bu_free (ptr=0x55d3bd9ab250, str=0x7f713e93740e "e_argv") at /home/rain/Sync/gsoc/brlcad-code/src/libbu/malloc.c:200</code></p>



<a name="131934497"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934497" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934497">(Aug 11 2018 at 02:52)</a>:</h4>
<p>just a basic echo thingy</p>



<a name="131934503"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934503" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934503">(Aug 11 2018 at 02:52)</a>:</h4>
<p><code>echo 'search -exec echo a ";" -exec echo b ";"' | ./bin/mged ../../db/moss.g</code></p>



<a name="131934519"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934519" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934519">(Aug 11 2018 at 02:53)</a>:</h4>
<p>/me ponders... should the results of search -exec be storable in a Tcl variable as a result of running search?  we might be able to do it with our own bu_log hook in the search callback...</p>



<a name="131934523"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934523" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934523">(Aug 11 2018 at 02:53)</a>:</h4>
<p>Ah!  an exec with no holes.</p>



<a name="131934528"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934528" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934528">(Aug 11 2018 at 02:53)</a>:</h4>
<p>hadn't tried that</p>



<a name="131934581"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934581" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934581">(Aug 11 2018 at 02:54)</a>:</h4>
<p>hrm... doesn't crash here.</p>



<a name="131934589"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934589" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934589">(Aug 11 2018 at 02:54)</a>:</h4>
<p>Are you building the latest trunk build?</p>



<a name="131934598"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934598" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934598">(Aug 11 2018 at 02:54)</a>:</h4>
<p>yup</p>



<a name="131934601"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934601" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934601">(Aug 11 2018 at 02:54)</a>:</h4>
<p>well, latest as of ~10 minutes ago</p>



<a name="131934602"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934602" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934602">(Aug 11 2018 at 02:54)</a>:</h4>
<p>Oh, there it is - takes two echo commands.  One works.</p>



<a name="131934611"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934611" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934611">(Aug 11 2018 at 02:55)</a>:</h4>
<p>oh</p>



<a name="131934613"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934613" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934613">(Aug 11 2018 at 02:55)</a>:</h4>
<p>my bad</p>



<a name="131934681"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934681" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934681">(Aug 11 2018 at 02:56)</a>:</h4>
<p>hey, this isn't the new and improved node freeer thingy i wrote that fixed my old and horrible node freeer thingy...</p>



<a name="131934689"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934689" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934689">(Aug 11 2018 at 02:56)</a>:</h4>
<p>did i mess up my master branch??</p>



<a name="131934694"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934694" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934694">(Aug 11 2018 at 02:56)</a>:</h4>
<p>(which should be a clone of the svn repo)</p>



<a name="131934703"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934703" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934703">(Aug 11 2018 at 02:57)</a>:</h4>
<p>I applied a patch, then had to change it in a subsequent patch...</p>



<a name="131934713"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934713" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934713">(Aug 11 2018 at 02:57)</a>:</h4>
<p>I might have made a mistake, but the patch I applied looked like it was freeing too much...</p>



<a name="131934717"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934717" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934717">(Aug 11 2018 at 02:57)</a>:</h4>
<p>let me know if I missed something</p>



<a name="131934787"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934787" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934787">(Aug 11 2018 at 02:59)</a>:</h4>
<p>well for one you aren't freeing the strings in argv....</p>



<a name="131934839"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934839" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934839">(Aug 11 2018 at 03:00)</a>:</h4>
<p>waaait...</p>



<a name="131934841"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934841" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934841">(Aug 11 2018 at 03:00)</a>:</h4>
<p>I'm not sure they should be freed - it depends where they come from.</p>



<a name="131934847"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934847" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934847">(Aug 11 2018 at 03:00)</a>:</h4>
<p>here: <code>     e_argv[i] = bu_strdupm(**argvp, "e_argv arg");</code></p>



<a name="131934848"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934848" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934848">(Aug 11 2018 at 03:00)</a>:</h4>
<p>dp-&gt;d_namep pointers from db_lookup generally aren't freed in calling code.</p>



<a name="131934860"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934860" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934860">(Aug 11 2018 at 03:01)</a>:</h4>
<p>the d_namep stuff is in <code>f_exec</code>, those aren't supposed to outlive the function</p>



<a name="131934903"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934903" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934903">(Aug 11 2018 at 03:02)</a>:</h4>
<p><code>db_search_free_plan</code> cleans up after <code>c_exec</code></p>



<a name="131934916"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934916" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934916">(Aug 11 2018 at 03:03)</a>:</h4>
<p>r71486 should fix the echo double crasher</p>



<a name="131934961"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934961" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934961">(Aug 11 2018 at 03:04)</a>:</h4>
<p>Let me back up and use your original freeer - if I missed the bu_strdupm I probably introduced a memory leak</p>



<a name="131934966"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934966" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934966">(Aug 11 2018 at 03:04)</a>:</h4>
<p>yus!</p>



<a name="131934967"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131934967" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131934967">(Aug 11 2018 at 03:04)</a>:</h4>
<p>it works</p>



<a name="131935148"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131935148" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131935148">(Aug 11 2018 at 03:11)</a>:</h4>
<p>r71487 is close to your earlier patch, but if I add in the  bu_free(splan-&gt;p_un.ex._e_argv[i], "e_argv[i]"); loop I get memory corruption.  Did I strip out the bu_strdupm by mistake?</p>



<a name="131935206"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131935206" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131935206">(Aug 11 2018 at 03:13)</a>:</h4>
<p>No, it's still there... why do I get a crash if I free it when I free the plans??</p>



<a name="131935207"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131935207" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131935207">(Aug 11 2018 at 03:13)</a>:</h4>
<p>aren't you supposed to be freeing <code>p</code> in the loop?</p>



<a name="131935211"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131935211" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131935211">(Aug 11 2018 at 03:13)</a>:</h4>
<p>and not <code>splan</code>?</p>



<a name="131935261"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131935261" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131935261">(Aug 11 2018 at 03:14)</a>:</h4>
<p>quite right</p>



<a name="131935332"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131935332" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131935332">(Aug 11 2018 at 03:17)</a>:</h4>
<p>r71488 works for me, but if I uncomment the loop freeing the e_argv entries I get a SIGSEGV</p>



<a name="131935371"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131935371" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131935371">(Aug 11 2018 at 03:18)</a>:</h4>
<p>did I mess up p_un.ex._e_argc somehow?</p>



<a name="131935630"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131935630" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131935630">(Aug 11 2018 at 03:27)</a>:</h4>
<p>doesn't seem like it</p>



<a name="131935686"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131935686" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131935686">(Aug 11 2018 at 03:29)</a>:</h4>
<p>well... echo works...</p>



<a name="131935687"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131935687" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131935687">(Aug 11 2018 at 03:29)</a>:</h4>
<p>what would be a good test that does some testing with -exec?</p>



<a name="131935693"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131935693" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131935693">(Aug 11 2018 at 03:29)</a>:</h4>
<p>ah HAH!</p>



<a name="131935751"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131935751" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131935751">(Aug 11 2018 at 03:30)</a>:</h4>
<p>valgrind to the rescue</p>



<a name="131935801"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131935801" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131935801">(Aug 11 2018 at 03:32)</a>:</h4>
<p>I think r71489 has it.</p>



<a name="131935804"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131935804" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131935804">(Aug 11 2018 at 03:32)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> at this point, I would double check that all the man page examples work.</p>



<a name="131935864"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131935864" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131935864">(Aug 11 2018 at 03:34)</a>:</h4>
<p>good idea</p>



<a name="131935902"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131935902" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131935902">(Aug 11 2018 at 03:36)</a>:</h4>
<p>The only other thing I can see that is missing is the possibility to capture the output of the execs into a Tcl variable, and that would probably require some pretty fancy voodoo at the libged search.c level with bu_log hooks - db_search is not set up to return arbitrary string output (which is not only possible but likely with arbitrary exec calls) so it would have to be handled at the libged level.</p>



<a name="131935923"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131935923" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131935923">(Aug 11 2018 at 03:37)</a>:</h4>
<p>I would also add a man page example illustrating the behavior of multiple -exec calls - what to expect in terms of behavior.</p>



<a name="131935968"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131935968" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131935968">(Aug 11 2018 at 03:38)</a>:</h4>
<p>you can use the moss.g examples from this chat log as a starting point - examples where I was wondering what the behavior would be (and what the right behavior should be) could be used to guide a man page discussion of the behavior of multiple -exec calls.</p>



<a name="131936110"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131936110" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131936110">(Aug 11 2018 at 03:42)</a>:</h4>
<p>can't the result storing be done in Tcl?</p>



<a name="131936118"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131936118" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131936118">(Aug 11 2018 at 03:42)</a>:</h4>
<p>since it's so very dynamic and whatnot?</p>



<a name="131936132"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131936132" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131936132">(Aug 11 2018 at 03:43)</a>:</h4>
<p>one example might be if you have one -exec call that is a mv and a subsequent list call that is expecting the original name:</p>
<p>search . -exec mv "{}" "{}".new ";" -exec l "{}" ";"</p>
<p>I would expect all of the "l" list commands to fail, since the mv will be done first.  On the other hand, I would expect</p>
<p>search . -exec mv "{}" "{}".new ";" -exec l "{}".new ":" to work</p>
<p>(Those would be good to try.)</p>



<a name="131936198"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131936198" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131936198">(Aug 11 2018 at 03:45)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> the complication with storing the results in Tcl is that we're Tcl_Evaling the commands from exec in the interpreter, so accumulating the results in Tcl gets tricky.  There's probably a way to make it work, but I'm not exactly sure how to do it.</p>
<p>You can certainly try to figure it out, but before doing that I would add the man page discussion, and make sure you are ready to submit what you need to submit to Google for the wrap-up.</p>



<a name="131936310"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131936310" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131936310">(Aug 11 2018 at 03:48)</a>:</h4>
<p>hmmm</p>



<a name="131936312"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131936312" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131936312">(Aug 11 2018 at 03:48)</a>:</h4>
<p>{}a is expanded to NAMEa</p>



<a name="131936314"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131936314" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131936314">(Aug 11 2018 at 03:48)</a>:</h4>
<p>well<br>
in find(1)</p>



<a name="131936385"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131936385" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131936385">(Aug 11 2018 at 03:50)</a>:</h4>
<p>but c_exec only considers "{}" when it's on its own completely....</p>



<a name="131936389"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131936389" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131936389">(Aug 11 2018 at 03:50)</a>:</h4>
<p>Am I correct that supporting that would require us to explicitly store the spaces when you're splitting up the -exec input strings?</p>



<a name="131936414"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131936414" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131936414">(Aug 11 2018 at 03:51)</a>:</h4>
<p>the splitting is done in Tcl</p>



<a name="131936420"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131936420" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131936420">(Aug 11 2018 at 03:51)</a>:</h4>
<p>hmmm...</p>



<a name="131936421"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131936421" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131936421">(Aug 11 2018 at 03:51)</a>:</h4>
<p>but you're building up the exec string by filling in the holes, right?</p>



<a name="131936462"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131936462" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131936462">(Aug 11 2018 at 03:52)</a>:</h4>
<p>yep</p>



<a name="131936468"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131936468" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131936468">(Aug 11 2018 at 03:52)</a>:</h4>
<p>so the hole recognition logic would have to do something a bit different</p>



<a name="131936469"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131936469" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131936469">(Aug 11 2018 at 03:52)</a>:</h4>
<p>but an argument is either replaced by a path or is a constant</p>



<a name="131936477"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131936477" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131936477">(Aug 11 2018 at 03:53)</a>:</h4>
<p>c_exec has to store the argument string instead of NULLing holes</p>



<a name="131936479"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131936479" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131936479">(Aug 11 2018 at 03:53)</a>:</h4>
<p>and scan for {} in them</p>



<a name="131936481"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131936481" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131936481">(Aug 11 2018 at 03:53)</a>:</h4>
<p>and f_exec fills those in</p>



<a name="131936482"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131936482" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131936482">(Aug 11 2018 at 03:53)</a>:</h4>
<p>/me nods - sounds right</p>



<a name="131936484"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131936484" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131936484">(Aug 11 2018 at 03:54)</a>:</h4>
<p>shouldn't be too hard...</p>



<a name="131936523"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131936523" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131936523">(Aug 11 2018 at 03:54)</a>:</h4>
<p>sounds good - just make sure you meet all the submission deadlines!</p>



<a name="131936527"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131936527" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131936527">(Aug 11 2018 at 03:54)</a>:</h4>
<p>/me nods</p>



<a name="131936529"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131936529" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131936529">(Aug 11 2018 at 03:55)</a>:</h4>
<p>this is awesome stuff - we've been wanting an -exec option in search for literally years</p>



<a name="131936586"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131936586" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131936586">(Aug 11 2018 at 03:57)</a>:</h4>
<p>^u^</p>



<a name="131974384"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131974384" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131974384">(Aug 12 2018 at 00:29)</a>:</h4>
<p>ok i think it finally works. wow. TIL water is wet and doing string stuff in C is prone to errors</p>



<a name="131974536"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131974536" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131974536">(Aug 12 2018 at 00:35)</a>:</h4>
<p><code>./bin/mged ../../db/moss.g 'search -exec echo "{}AAAA{}{}B" ";" -exec echo "foo{}" "bar{}" ";"'</code></p>
<div class="codehilite"><pre><span></span>all.gAAAAall.gall.gB
fooall.g barall.g
light.rAAAAlight.rlight.rB
foolight.r barlight.r
LIGHTAAAALIGHTLIGHTB
fooLIGHT barLIGHT
tor.rAAAAtor.rtor.rB
footor.r bartor.r
torAAAAtortorB
footor bartor
ellipse.rAAAAellipse.rellipse.rB
fooellipse.r barellipse.r
ellipse.sAAAAellipse.sellipse.sB
fooellipse.s barellipse.s
cone.rAAAAcone.rcone.rB
foocone.r barcone.r
cone.sAAAAcone.scone.sB
foocone.s barcone.s
box.rAAAAbox.rbox.rB
foobox.r barbox.r
box.sAAAAbox.sbox.sB
foobox.s barbox.s
platform.rAAAAplatform.rplatform.rB
fooplatform.r barplatform.r
platform.sAAAAplatform.splatform.sB
fooplatform.s barplatform.s
</pre></div>



<a name="131976013"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131976013" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131976013">(Aug 12 2018 at 01:32)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> that patch didn't apply cleanly to trunk - did I miss a precursor patch?</p>



<a name="131976020"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131976020" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131976020">(Aug 12 2018 at 01:33)</a>:</h4>
<p>hmm.</p>



<a name="131976075"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131976075" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131976075">(Aug 12 2018 at 01:35)</a>:</h4>
<p>oh, nah, i forgot to merge master</p>



<a name="131976307"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131976307" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131976307">(Aug 12 2018 at 01:44)</a>:</h4>
<p>hmm...</p>



<a name="131976308"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131976308" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131976308">(Aug 12 2018 at 01:44)</a>:</h4>
<p>I did have one commit making sure we had a callback before trying to exec it - that might complicate the merge</p>



<a name="131977032"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131977032" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131977032">(Aug 12 2018 at 02:11)</a>:</h4>
<p>np, i just reverted it then merged then reverted the revert then resolved the conflict</p>



<a name="131977074"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131977074" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131977074">(Aug 12 2018 at 02:12)</a>:</h4>
<p>oops, i wasn't logged in....</p>



<a name="131977266"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131977266" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131977266">(Aug 12 2018 at 02:19)</a>:</h4>
<p>ok i posted a fixed one</p>



<a name="131977272"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131977272" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131977272">(Aug 12 2018 at 02:19)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span> can you check it?</p>



<a name="131977546"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131977546" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131977546">(Aug 12 2018 at 02:28)</a>:</h4>
<p>It applies, looks good.</p>



<a name="131977555"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131977555" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131977555">(Aug 12 2018 at 02:29)</a>:</h4>
<p>Be sure to mention in the docs that the pattern needs to look like:</p>
<p>search . -exec echo "{}.suffix" ";"</p>
<p>rather than</p>
<p>search . -exec echo "{}".suffix ";"</p>
<p>(I tried the latter first...)</p>



<a name="131977600"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131977600" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131977600">(Aug 12 2018 at 02:30)</a>:</h4>
<p>how come the latter doesn't work?</p>



<a name="131977609"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131977609" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131977609">(Aug 12 2018 at 02:31)</a>:</h4>
<p>search . -exec echo "{}".new ";"<br>
extra characters after close-quote</p>



<a name="131977651"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131977651" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131977651">(Aug 12 2018 at 02:32)</a>:</h4>
<p>hm. so it's just how Tcl quoting rules roll</p>



<a name="131977749"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131977749" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131977749">(Aug 12 2018 at 02:36)</a>:</h4>
<p>looks like it</p>



<a name="131977753"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131977753" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131977753">(Aug 12 2018 at 02:37)</a>:</h4>
<p>Applied r71497</p>



<a name="131977800"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131977800" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131977800">(Aug 12 2018 at 02:39)</a>:</h4>
<p>I'd say doc updates and additions are probably next up?</p>



<a name="131977844"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/131977844" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#131977844">(Aug 12 2018 at 02:40)</a>:</h4>
<p>Given how cool this is, we want to make sure users can use it!</p>



<a name="132047409"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/132047409" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#132047409">(Aug 13 2018 at 13:40)</a>:</h4>
<p>sent the docs patch, I think that's basically it? gonna upload it now and send the eval</p>



<a name="132211238"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/132211238" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#132211238">(Aug 16 2018 at 01:31)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> looking at your README.md - what are the conflicts in some of the commits?  Is this the list of patches showing the stages of work (i.e. changes and subsequent changes in other commits?)</p>



<a name="132216643"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/132216643" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#132216643">(Aug 16 2018 at 04:12)</a>:</h4>
<p><span class="user-mention" data-user-id="112516">@starseeker</span>  it's (almost) all of the commits by me, not all of them were sent as patches</p>



<a name="132216661"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/132216661" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#132216661">(Aug 16 2018 at 04:13)</a>:</h4>
<p>(the commits for making the "presentable" branch aren't included)</p>



<a name="132216663"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/132216663" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#132216663">(Aug 16 2018 at 04:13)</a>:</h4>
<p>hmmmmmmm</p>



<a name="132216703"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/132216703" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#132216703">(Aug 16 2018 at 04:14)</a>:</h4>
<p>come to think of it, maybe i should describe which branches are actually interesting......</p>



<a name="132335560"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/132335560" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#132335560">(Aug 18 2018 at 00:47)</a>:</h4>
<p><span class="user-mention" data-user-id="102902">@Sean</span> I have a Tcl question, how come I can't group things like this:</p>
<div class="codehilite"><pre><span></span>search -exec eval {
    attr set {} color [expr {int(rand()*225)+30}]/[expr {int(rand()*225)+30}]/[expr {int(rand()*225)+30}]
    attr set {} shader {glass {tr 0.7 ri 1}}
} &quot;;&quot;
</pre></div>


<p>I can run the search with either of those, but not both at the same time</p>
<p>i also tested</p>
<div class="codehilite"><pre><span></span>eval {
    puts a
    puts b
}
</pre></div>


<p>and that worked as expected, so, something weird is going on...</p>



<a name="132552414"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/132552414" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> starseeker <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#132552414">(Aug 22 2018 at 01:23)</a>:</h4>
<p><span class="user-mention" data-user-id="111633">@Peter Pronai</span> Looking at the man page, for the search examples of "Bad" and "Good" do you think you could make a version that has one "correct" example paired with one "incorrect" example per table row?  Having multiple "good" examples on the same line gives the impression that you need two exec calls instead of one to fix the one on the first row (for example.)</p>



<a name="132553186"></a>
<h4><a href="https://brlcad.zulipchat.com#narrow/stream/111975-Google%20Summer%20of%20Code/topic/search%20-exec/near/132553186" class="zl"><img src="https://brl-cad.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Pronai <a href="https://brl-cad.github.io/zulip_archive/stream/111975-Google-Summer-of-Code/topic/search.20-exec.html#132553186">(Aug 22 2018 at 01:47)</a>:</h4>
<p>sure, I gotta slep now but I'll do it tomorrow afternoon</p>



<hr><p>Last updated: Oct 08 2024 at 00:44 UTC</p>
</html>